import{j as e,k as t,h as r,ad as a,v as n,w as i,u as o,S as s,a7 as d,f as l,b as c,ax as u}from"./index-Cb7olAwr.js";import{b as p,d as v,h as m}from"./react-vendor-DGaPsC2e.js";import{l as h,P as _}from"./PostActionsMenu-DQb2510x.js";import{f,g as k,c as y,a as x,b as w,i as g}from"./artboards-DNvSVVrd.js";import{p as b}from"./artboardsPds-DWUixJ9h.js";import{g as R,b as j}from"./date-Ct-NsrQr.js";import{P as C,a as L}from"./PostText-BH3aTEGZ.js";let N=null;function T(e,t){if(!e||!e.startsWith("http"))return e??"";if(!function(){if(null!==N)return N;if("undefined"==typeof document)return N=!1,N;const e=document.createElement("canvas");return N=!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),N}())return e;return`https://wsrv.nl/?url=${encodeURIComponent(e)}&output=webp`}const A="_progressiveImage_8ku7v_1",P="_placeholder_8ku7v_8",$="_fullImage_8ku7v_21",M="_loaded_8ku7v_30",I="_error_8ku7v_38",S="_errorPlaceholder_8ku7v_46",E="_errorText_8ku7v_60";function O({src:t,alt:r,aspectRatio:a,loading:n="lazy",className:i="",onLoad:o,sizes:s=[320,640,960,1280,1920],sizesAttr:d,maxRetries:l=3,preloadDistance:c=1500}){const[u,v]=p.useState(!1),[m,h]=p.useState(!1),[_,f]=p.useState(0),[k,y]=p.useState(!1),[x,w]=p.useState(!1),[g,b]=p.useState("eager"===n),R=p.useRef(null),j=p.useRef(null),C=p.useRef(null),L=p.useMemo(()=>T(t),[t]),N=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return s.map(e=>`${T(t.includes("?")?`${t}&width=${e}`:`${t}?width=${e}`)} ${e}w`).join(", ")},[t,s]),O=p.useMemo(()=>"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",[]),W=d||O,B=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return t.replace(/\/img\/[^/]+\//,"/img/avatar_thumbnail/")},[t]),D=p.useCallback(e=>{v(!0),h(!1),y(!1),f(0),o?.(e)},[o]),F=p.useCallback(()=>{w(!0)},[]),G=p.useCallback(()=>{if(m||L===t)if(_<l){const e=1e3*Math.pow(2,_);R.current=setTimeout(()=>{f(e=>e+1),h(!1)},e)}else y(!0);else h(!0)},[m,L,t,_,l]);p.useEffect(()=>()=>{R.current&&clearTimeout(R.current),C.current&&C.current.disconnect()},[]),p.useEffect(()=>{if("eager"===n||u)return void b(!0);const e=j.current;return e?(C.current=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting&&(b(!0),C.current&&C.current.disconnect())},{rootMargin:`${c}px 0px ${c}px 0px`,threshold:0}),C.current.observe(e),()=>{C.current&&C.current.disconnect()}):void 0},[n,c,u]),p.useEffect(()=>{f(0),y(!1),v(!1),h(!1),w(!1),b("eager"===n)},[t,n]);const z=m?t:L;return k?e.jsx("div",{className:`${A} ${I} ${i}`,style:{aspectRatio:a?String(a):void 0},role:"img","aria-label":`Failed to load: ${r}`,children:e.jsxs("div",{className:S,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:E,children:"Image failed to load"})]})}):e.jsxs("div",{ref:j,className:`${A} ${u?M:""} ${i}`,style:{aspectRatio:a?String(a):void 0},children:[B&&!u&&!x&&e.jsx("img",{src:B,alt:"",className:P,"aria-hidden":"true",onError:F}),e.jsx("img",{src:z,srcSet:N,sizes:N?W:void 0,alt:r,loading:g?"eager":"lazy",onLoad:D,onError:G,className:$},`${z}-${_}`)]})}const W={card:"_card_1vk5y_2",cardLink:"_cardLink_1vk5y_21",cardSelected:"_cardSelected_1vk5y_43",cardLiked:"_cardLiked_1vk5y_73",cardInArtboard:"_cardInArtboard_1vk5y_81",cardTransFlag:"_cardTransFlag_1vk5y_89",mediaWrap:"_mediaWrap_1vk5y_134",nsfwOverlay:"_nsfwOverlay_1vk5y_135",cardArtOnly:"_cardArtOnly_1vk5y_138",textOnlyPreview:"_textOnlyPreview_1vk5y_142",cardSeen:"_cardSeen_1vk5y_147",cardFillCell:"_cardFillCell_1vk5y_244",meta:"_meta_1vk5y_256",mediaGridCellFocused:"_mediaGridCellFocused_1vk5y_286",addWrap:"_addWrap_1vk5y_302",addWrapOpen:"_addWrapOpen_1vk5y_311",cardActionRow:"_cardActionRow_1vk5y_316",cardActionRowCenter:"_cardActionRowCenter_1vk5y_323",cardLikeRepostBtn:"_cardLikeRepostBtn_1vk5y_347",addToBoardBtn:"_addToBoardBtn_1vk5y_348",cardActionRowAvatarFollow:"_cardActionRowAvatarFollow_1vk5y_351",cardActionRowAvatarPlus:"_cardActionRowAvatarPlus_1vk5y_351",cardActionRowRight:"_cardActionRowRight_1vk5y_365",cardActionRowTime:"_cardActionRowTime_1vk5y_376",postTimeStacked:"_postTimeStacked_1vk5y_383",postTimeMonth:"_postTimeMonth_1vk5y_391",postTimeDayYear:"_postTimeDayYear_1vk5y_398",cardActionRowAvatar:"_cardActionRowAvatar_1vk5y_351",handleRow:"_handleRow_1vk5y_490",authorAvatar:"_authorAvatar_1vk5y_490",authorAvatarPlaceholder:"_authorAvatarPlaceholder_1vk5y_491",handleRowMain:"_handleRowMain_1vk5y_514",handleRowMeta:"_handleRowMeta_1vk5y_517",cardMinimalist:"_cardMinimalist_1vk5y_555",cardLikeRepostBtnActive:"_cardLikeRepostBtnActive_1vk5y_616",addToBoardBtnInCollection:"_addToBoardBtnInCollection_1vk5y_663",collectIcon:"_collectIcon_1vk5y_667",addDropdown:"_addDropdown_1vk5y_680",addDropdownFixed:"_addDropdownFixed_1vk5y_704",addBoardLabel:"_addBoardLabel_1vk5y_710",addBoardCheckbox:"_addBoardCheckbox_1vk5y_724",addBoardText:"_addBoardText_1vk5y_729",addDropdownNew:"_addDropdownNew_1vk5y_735",addBoardInput:"_addBoardInput_1vk5y_741",addDropdownActions:"_addDropdownActions_1vk5y_752",addBoardSubmit:"_addBoardSubmit_1vk5y_758",mediaWrapConstrained:"_mediaWrapConstrained_1vk5y_831",nsfwOverlayText:"_nsfwOverlayText_1vk5y_857",mediaWrapFillCell:"_mediaWrapFillCell_1vk5y_866",mediaWrapMultiStack:"_mediaWrapMultiStack_1vk5y_874",media:"_media_1vk5y_134",textOnlyPreviewText:"_textOnlyPreviewText_1vk5y_911",textOnlyPreviewEmpty:"_textOnlyPreviewEmpty_1vk5y_921",textOnlyPreviewLink:"_textOnlyPreviewLink_1vk5y_926",textOnlyPreviewLinkThumb:"_textOnlyPreviewLinkThumb_1vk5y_946",textOnlyPreviewLinkTitle:"_textOnlyPreviewLinkTitle_1vk5y_953",textOnlyPreviewLinkDesc:"_textOnlyPreviewLinkDesc_1vk5y_962",mediaWrapGridSpacer:"_mediaWrapGridSpacer_1vk5y_999",mediaWrapGrid:"_mediaWrapGrid_1vk5y_999",mediaGrid:"_mediaGrid_1vk5y_286",mediaGridCell:"_mediaGridCell_1vk5y_286",mediaGridImg:"_mediaGridImg_1vk5y_1056",mediaVideoWrap:"_mediaVideoWrap_1vk5y_1098",handleBlock:"_handleBlock_1vk5y_1124",postTime:"_postTime_1vk5y_383",repostIconLink:"_repostIconLink_1vk5y_1227",repostIcon:"_repostIcon_1vk5y_1227",pinIconWrap:"_pinIconWrap_1vk5y_1246",pinIcon:"_pinIcon_1vk5y_1246",handleLinkWrap:"_handleLinkWrap_1vk5y_1264",handleLinkWrapLiked:"_handleLinkWrapLiked_1vk5y_1274",handleLink:"_handleLink_1vk5y_1155",text:"_text_1vk5y_142"};function B(){return e.jsx("svg",{className:W.repostIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})})}function D(){return e.jsx("svg",{className:W.pinIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})})}function F(){return e.jsx("svg",{className:W.collectIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}const G=p.memo(function({item:N,isSelected:T,cardRef:A,addButtonRef:P,openAddDropdown:$,onAddClose:M,onPostClick:I,onAspectRatio:S,fillCell:E,nsfwBlurred:G,onNsfwUnblur:z,constrainMediaHeight:H,likedUriOverride:U,onLikedChange:V,seen:Y,onActionsMenuOpenChange:K,cardIndex:Q,actionsMenuOpenForIndex:X,focusedMediaIndex:q,onMediaRef:J}){const Z=v(),{session:ee}=t(),{openLoginModal:te}=r(),{artOnly:re,minimalist:ae}=a(),{mediaMode:ne}=n(),{unblurredUris:ie,setUnblurred:oe}=i(),{openQuotesModal:se,isModalOpen:de}=o(),le=p.useRef(null),ce=p.useRef(null),ue=p.useRef(null),{post:pe,reason:ve}=N,me=N._feedSource,he=me?.label??("timeline"===me?.kind?"Following":void 0),_e=p.useMemo(()=>s(pe),[pe]),fe=!!_e,ke=pe.record?.text??"",ye=p.useMemo(()=>d(pe),[pe]),xe=p.useMemo(()=>l(pe),[pe]),we=pe.author.handle??pe.author.did,ge=ve?.by?ve.by.handle??ve.by.did:null,be=(()=>{const e=pe?.embed;return!!e&&("app.bsky.embed.record#view"===e.$type||"app.bsky.embed.recordWithMedia#view"===e.$type)})(),Re="app.bsky.feed.defs#reasonPin"===ve?.$type,je=pe.author.viewer,Ce=je?.following,[Le,Ne]=p.useState(Ce??null),Te=!!(Le??Ce??null),Ae=ee?.did===pe.author.did,[Pe,$e]=p.useState(!1),Me=pe.viewer,Ie=Me?.like,[Se,Ee]=p.useState(Ie),[Oe,We]=p.useState(!1),Be=void 0!==U?U??void 0:Se,De=!!Be,Fe=f(pe.uri),Ge=De&&Fe,[ze,He]=p.useState(()=>fe&&null!=_e?.aspectRatio?_e.aspectRatio:null),[Ue,Ve]=p.useState(!1),[Ye,Ke]=p.useState(!1),Qe=p.useRef(null),[Xe,qe]=p.useState(new Set),[Je,Ze]=p.useState(""),et=p.useRef(null),tt=p.useRef(null),rt=p.useRef(null),at=p.useRef(null),[nt,it]=p.useState(null),ot=p.useRef(null),st=p.useRef(T),dt=p.useRef(0),lt=p.useRef(0),ct=p.useRef(!1),ut=p.useRef(!1),pt=p.useRef(!1),vt=p.useRef(null),mt=p.useRef(null);p.useEffect(()=>{null!=Q&&X!==Q&&Ye&&Ke(!1)},[X,Q,Ye]);const ht=p.useRef(null);p.useEffect(()=>{null!=Q&&(X===Q&&ht.current!==Q&&Ke(!0),ht.current=X??null)},[X,Q]),p.useEffect(()=>{if(!Ye)return;const e=e=>!e||!ot.current?.contains(e)&&!Qe.current?.contains(e),t=t=>{e(t.target)&&Ke(!1)},r=t=>{const r=t.target??t.target;e(r)&&Ke(!1)},a=t=>{e(t.target)&&Ke(!1)};return document.addEventListener("focusin",t),document.addEventListener("mousedown",r),document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("mouseover",a),()=>{document.removeEventListener("focusin",t),document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r),document.removeEventListener("mouseover",a)}},[Ye]),p.useEffect(()=>{Ee(void 0!==U?U??void 0:Ie)},[pe.uri,Ie,U]),p.useEffect(()=>{Ne(Ce??null)},[pe.uri,Ce]);const _t=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),Pe||Ae||!ee?.did||Te)return;$e(!0);const t=`pending:follow:${pe.author.did}:${Date.now()}`;Ne(t);try{const e=await c.follow(pe.author.did);Ne(e.uri)}catch{Ne(null)}finally{$e(!1)}},[Pe,Ae,ee?.did,Te,pe.author.did]),ft=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!ee?.did)return void te();if(Oe)return;const t=!!Be,r=Be||void 0;We(!0),Ee(t?void 0:"pending");try{if(t)await c.deleteLike(r),Ee(void 0);else{const e=await c.like(pe.uri,pe.cid);Ee(e.uri)}}catch{Ee(r)}finally{We(!1)}},[ee?.did,te,Oe,Be,pe.uri,pe.cid]);p.useEffect(()=>{$&&Ve(!0)},[$]),p.useEffect(()=>()=>{vt.current&&(clearTimeout(vt.current),vt.current=null)},[]);const kt=p.useRef(Ue);p.useEffect(()=>{kt.current&&!Ue&&M?.(),kt.current=Ue},[Ue,M]);const yt=p.useCallback(()=>{if(!et.current)return null;const e=et.current.getBoundingClientRect(),t=window.innerWidth-8-140,r=e.left+e.width/2,a=Math.max(148,Math.min(t,r));return{bottom:window.innerHeight-e.top,left:a}},[]);p.useLayoutEffect(()=>{Ue&&et.current?it(yt()):it(null)},[Ue,yt]),p.useEffect(()=>{if(!Ue)return;const e=()=>it(e=>e?yt()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[Ue,yt]),p.useEffect(()=>{if(Ue)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){const t=e.target;et.current?.contains(t)||tt.current?.contains(t)||at.current?.contains(t)||Ve(!1)}},[Ue]);const xt=k(),wt=p.useCallback(e=>{qe(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),gt=p.useCallback(async()=>{if(!(Xe.size>0||Je.trim().length>0))return;const e=u(pe),t=xe.length>0?xe.map(e=>e.url):void 0,r={uri:pe.uri,cid:pe.cid,authorHandle:pe.author.handle,text:pe.record?.text?.slice(0,200),thumb:e?.url??t?.[0],thumbs:t},a=[];if(Je.trim()){const e=y(Je.trim());x(e.id,r),a.push(e.id),Ze("")}if(Xe.forEach(e=>{x(e,r),a.push(e)}),qe(new Set),Ve(!1),ee?.did&&a.length>0)for(const n of a){const e=w(n);if(e)try{await b(c,ee.did,e)}catch{}}},[Xe,Je,pe,xe,ee?.did]),bt=fe&&"video"===_e.type&&_e.videoPlaylist,Rt=fe&&"image"===_e.type&&(_e.imageCount??0)>1,jt=p.useMemo(()=>xe.filter(e=>"image"===e.type),[xe]),Ct=p.useMemo(()=>xe.map((e,t)=>"image"===e.type?t:-1).filter(e=>e>=0),[xe]),Lt=Rt&&jt.length?jt[0]?.url:_e?.url??"",Nt=p.useCallback(e=>{const t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&He(e=>null!=e?e:t.naturalWidth/t.naturalHeight)},[Rt]);p.useEffect(()=>{fe&&(null!=_e?.aspectRatio?He(e=>e??_e.aspectRatio):bt||He(e=>e??null))},[fe,_e?.aspectRatio,_e?.videoPlaylist,bt]),p.useEffect(()=>{He(fe&&null!=_e?.aspectRatio?_e.aspectRatio:null)},[pe.uri]),p.useEffect(()=>{null!=ze&&S&&S(ze)},[ze,S]),p.useEffect(()=>{if(!bt||!_e?.videoPlaylist||!le.current)return;const e=le.current,t=_e.videoPlaylist;let r;var a;return/\.m3u8(\?|$)/i.test(a=t)||a.includes("m3u8")?h().then(a=>{if(le.current)if(a.isSupported()){const n=new a;ue.current=n,n.loadSource(t),n.attachMedia(e),n.on(a.Events.ERROR,()=>{}),r=()=>{n.destroy(),ue.current=null}}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t,r=()=>{e.removeAttribute("src")})}).catch(()=>{e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}):(e.src=t,r=()=>{e.removeAttribute("src")}),()=>{r?.()}},[bt,_e?.videoPlaylist]);const Tt=p.useRef(de);Tt.current=de,p.useEffect(()=>{if(!bt||!ce.current||!le.current)return;const e=ce.current,t=le.current;de&&t.pause();const r=new IntersectionObserver(e=>{const r=e[0];r&&t&&(Tt.current?t.pause():r.isIntersecting?t.play().catch(()=>{}):t.pause())},{threshold:.25,rootMargin:"0px"});return r.observe(e),()=>r.disconnect()},[bt,de]),p.useEffect(()=>{const e=st.current;st.current=T,T&&G&&z&&z(),e&&!T&&ie.has(pe.uri)&&oe(pe.uri,!1)},[T,pe.uri,ie,oe,G,z]),p.useEffect(()=>{const e=ot.current;if(!e||!ie.has(pe.uri))return;const t=t=>{const r=t.relatedTarget;null!=r&&e.contains(r)||oe(pe.uri,!1)};return e.addEventListener("focusout",t),()=>e.removeEventListener("focusout",t)},[pe.uri,ie,oe]),p.useEffect(()=>{if(!fe||!ie.has(pe.uri)||!ce.current)return;const e=ce.current,t=new IntersectionObserver(e=>{const t=e[0];!t||t.intersectionRatio>0||oe(pe.uri,!1)},{threshold:0,rootMargin:"0px"});return t.observe(e),()=>t.disconnect()},[fe,pe.uri,ie,oe]);const At=p.useCallback(()=>{le.current&&le.current.play().catch(()=>{})},[]),Pt=p.useCallback(()=>{le.current&&(le.current.pause(),le.current.currentTime=0)},[]),$t=p.useCallback(e=>{if(ct.current)return ct.current=!1,e.preventDefault(),void e.stopPropagation();ut.current||(I?I(pe.uri,{initialItem:N}):Z(`/post/${encodeURIComponent(pe.uri)}`))},[ct,ut,I,pe.uri,N,Z]),Mt=p.useCallback(()=>{I?I(pe.uri,{initialItem:N}):Z(`/post/${encodeURIComponent(pe.uri)}`)},[I,pe.uri,N,Z]),It=p.useCallback(()=>{ee?.did?Be?(Ee(void 0),c.deleteLike(Be).then(()=>{V?.(pe.uri,null)}).catch(()=>Ee(Be))):(Ee("pending"),c.like(pe.uri,pe.cid).then(e=>{Ee(e.uri),V?.(pe.uri,e.uri)}).catch(()=>Ee(void 0))):te()},[ee?.did,te,Be,pe.uri,pe.cid,V]),St=p.useCallback(e=>{if(e.stopPropagation(),pt.current)return;const t=Date.now();t-lt.current<400?(lt.current=0,It()):(lt.current=t,setTimeout(()=>Mt(),400))},[pt,lt,It,Mt]),Et=p.useCallback(e=>{ot.current=e,A&&("function"==typeof A?A(e):A.current=e)},[A]);return e.jsx("div",{ref:Et,"data-post-uri":pe.uri,className:`${W.card} ${T?W.cardSelected:""} ${Ge?W.cardTransFlag:""} ${!Ge&&De?W.cardLiked:""} ${!Ge&&Fe?W.cardInArtboard:""} ${Y&&!T?W.cardSeen:""} ${E?W.cardFillCell:""} ${re?W.cardArtOnly:""} ${ae?W.cardMinimalist:""}`,children:e.jsxs("div",{role:"button",tabIndex:0,className:W.cardLink,onClick:$t,onKeyDown:e=>{"Enter"===e.key&&(I?I(pe.uri,{initialItem:N}):Z(`/post/${encodeURIComponent(pe.uri)}`))},onTouchStart:e=>{ut.current=!0,pt.current=!0;const t=e.touches[0];mt.current=t?{x:t.clientX,y:t.clientY}:null},onTouchEnd:e=>{const t=mt.current;mt.current=null;const r=e.changedTouches[0];if((t&&r?Math.hypot(r.clientX-t.x,r.clientY-t.y):0)>12)return vt.current&&(clearTimeout(vt.current),vt.current=null),ut.current=!1,void(pt.current=!1);const a=Date.now();a-dt.current<400?(dt.current=0,ct.current=!0,vt.current&&(clearTimeout(vt.current),vt.current=null),e.preventDefault(),Be?(Ee(void 0),c.deleteLike(Be).then(()=>{V?.(pe.uri,null)}).catch(()=>Ee(Be))):(Ee("pending"),c.like(pe.uri,pe.cid).then(e=>{Ee(e.uri),V?.(pe.uri,e.uri)}).catch(()=>Ee(void 0))),setTimeout(()=>{ut.current=!1,pt.current=!1},500)):(dt.current=a,vt.current&&clearTimeout(vt.current),vt.current=setTimeout(()=>{vt.current=null,ut.current=!1,pt.current=!1,Mt()},400))},children:[e.jsxs("div",{ref:e=>{ce.current=e,!J||"text"!==ne&&(!fe||Rt&&jt.length>1)||J(0,e)},className:`${W.mediaWrap} ${E?W.mediaWrapFillCell:""} ${H?W.mediaWrapConstrained:""} ${Rt&&jt.length>1?W.mediaWrapMultiStack:""}`,style:E||H||Rt&&jt.length>1?void 0:{aspectRatio:fe?null!=ze?String(ze):bt?"1":void 0:"1"},onMouseEnter:At,onMouseLeave:Pt,...fe&&{onClick:St},children:[fe&&"text"!==ne?bt?e.jsx("div",{className:W.mediaVideoWrap,children:e.jsx("video",{ref:le,className:W.media,poster:_e.url||void 0,muted:!0,playsInline:!0,loop:!0,preload:"metadata",style:{aspectRatio:null!=ze?`${ze}`:void 0},onLoadedMetadata:e=>{const t=e.currentTarget;t.videoWidth&&t.videoHeight&&He(e=>null!=e?e:t.videoWidth/t.videoHeight)}})}):Rt&&jt.length>1?e.jsxs(e.Fragment,{children:[(()=>{const t=1/jt.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return e.jsx("div",{className:W.mediaWrapGridSpacer,style:{aspectRatio:String(t)},"aria-hidden":!0})})(),e.jsx("div",{className:W.mediaWrapGrid,children:e.jsx("div",{className:W.mediaGrid,style:{minHeight:0},children:jt.map((t,r)=>{const a=Ct[r]??r,n=q===a;return e.jsx("div",{ref:e=>J?.(a,e),className:`${W.mediaGridCell} ${n?W.mediaGridCellFocused:""}`,style:{flex:1/(t.aspectRatio||1)+" 1 0"},children:e.jsx(O,{src:t.url,alt:"",className:W.mediaGridImg,loading:"lazy",onLoad:0===r?Nt:void 0})},r)})})})]}):e.jsx(e.Fragment,{children:e.jsx(O,{src:Lt,alt:"",className:W.media,loading:"eager",onLoad:Nt})}):e.jsxs("div",{className:W.textOnlyPreview,children:[ke?e.jsx("div",{className:W.textOnlyPreviewText,onClick:e=>{e.stopPropagation(),$t(e)},children:e.jsx(C,{text:ke,facets:pe.record?.facets,maxLength:500,stopPropagation:!0,interactive:!1})}):null,ye?e.jsxs("a",{href:ye.uri,target:"_blank",rel:"noopener noreferrer",className:W.textOnlyPreviewLink,onClick:e=>e.stopPropagation(),children:[ye.thumb?e.jsx(O,{src:ye.thumb,alt:"",className:W.textOnlyPreviewLinkThumb,loading:"lazy"}):null,e.jsx("span",{className:W.textOnlyPreviewLinkTitle,children:ye.title}),ye.description?e.jsx("span",{className:W.textOnlyPreviewLinkDesc,children:ye.description}):null]}):null,ke||ye?null:e.jsx("span",{className:W.textOnlyPreviewEmpty,children:"Text post"})]}),G&&z&&fe&&e.jsx("div",{className:W.nsfwOverlay,onClick:e=>{e.preventDefault(),e.stopPropagation(),z(),Mt()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),z(),Mt())},role:"button",tabIndex:0,"aria-label":"Reveal sensitive content",children:e.jsx("span",{className:W.nsfwOverlayText,children:"NSFW"})})]}),(!re||ae)&&e.jsxs("div",{className:W.meta,children:[e.jsxs("div",{className:W.cardActionRow,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:W.cardActionRowCenter,children:[e.jsxs("div",{className:`${W.addWrap} ${Ue?W.addWrapOpen:""}`,ref:et,children:[e.jsx("button",{ref:rt,type:"button",className:`${W.addToBoardBtn} ${Fe?W.addToBoardBtnInCollection:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:e=>{e.preventDefault(),e.stopPropagation(),ee?.did?Ve(e=>!e):te()},"aria-label":"Collect","aria-expanded":Ue,children:e.jsx(F,{})}),Ue&&nt&&m.createPortal(e.jsxs("div",{ref:at,className:`${W.addDropdown} ${W.addDropdownFixed}`,style:{position:"fixed",bottom:nt.bottom,left:nt.left,transform:"translateX(-50%)",zIndex:1001},children:[0===xt.length?null:e.jsx(e.Fragment,{children:xt.map(t=>{const r=g(t.id,pe.uri),a=Xe.has(t.id);return e.jsxs("label",{className:W.addBoardLabel,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>!r&&wt(t.id),disabled:r,className:W.addBoardCheckbox}),e.jsx("span",{className:W.addBoardText,children:r?e.jsxs(e.Fragment,{children:["✓ ",t.name]}):t.name})]},t.id)})}),e.jsx("div",{className:W.addDropdownNew,children:e.jsx("input",{type:"text",placeholder:"New collection name",value:Je,onChange:e=>Ze(e.target.value),className:W.addBoardInput,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),gt())})}),e.jsx("div",{className:W.addDropdownActions,children:e.jsx("button",{type:"button",className:W.addBoardSubmit,onClick:gt,disabled:0===Xe.size&&!Je.trim(),children:"Add to selected"})})]}),document.body)]}),pe.author.avatar&&(Ae||!ee||Te?e.jsx(L,{handle:we,className:W.cardActionRowAvatar,onClick:e=>e.stopPropagation(),"aria-label":`View @${we} profile`,children:e.jsx(O,{src:pe.author.avatar,alt:"",loading:"lazy"})}):e.jsxs("button",{type:"button",className:`${W.cardActionRowAvatar} ${W.cardActionRowAvatarFollow}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:_t,disabled:Pe,"aria-label":`Follow @${we}`,title:`Follow @${we}`,children:[e.jsx(O,{src:pe.author.avatar,alt:"",loading:"lazy"}),e.jsx("span",{className:W.cardActionRowAvatarPlus,"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 8 8",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M4 2v4M2 4h4"})})})]})),e.jsx("button",{type:"button",className:`${W.cardLikeRepostBtn} ${De?W.cardLikeRepostBtnActive:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:ft,disabled:Oe,title:De?"Remove like":"Like","aria-label":De?"Remove like":"Like",children:De?"♥":"♡"})]}),e.jsxs("div",{className:W.cardActionRowRight,children:[pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=R(t);return"relative"===r.kind?e.jsx("span",{className:W.cardActionRowTime,title:j(t),"aria-hidden":!0,children:r.text}):e.jsxs("span",{className:`${W.cardActionRowTime} ${W.postTimeStacked}`,title:j(t),"aria-hidden":!0,children:[e.jsx("span",{className:W.postTimeMonth,children:r.month}),e.jsxs("span",{className:W.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})(),e.jsx(_,{postUri:pe.uri,postCid:pe.cid,authorDid:pe.author.did,rootUri:pe.uri,isOwnPost:Ae,compact:!0,verticalIcon:!0,className:W.cardActionsMenu,open:Ye,onOpenChange:e=>{Ke(e),K?.(e)},dropdownRef:Qe,feedLabel:he,postedAt:pe.record?.createdAt,onViewQuotes:se})]})]}),!ae&&e.jsx("div",{className:W.handleBlock,children:e.jsxs("div",{className:W.handleRow,children:[pe.author.avatar?e.jsx(O,{src:pe.author.avatar,alt:"",className:W.authorAvatar,loading:"lazy"}):pe.author.did?e.jsx("span",{className:W.authorAvatarPlaceholder,"aria-hidden":!0,children:(we||pe.author.did).slice(0,1).toUpperCase()}):null,e.jsxs("span",{className:W.handleRowMain,children:[e.jsx("span",{className:Be?W.handleLinkWrapLiked:W.handleLinkWrap,children:e.jsxs(L,{handle:we,className:W.handleLink,onClick:e=>e.stopPropagation(),children:["@",we]})}),(ge||be)&&e.jsx("span",{className:W.repostIconLink,role:"button",tabIndex:0,title:ge?`Reposted by @${ge}`:"Quote post","aria-label":ge?`Reposted by @${ge}`:"Quote post",onClick:e=>{e.stopPropagation(),$t(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),Mt())},children:e.jsx(B,{})})]}),e.jsxs("span",{className:W.handleRowMeta,children:[Re&&e.jsx("span",{className:W.pinIconWrap,title:"Pinned",children:e.jsx(D,{})}),pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=R(t);return"relative"===r.kind?e.jsx("span",{className:W.postTime,title:j(t),children:r.text}):e.jsxs("span",{className:`${W.postTime} ${W.postTimeStacked}`,title:j(t),children:[e.jsx("span",{className:W.postTimeMonth,children:r.month}),e.jsxs("span",{className:W.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})()]})]})}),!ae&&fe&&ke?e.jsx("p",{className:W.text,onClick:e=>{e.stopPropagation(),$t(e)},children:e.jsx(C,{text:ke,facets:pe.record?.facets,maxLength:80,stopPropagation:!0,interactive:!1})}):null]})]})})},(e,t)=>{if(e.item.post.uri!==t.item.post.uri)return!1;if(e.isSelected!==t.isSelected)return!1;if(e.likedUriOverride!==t.likedUriOverride)return!1;if(e.seen!==t.seen)return!1;if(e.nsfwBlurred!==t.nsfwBlurred)return!1;if(e.fillCell!==t.fillCell)return!1;if(e.constrainMediaHeight!==t.constrainMediaHeight)return!1;if(e.openAddDropdown!==t.openAddDropdown)return!1;if(e.cardIndex!==t.cardIndex)return!1;if(e.actionsMenuOpenForIndex!==t.actionsMenuOpenForIndex)return!1;if(e.focusedMediaIndex!==t.focusedMediaIndex)return!1;if(e.item.post.cid!==t.item.post.cid)return!1;if(e.item.post.likeCount!==t.item.post.likeCount)return!1;return e.item.post.repostCount===t.item.post.repostCount});export{G as P};
