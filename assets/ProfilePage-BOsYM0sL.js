import{g as e,b as t,D as s,j as l,y as n,E as o,C as a,F as i,G as r,H as c,I as d,J as u,u as m,K as p,L as h,M as f,N as x,l as g,O as b,P as w,Q as v,R as j,e as y,w as N,S as _,i as k,x as C,T as B,U as S}from"./index-DO5u49Z-.js";import{r as F,a as $,L,h as A}from"./react-vendor-rw3WIpbI.js";import{u as M}from"./ModalTopBarSlotContext-BCMHq62N.js";import{setInitialPostForUri as P}from"./postCache-CTqU0alO.js";import{f as R,a as E,b as D}from"./date-Ct-NsrQr.js";import{P as I}from"./PostCard-MzAp_gv-.js";import{p as T,V as U}from"./VirtualizedProfileColumn-CyHgUOst.js";import{u as H}from"./ModalScrollContext-CCpHgC4Z.js";import{P as z}from"./PostText-XS6fYKXV.js";import{L as O}from"./Layout-i5XBa1yz.js";import{E as W,a as V,b as q}from"./Icons-_AhCYSE3.js";import{p as K}from"./PostDetailPage.module-D-5kOdq6.js";import"./atproto-JNpM3I1p.js";import"./PostActionsMenu-DDncNYIT.js";import"./artboards-DNvSVVrd.js";import"./artboardsPds-DWUixJ9h.js";import"./virtual-SmD9oKU4.js";const G="_wrap_nsdzb_1",Y="_trigger_nsdzb_9",J="_dropdown_nsdzb_40",Q="_label_nsdzb_57",X="_profileMeta_nsdzb_65",Z="_profileMetaLine_nsdzb_73",ee="_feedbackSuccess_nsdzb_82",te="_feedbackError_nsdzb_90",se="_item_nsdzb_98";function le({profileDid:a,profileHandle:i,isOwnProfile:r,isFollowing:c,hideRepostsFromThisUser:d,onToggleHideReposts:u,className:m}){const p=e(),[h,f]=F.useState(!1),[x,g]=F.useState(null),[b,w]=F.useState(null),[v,j]=F.useState("idle"),[y,N]=F.useState(null),[_,k]=F.useState(null),C=F.useRef(null),B=F.useRef(null);function S(e){w({type:"success",message:e}),setTimeout(()=>{f(!1),w(null)},1500)}function $(e){w({type:"error",message:e})}F.useEffect(()=>{h||j("idle")},[h]),F.useEffect(()=>{if(!h)return;const l=e()?t:s;let n=!1;return l.getProfile({actor:a}).then(e=>{if(n)return;const t=e.data;N(t.viewer?.blocking??null),k({createdAt:t.createdAt??void 0,indexedAt:t.indexedAt??void 0})}).catch(()=>{n||(N(null),k(null))}),()=>{n=!0}},[h,a]),F.useEffect(()=>{if(!h)return;const e=e=>{C.current?.contains(e.target)||f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[h]),F.useEffect(()=>{if(!h)return;const e=e=>{if("Escape"===e.key||"q"===e.key)return e.preventDefault(),void("confirm"===v?j("idle"):f(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[h,v]);const L=!!p?.did&&!r;return l.jsxs("div",{ref:C,className:`${G} ${m??""}`,children:[l.jsx("button",{type:"button",className:Y,onClick:e=>{e.preventDefault(),e.stopPropagation(),f(!h)},"aria-expanded":h,"aria-haspopup":"true","aria-label":"Profile options",title:"Profile options",children:l.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[l.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor"})]})}),h&&l.jsx("div",{ref:B,className:J,role:"menu",children:b?l.jsx("div",{className:"success"===b.type?ee:te,role:"status",children:b.message}):"confirm"===v?l.jsxs(l.Fragment,{children:[l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),j("idle")},role:"menuitem",children:"← Back"}),l.jsxs("div",{className:Q,children:["Block @",i,"?"]}),l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){if(p?.did&&!r){g("block"),w(null);try{const{uri:e}=await n(a);N(e),j("idle"),S("Account blocked")}catch{$("Could not block. Try again.")}finally{g(null)}}}()},disabled:"block"===x,role:"menuitem",children:"block"===x?"…":"Yes, block"})]}):l.jsxs(l.Fragment,{children:[L&&(y?l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),async function(){if(y){g("unblock"),w(null);try{await o(y),N(null),S("Account unblocked")}catch{$("Could not unblock. Try again.")}finally{g(null)}}}()},disabled:"unblock"===x,role:"menuitem",children:"unblock"===x?"…":"Unblock account"}):l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),j("confirm")},role:"menuitem",children:"Block user"})),c&&u&&l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),u()},role:"menuitem",children:d?`Show reposts from @${i}`:`Don't show reposts from @${i}`}),l.jsx("button",{type:"button",className:se,onClick:e=>{e.preventDefault(),e.stopPropagation(),function(){const e=`${"undefined"!=typeof window?window.location.origin+"/artsky-dev/".replace(/\/$/,""):""}/profile/${encodeURIComponent(i)}`;navigator.clipboard.writeText(e).then(()=>S("Link copied"),()=>$("Could not copy link"))}()},role:"menuitem",children:"Copy profile link"}),_&&(_.createdAt||_.indexedAt)&&l.jsxs("div",{className:X,role:"status",children:[_.createdAt&&l.jsxs("p",{className:Z,title:R(_.createdAt),children:["Account created: ",R(_.createdAt)]}),_.indexedAt&&(!_.createdAt||new Date(_.indexedAt).getTime()-new Date(_.createdAt).getTime()>6e4)&&l.jsxs("p",{className:Z,title:R(_.indexedAt),children:["Profile last updated: ",R(_.indexedAt)]})]})]})})]})}const ne="_overlay_9nbtm_1",oe="_pane_9nbtm_18",ae="_topBar_9nbtm_30",ie="_title_9nbtm_39",re="_closeBtn_9nbtm_46",ce="_scroll_9nbtm_67",de="_loading_9nbtm_76",ue="_error_9nbtm_77",me="_empty_9nbtm_78",pe="_section_9nbtm_89",he="_sectionTitle_9nbtm_97",fe="_addWordForm_9nbtm_106",xe="_addWordInput_9nbtm_117",ge="_addWordOptions_9nbtm_139",be="_durationLabel_9nbtm_146",we="_durationSelect_9nbtm_151",ve="_excludeFollowingLabel_9nbtm_161",je="_excludeFollowingCheckbox_9nbtm_170",ye="_addWordBtn_9nbtm_176",Ne="_wordRow_9nbtm_197",_e="_wordMeta_9nbtm_213",ke="_wordMetaBadges_9nbtm_221",Ce="_durationBadge_9nbtm_229",Be="_excludeBadge_9nbtm_235",Se="_list_9nbtm_242",Fe="_row_9nbtm_248",$e="_label_9nbtm_264",Le="_actionBtn_9nbtm_273",Ae=[{value:"24h",label:"24 hours"},{value:"7d",label:"7 days"},{value:"30d",label:"30 days"},{value:"forever",label:"Forever"}];function Me(e){if("forever"===e)return;const t=new Date;return"24h"===e?t.setHours(t.getHours()+24):"7d"===e?t.setDate(t.getDate()+7):"30d"===e&&t.setDate(t.getDate()+30),t.toISOString()}function Pe(e){if(!e)return"Forever";const t=new Date(e),s=Date.now(),l=t.getTime()-s;if(l<=0)return"Expired";const n=Math.round(l/36e5);if(n<24)return`${n}h`;const o=Math.round(l/864e5);return o<=30?`${o} days`:e.slice(0,10)}function Re({onClose:e}){const t=a(),[s,n]=F.useState([]),[m,p]=F.useState([]),[h,f]=F.useState([]),[x,g]=F.useState(!0),[b,w]=F.useState(null),[v,j]=F.useState(null),[y,N]=F.useState(""),[_,k]=F.useState("forever"),[C,B]=F.useState(!0),[S,$]=F.useState(!1);F.useEffect(()=>(t?.lockScroll(),()=>t?.unlockScroll()),[t]);return F.useEffect(()=>{g(!0),j(null),Promise.all([i(),r(),c()]).then(([e,t,s])=>{n(e),p(t),f(s)}).catch(e=>j(e instanceof Error?e.message:"Failed to load")).finally(()=>g(!1))},[]),l.jsx("div",{className:ne,role:"dialog","aria-modal":"true","aria-labelledby":"blocked-muted-title",onClick:e,children:l.jsxs("div",{className:oe,onClick:e=>e.stopPropagation(),children:[l.jsxs("div",{className:ae,children:[l.jsx("h2",{id:"blocked-muted-title",className:ie,children:"Blocked & muted"}),l.jsx("button",{type:"button",className:re,onClick:e,"aria-label":"Close",children:"×"})]}),l.jsx("div",{className:ce,children:x?l.jsx("p",{className:de,children:"Loading…"}):v?l.jsx("p",{className:ue,children:v}):l.jsxs(l.Fragment,{children:[l.jsxs("section",{className:pe,children:[l.jsx("h3",{className:he,children:"Blocked accounts"}),0===s.length?l.jsx("p",{className:me,children:"No blocked accounts."}):l.jsx("ul",{className:Se,children:s.map(e=>l.jsxs("li",{className:Fe,children:[l.jsxs("span",{className:$e,children:[e.displayName?`${e.displayName} `:"","@",e.handle??e.did]}),l.jsx("button",{type:"button",className:Le,onClick:()=>async function(e){w(e);try{await o(e),n(t=>t.filter(t=>t.blockUri!==e))}catch{j("Could not unblock")}finally{w(null)}}(e.blockUri),disabled:b===e.blockUri,children:b===e.blockUri?"…":"Unblock"})]},e.blockUri))})]}),l.jsxs("section",{className:pe,children:[l.jsx("h3",{className:he,children:"Muted accounts"}),0===m.length?l.jsx("p",{className:me,children:"No muted accounts."}):l.jsx("ul",{className:Se,children:m.map(e=>l.jsxs("li",{className:Fe,children:[l.jsxs("span",{className:$e,children:[e.displayName?`${e.displayName} `:"","@",e.handle]}),l.jsx("button",{type:"button",className:Le,onClick:()=>async function(e){w(e);try{await d(e),p(t=>t.filter(t=>t.did!==e))}catch{j("Could not unmute")}finally{w(null)}}(e.did),disabled:b===e.did,children:b===e.did?"…":"Unmute"})]},e.did))})]}),l.jsxs("section",{className:pe,children:[l.jsx("h3",{className:he,children:"Muted words"}),l.jsxs("form",{className:fe,onSubmit:async function(e){e.preventDefault();const t=y.trim();if(t&&!S){$(!0),j(null);try{const e={value:t,targets:["content","tag"],actorTarget:C?"exclude-following":"all",expiresAt:Me(_)},s=[...h,e];await u(s),f(s),N("")}catch{j("Could not add muted word")}finally{$(!1)}}},children:[l.jsx("input",{type:"text",className:xe,placeholder:"Word or phrase to mute",value:y,onChange:e=>N(e.target.value),maxLength:100,"aria-label":"Word or phrase to mute"}),l.jsxs("div",{className:ge,children:[l.jsx("label",{className:be,children:"Duration:"}),l.jsx("select",{className:we,value:_,onChange:e=>k(e.target.value),"aria-label":"Mute duration",children:Ae.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))}),l.jsxs("label",{className:ve,children:[l.jsx("input",{type:"checkbox",checked:C,onChange:e=>B(e.target.checked),className:je}),l.jsx("span",{children:"Exclude people I follow"})]})]}),l.jsx("button",{type:"submit",className:ye,disabled:!y.trim()||S,children:S?"…":"Add muted word"})]}),0===h.length?l.jsx("p",{className:me,children:"No muted words yet."}):l.jsx("ul",{className:Se,children:h.map((e,t)=>l.jsxs("li",{className:Ne,children:[l.jsxs("div",{className:_e,children:[l.jsx("span",{className:$e,children:e.value}),l.jsxs("span",{className:ke,children:[l.jsx("span",{className:Ce,children:Pe(e.expiresAt)}),"exclude-following"===e.actorTarget&&l.jsx("span",{className:Be,children:"Exclude following"})]})]}),l.jsx("button",{type:"button",className:Le,onClick:()=>async function(e){w(e.value);try{const t=h.filter(t=>t.value!==e.value||t.id!==e.id);await u(t),f(t)}catch{j("Could not remove word")}finally{w(null)}}(e),disabled:b===e.value,children:b===e.value?"…":"Remove"})]},e.id??e.value+t))})]})]})})]})})}const Ee="_backdrop_tp1vi_1",De="_panel_tp1vi_12",Ie="_header_tp1vi_25",Te="_title_tp1vi_34",Ue="_count_tp1vi_41",He="_closeBtn_tp1vi_46",ze="_toolbar_tp1vi_65",Oe="_searchInput_tp1vi_73",We="_sortByLabel_tp1vi_95",Ve="_sortSelect_tp1vi_101",qe="_orderToggleBtn_tp1vi_117",Ke="_orderArrow_tp1vi_142",Ge="_body_tp1vi_147",Ye="_loading_tp1vi_154",Je="_empty_tp1vi_155",Qe="_list_tp1vi_161",Xe="_item_tp1vi_167",Ze="_rowBtn_tp1vi_171",et="_avatar_tp1vi_195",tt="_avatarPlaceholder_tp1vi_203",st="_info_tp1vi_217",lt="_displayName_tp1vi_223",nt="_handle_tp1vi_231",ot="_dateLabel_tp1vi_239",at="_loadMoreWrap_tp1vi_245",it="_loadMoreBtn_tp1vi_250";function rt({mode:e,actor:t,onClose:n,viewerDid:o,authenticatedClient:a}){const{openProfileModal:i}=m(),[r,c]=F.useState([]),[d,u]=F.useState(),[g,b]=F.useState(!0),[w,v]=F.useState(!1),[j,y]=F.useState(""),[N,_]=F.useState("handle"),[k,C]=F.useState("asc"),B=F.useCallback(async l=>{const n=!l;n?b(!0):v(!0);try{if("mutuals"===e){const{list:e}=await p(s,t);c(e),u(void 0)}else if("followedByFollows"===e&&o&&a){const{list:e}=await h(a,o,t);c(e),u(void 0)}else{const o="followers"===e?f:x,{list:a,cursor:i}=await o(s,t,{limit:50,cursor:l});c(e=>n?a:[...e,...a]),u(i)}}catch{n&&c([])}finally{b(!1),v(!1)}},[t,e,o,a]);F.useEffect(()=>{if(!("followedByFollows"!==e||o&&a))return b(!1),void c([]);B()},[B,e,o,a]);const S=F.useMemo(()=>{const e=j.trim().toLowerCase();let t=e?r.filter(t=>(t.handle??"").toLowerCase().includes(e)||(t.displayName??"").toLowerCase().includes(e)):[...r];const s=(e,t)=>(e.handle??e.did).localeCompare(t.handle??t.did),l="handle"===N?s:"displayName"===N?(e,t)=>(e.displayName??e.handle??"").localeCompare(t.displayName??t.handle??"")||s(e,t):(e,t)=>(e.indexedAt?new Date(e.indexedAt).getTime():0)-(t.indexedAt?new Date(t.indexedAt).getTime():0);return t.sort((e,t)=>"asc"===k?l(e,t):l(t,e)),t},[r,j,N,k]),L=F.useCallback(()=>{!d||w||g||B(d)},[d,B,g,w]),A=F.useCallback(e=>{e.target===e.currentTarget&&n()},[n]);return $.createPortal(l.jsx("div",{className:Ee,role:"dialog","aria-modal":"true","aria-labelledby":"follow-list-title",onClick:A,children:l.jsxs("div",{className:De,onClick:e=>e.stopPropagation(),children:[l.jsxs("div",{className:Ie,children:[l.jsxs("h2",{id:"follow-list-title",className:Te,children:["followers"===e?"Followers":"following"===e?"Following":"followedByFollows"===e?"People you follow who follow this account":"Mutuals",r.length>0&&!g&&l.jsxs("span",{className:Ue,children:[" (",r.length,"mutuals"!==e&&"followedByFollows"!==e&&null!=d?"+":"",")"]})]}),l.jsx("button",{type:"button",className:He,onClick:n,"aria-label":"Close",children:"×"})]}),l.jsxs("div",{className:ze,children:[l.jsx("input",{type:"search",className:Oe,placeholder:"Search by username or name…",value:j,onChange:e=>y(e.target.value),"aria-label":"Search list"}),l.jsxs("span",{className:We,"aria-hidden":!0,children:["Sort By:"," "]}),l.jsxs("select",{className:Ve,value:N,onChange:e=>_(e.target.value),"aria-label":"Sort by",children:[l.jsx("option",{value:"handle",children:"Username"}),l.jsx("option",{value:"displayName",children:"Display name"}),l.jsx("option",{value:"date",children:"Date followed"})]}),l.jsx("button",{type:"button",className:qe,onClick:()=>C(e=>"asc"===e?"desc":"asc"),"aria-label":"asc"===k?"Ascending; click for descending":"Descending; click for ascending",title:"asc"===k?"Ascending (click for descending)":"Descending (click for ascending)",children:"asc"===k?l.jsx("svg",{className:Ke,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:l.jsx("path",{d:"M18 15l-6-6-6 6"})}):l.jsx("svg",{className:Ke,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:l.jsx("path",{d:"M6 9l6 6 6-6"})})})]}),l.jsxs("div",{className:Ge,children:[g&&0===r.length?l.jsx("p",{className:Ye,children:"Loading…"}):0===S.length?l.jsx("p",{className:Je,children:j.trim()?"No matches.":"followers"===e?"No followers.":"following"===e?"Not following anyone.":"followedByFollows"===e?"None of the people you follow follow this account.":"No mutuals."}):l.jsx("ul",{className:Qe,children:S.map(t=>l.jsx("li",{className:Xe,children:l.jsxs("button",{type:"button",className:Ze,onClick:()=>{i(t.handle??t.did),n()},children:[t.avatar?l.jsx("img",{src:t.avatar,alt:"",className:et,loading:"lazy"}):l.jsx("span",{className:tt,"aria-hidden":!0,children:(t.displayName??t.handle??t.did).slice(0,1).toUpperCase()}),l.jsxs("span",{className:st,children:[t.displayName&&l.jsx("span",{className:lt,children:t.displayName}),l.jsxs("span",{className:nt,children:["@",t.handle??t.did]}),t.indexedAt&&l.jsxs("span",{className:ot,children:["followers"===e?"Follower since ":"following"===e?"Following since ":"Mutual since ",new Date(t.indexedAt).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})]})]})]})},t.did))}),d&&"mutuals"!==e&&"followedByFollows"!==e&&r.length>0&&!g&&l.jsx("div",{className:at,children:l.jsx("button",{type:"button",className:it,onClick:L,disabled:w,children:w?"Loading…":"Load more"})})]})]})}),document.body)}const ct=["1","2","3"];function dt(e){const t=y(e.post);return t?null!=t.aspectRatio&&t.aspectRatio>0?100+280/t.aspectRatio:320:180}function ut(e,t){if(t<1)return[];const s=Array.from({length:t},()=>[]),l=Array(t).fill(0);for(let n=0;n<e.length;n++){const o=e[n],a=dt(o),i=s.map(e=>e.length),r=0===i.length?0:Math.min(...i);let c=-1;for(let e=0;e<t;e++)s[e].length>r+1||(-1===c||l[e]<l[c]||l[e]===l[c]&&s[e].length<s[c].length)&&(c=e);-1===c&&(c=0),s[c].push({item:o,originalIndex:n}),l[c]+=a}return s}function mt({cols:e}){const t=12,s=1===e?4:(14-2*(e-1))/e;return l.jsxs("svg",{width:14,height:t,viewBox:"0 0 14 12",fill:"currentColor","aria-hidden":!0,children:[1===e&&l.jsx("rect",{x:(14-s)/2,y:0,width:s,height:t,rx:1}),2===e&&l.jsxs(l.Fragment,{children:[l.jsx("rect",{x:0,y:0,width:s,height:t,rx:1}),l.jsx("rect",{x:s+2,y:0,width:s,height:t,rx:1})]}),3===e&&l.jsxs(l.Fragment,{children:[l.jsx("rect",{x:0,y:0,width:s,height:t,rx:1}),l.jsx("rect",{x:s+2,y:0,width:s,height:t,rx:1}),l.jsx("rect",{x:2*(s+2),y:0,width:s,height:t,rx:1})]})]})}function pt({mode:e}){return"sfw"===e?l.jsx(W,{size:24}):"blurred"===e?l.jsx(V,{size:24}):l.jsx(q,{size:24})}function ht({handle:n,openProfileModal:o,inModal:a=!1,onRegisterRefresh:i}){const[r,c]=F.useState("posts"),[d,u]=F.useState("all"),[p,f]=F.useState([]),[x,A]=F.useState(),[R,O]=F.useState([]),[W,V]=F.useState(),[q,G]=F.useState([]),[Y,J]=F.useState([]),[Q,X]=F.useState(),[Z,ee]=F.useState(!0),[te,se]=F.useState(!1),[ne,oe]=F.useState(null),[ae,ie]=F.useState(null),[re,ce]=F.useState(!1),[de,ue]=F.useState(null),[me,pe]=F.useState(null),[he,fe]=F.useState(!1),xe=e(),{viewMode:ge,setViewMode:be}=g(),we=xe?t:s,ve=F.useRef(null),je=F.useRef([]),ye=F.useRef(!1),[Ne]=F.useState(!0),[_e,ke]=F.useState(0),[Ce,Be]=F.useState(!1),[Se,Fe]=F.useState(null),[$e,Le]=F.useState(!1),[Ae,Me]=F.useState(null),[Pe,Ee]=F.useState(null),[,De]=F.useState(!1),[Ie,Te]=F.useState({}),{openPostModal:Ue,isModalOpen:He}=m(),ze=H(),Oe=F.useRef(null),[We,Ve]=F.useState(0),qe=b(),Ke=M(),Ge=Ke?.rightSlot??null,Ye=qe?.openEditProfile??(()=>{}),Je=qe?.editSavedVersion??0,Qe=F.useRef([]),Xe=F.useRef(0),Ze=F.useRef([]),et=F.useRef(!1),tt=F.useRef(-1),st=F.useRef(!1);F.useEffect(()=>{n&&we.getProfile({actor:n}).then(e=>{const t=e.data;ie({displayName:t.displayName,avatar:t.avatar,description:t.description,did:t.did,viewer:t.viewer,verification:t.verification})}).catch(()=>{})},[n,we,Je]),F.useEffect(()=>{xe&&ae?xe.did!==ae.did&&w().then(e=>pe(e.some(e=>e.did===ae.did))).catch(()=>pe(null)):pe(null)},[xe,ae?.did]),F.useEffect(()=>{if(!xe||!ae||xe.did===ae.did)return Ee(null),void De(!1);De(!0);let e=!1;const t=setTimeout(()=>{e||De(!1)},12e3),s=B();return h(s,xe.did,ae.did,{limit:30}).then(({list:t})=>{e||Ee(t)}).catch(()=>{e||Ee([])}).finally(()=>{e||De(!1)}),()=>{e=!0,clearTimeout(t)}},[xe?.did,ae?.did]);const lt=F.useCallback(async e=>{if(n)try{e?se(!0):ee(!0),oe(null);const t=await we.getAuthorFeed({actor:n,limit:30,cursor:e,includePins:!0});f(s=>e?[...s,...t.data.feed]:t.data.feed),A(t.data.cursor??void 0)}catch(t){oe(t instanceof Error?t.message:"Failed to load profile")}finally{ee(!1),se(!1)}},[n,we]),nt=F.useCallback(async()=>{if(n)try{ee(!0),oe(null);const e=await v(n,50);G(e)}catch(e){oe(e instanceof Error?e.message:"Failed to load feeds"),G([])}finally{ee(!1)}},[n]),ot=F.useCallback(async e=>{if(n&&ae?.did)try{e?se(!0):ee(!0),oe(null);const{documents:t,cursor:s}=await j(we,ae.did,n,{cursor:e});J(s=>e?[...s,...t]:t),X(s)}catch(t){oe(t instanceof Error?t.message:"Failed to load blog")}finally{ee(!1),se(!1)}},[n,ae?.did,we]),at=F.useCallback(async e=>{if(n&&xe&&ae&&xe.did===ae.did)try{e?se(!0):ee(!0),oe(null);const s=await t.getActorLikes({actor:n,limit:30,cursor:e}),l=s.data.feed??[];O(t=>e?[...t,...l]:l),V(s.data.cursor??void 0)}catch(s){oe(s instanceof Error?s.message:"Failed to load liked posts")}finally{ee(!1),se(!1)}},[n,ae?.did,xe?.did]);F.useEffect(()=>{n&&(ie(null),ue(null),c("posts"),u("all"),O([]),V(void 0),lt())},[n,lt]),F.useEffect(()=>{"liked"===d&&n&&xe&&ae&&xe.did===ae.did&&at()},[d,n,ae?.did,xe?.did,at]),F.useEffect(()=>{"feeds"===r&&nt()},[r,nt]),F.useEffect(()=>{"blog"===r&&ae?.did&&ot()},[r,ae?.did,ot]),F.useEffect(()=>{i?.(async()=>{await lt(),await nt(),await ot(),await at()})},[i,lt,nt,ot,at]),ye.current=te;const it="1"===ge?1:"2"===ge?2:3,dt="posts"===r&&"liked"===d?W:x,ht="posts"===r&&"liked"===d?e=>at(e):lt;F.useEffect(()=>{if("posts"!==r&&"reposts"!==r)return;if(!dt)return;const e=it>=2?je.current[0]:ve.current,t=a?e?.closest("[data-modal-scroll]")??null:null;let s=0;const l=new IntersectionObserver(e=>{for(const t of e)if(t.isIntersecting&&!ye.current){ye.current=!0,ht(dt);break}},{root:t??void 0,rootMargin:"800px",threshold:0});if(it>=2){const e=je.current;for(let t=0;t<it;t++){const s=e[t];s&&l.observe(s)}s=window.setTimeout(()=>{if(ye.current)return;const s=t?t.getBoundingClientRect().bottom:window.innerHeight;for(let t=0;t<it;t++){const l=e[t];if(l&&l.getBoundingClientRect().bottom<s)return ye.current=!0,void ht(dt)}},200)}else{const e=ve.current;e&&l.observe(e)}return()=>{l.disconnect(),clearTimeout(s)}},[r,d,dt,lt,at,ht,a,it]);const ft=ae?.viewer?.following??de,xt=!!ft,gt=!!xe&&!!ae&&xe.did===ae.did,bt=!!xe&&!!ae&&!gt,wt=e=>"app.bsky.feed.defs#reasonRepost"===e.reason?.$type,vt=e=>"app.bsky.feed.defs#reasonPin"===e.reason?.$type,jt=e=>{const t=e.post?.embed;return!!t&&("app.bsky.embed.record#view"===t.$type||"app.bsky.embed.recordWithMedia#view"===t.$type)},yt=e=>wt(e)||jt(e),Nt="liked"===d?R:p,_t="posts"===r?"liked"===d?R:Nt.filter(e=>!(wt(e)||jt(e)&&!y(e.post))):"reposts"===r?p.filter(yt):"text"===r?Nt:p,kt="posts"===r?[..._t].sort((e,t)=>(vt(t)?1:0)-(vt(e)?1:0)):_t,{nsfwPreference:Ct,cycleNsfwPreference:Bt,unblurredUris:St,setUnblurred:Ft}=N(),$t=kt.filter(e=>_(e.post)).filter(e=>"sfw"!==Ct||!k(e.post)),Lt=$t,At=F.useMemo(()=>{const e="liked"===d?R:p,t="liked"===d?e:e.filter(e=>!(wt(e)||jt(e)&&!y(e.post))).filter(e=>_(e.post)).filter(e=>"sfw"!==Ct||!k(e.post)),s=p.filter(yt).filter(e=>_(e.post)).filter(e=>"sfw"!==Ct||!k(e.post)),l=e.filter(e=>!wt(e)).filter(e=>{const t=e.post.record?.text?.trim()??"",s=_(e.post),l=!!e.post.record?.reply;return t.length>0&&!s&&!l});return{posts:t.length>0,reposts:s.length>0,blog:Y.length>0,text:l.length>0,feeds:q.length>0}},[p,R,d,Y,q,Ct]),Mt=F.useMemo(()=>{const e=[];return(At.posts||gt)&&e.push("posts"),At.reposts&&e.push("reposts"),At.blog&&e.push("blog"),At.text&&e.push("text"),At.feeds&&e.push("feeds"),e},[At,gt]);F.useEffect(()=>{Z||0===Mt.length||Mt.includes(r)||c(Mt[0])},[Z,Mt,r]);const Pt="1"===ge?1:"2"===ge?2:3;Ze.current=Lt,Xe.current=_e,F.useLayoutEffect(()=>{if(a||!Oe.current)return;const e=Oe.current,t=()=>Ve(e.getBoundingClientRect().top+window.scrollY);t();const s=new ResizeObserver(t);return s.observe(e),()=>s.disconnect()},[a,Lt.length]),F.useEffect(()=>{ke(e=>Lt.length?Math.min(e,Lt.length-1):0)},[Lt.length]),F.useEffect(()=>{if(!et.current)return;if(et.current=!1,_e===tt.current)return;tt.current=_e;const e=_e,t=requestAnimationFrame(()=>{const t=Qe.current[e];t&&t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});return()=>cancelAnimationFrame(t)},[_e]),F.useEffect(()=>{const e=e=>{if(!a&&He)return;const s=e.target;if("INPUT"===s.tagName||"TEXTAREA"===s.tagName||"SELECT"===s.tagName||s.isContentEditable)return void("Escape"===e.key&&(e.preventDefault(),s.blur()));if(e.ctrlKey||e.metaKey)return;if(!("posts"===r||"reposts"===r))return;const l=Ze.current;if(0===l.length)return;const n=Xe.current,o=e.key.toLowerCase();if("w"!==o&&"s"!==o&&"a"!==o&&"d"!==o&&"e"!==o&&"enter"!==o&&"f"!==o&&"c"!==o&&"m"!==o&&"`"!==o&&"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.preventDefault(),"w"!==o&&"ArrowUp"!==e.key)if("s"!==o&&"ArrowDown"!==e.key)if("a"!==o&&"ArrowLeft"!==e.key)if("d"!==o&&"ArrowRight"!==e.key){if(("m"===o||"`"===o)&&n>=0){return void Fe(Se===n?null:n)}if("e"===o||"enter"===o){const e=l[n];return void(e&&Ue(e.post.uri))}if("f"===o){const e=l[n];if(!e?.post?.uri||!e?.post?.cid)return;const s=e.post.uri,o=s in Ie?Ie[s]??void 0:e.post.viewer?.like;return void(o?t.deleteLike(o).then(()=>{Te(e=>({...e,[s]:null}))}).catch(()=>{}):t.like(s,e.post.cid).then(e=>{Te(t=>({...t,[s]:e.uri}))}).catch(()=>{}))}"c"===o&&Be(!0)}else if(st.current=!1,et.current=!0,Fe(null),Pt>=2){const e=ut(l,Pt);ke(t=>function(e,t){for(let s=0;s<e.length;s++){const l=e[s].findIndex(e=>e.originalIndex===t);if(l<0)continue;if(s===e.length-1)return t;const n=e[s+1];return l<n.length?n[l].originalIndex:t}return t}(e,t))}else ke(e=>Math.min(l.length-1,e+1));else if(st.current=!1,et.current=!0,Fe(null),Pt>=2){const e=ut(l,Pt);ke(t=>function(e,t){for(let s=0;s<e.length;s++){const l=e[s].findIndex(e=>e.originalIndex===t);if(l<0)continue;if(0===s)return t;const n=e[s-1];return l<n.length?n[l].originalIndex:t}return t}(e,t))}else ke(e=>Math.max(0,e-1));else if(st.current=!1,et.current=!0,Pt>=2){const e=ut(l,Pt);ke(t=>function(e,t){for(let s=0;s<e.length;s++){const l=e[s].findIndex(e=>e.originalIndex===t);if(l>=0&&l<e[s].length-1)return e[s][l+1].originalIndex;if(l>=0)return t}return t}(e,t))}else ke(e=>Math.min(l.length-1,e+1));else if(st.current=!1,et.current=!0,Pt>=2){const e=ut(l,Pt);ke(t=>function(e,t){for(let s=0;s<e.length;s++){const l=e[s].findIndex(e=>e.originalIndex===t);if(l>0)return e[s][l-1].originalIndex;if(0===l)return t}return t}(e,t))}else ke(e=>Math.max(0,e-1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,Pt,He,Ue,a,Ie,Se]),F.useEffect(()=>{const e=()=>{st.current=!0};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]);const Rt=kt.filter(e=>{return(t=e.post,t.record?.text?.trim()??"").length>0&&!_(e.post)&&!(e=>!!e.record?.reply)(e.post);var t});const Et=C(),Dt=!!ae&&Et?.isHidingRepostsFrom(ae.did),It=!!xe&&!!ae&&!gt&&xt;return l.jsx(l.Fragment,{children:l.jsxs("div",{className:`${T.wrap} ${a?T.wrapInModal:""}`,children:[l.jsxs("header",{className:T.profileHeader,children:[l.jsxs("div",{className:T.profileHeaderMain,children:[ae?.avatar&&l.jsx("img",{src:ae.avatar,alt:"",className:T.avatar,loading:"lazy"}),l.jsxs("div",{className:T.profileMeta,children:[ae?.displayName&&l.jsx("h2",{className:T.displayName,children:ae.displayName}),l.jsxs("div",{className:T.handleRow,children:[l.jsxs("p",{className:T.handle,children:["@",n]}),gt&&l.jsxs(l.Fragment,{children:[l.jsx("button",{type:"button",className:T.followBtn,onClick:Ye,title:"Edit profile",children:"Edit profile"}),l.jsx("button",{type:"button",className:T.blockedMutedBtn,onClick:()=>Le(!0),title:"View blocked accounts and muted words",children:"Blocked & muted"}),l.jsx("div",{className:T.postsFilterRow,role:"group","aria-label":"Filter posts",children:l.jsx("button",{type:"button",className:`${T.postsFilterBtn} ${T.postsFilterBtnInHeader} ${"liked"===d?T.postsFilterBtnActive:""}`,onClick:()=>{u(e=>"liked"===e?"all":"liked"),c("posts")},title:"liked"===d?"Show my posts":"Show liked posts",children:"Liked"})})]}),l.jsxs("div",{className:T.followNotifyRow,children:[bt&&(xt?l.jsxs("button",{type:"button",className:`${T.followBtn} ${T.followBtnFollowing}`,onClick:async function(){if(ft&&!re){ce(!0);try{await t.deleteFollow(ft),ue(null),ie(e=>e?{...e,viewer:{...e.viewer,following:void 0}}:null)}catch{}finally{ce(!1)}}},disabled:re,title:"Unfollow",children:[l.jsx("span",{className:T.followLabelDefault,children:"Following"}),l.jsx("span",{className:T.followLabelHover,children:"Unfollow"})]}):l.jsx("button",{type:"button",className:T.followBtn,onClick:async function(){if(ae&&!re&&!xt){ce(!0);try{const e=await t.follow(ae.did);ue(e.uri)}catch{}finally{ce(!1)}}},disabled:re,children:re?"Following…":"Follow"})),It&&l.jsx("button",{type:"button",className:`${T.notificationBellBtn} ${me?T.notificationBellBtnActive:""}`,onClick:async function(){if(!ae||he)return;const e=!me;fe(!0);try{await S(ae.did,e),pe(e)}catch{}finally{fe(!1)}},disabled:he,title:me?"Stop notifications for this account":"Get notifications when this account posts","aria-label":me?"Stop notifications":"Notify when they post",children:me?l.jsx("svg",{className:T.notificationBellIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:l.jsx("path",{d:"M12 2C10.9 2 10 2.9 10 4v.7c-2.5.4-4.4 2.6-4.4 5.2v4.4l-1.8 1.8c-.4.4-.4 1 0 1.4.2.2.5.3.7.3s.5-.1.7-.3l.2-.2h7.2l.2.2c.4.4 1 .4 1.4 0s.4-1 0-1.4l-1.8-1.8V9.9c0-2.6-1.9-4.8-4.4-5.2V4c0-1.1-.9-2-2-2zm0 18c-1.1 0-2-.9-2-2h4c0 1.1-.9 2-2 2z"})}):l.jsxs("svg",{className:T.notificationBellIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),l.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})})]})]}),ae?.description&&l.jsx("p",{className:T.description,children:l.jsx(z,{text:ae.description,linkDisplay:"domain"})}),ae&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:T.followListRow,role:"group","aria-label":"Followers, following, and mutuals",children:[l.jsx("button",{type:"button",className:T.followListBtn,onClick:()=>Me("followers"),children:"Followers"}),l.jsx("button",{type:"button",className:T.followListBtn,onClick:()=>Me("following"),children:"Following"}),gt&&l.jsx("button",{type:"button",className:T.followListBtn,onClick:()=>Me("mutuals"),children:"Mutuals"})]}),!gt&&Pe&&Pe.length>0&&l.jsxs("button",{type:"button",className:T.followedByFollowsPreview,onClick:()=>Me("followedByFollows"),children:[l.jsx("span",{className:T.followedByFollowsAvatars,children:Pe.slice(0,2).map(e=>e.avatar?l.jsx("img",{src:e.avatar,alt:"",className:T.followedByFollowsAvatar,loading:"lazy"},e.did):l.jsx("span",{className:T.followedByFollowsAvatarPlaceholder,"aria-hidden":!0,children:(e.displayName??e.handle??e.did).slice(0,1).toUpperCase()},e.did))}),l.jsx("span",{className:T.followedByFollowsText,children:1===Pe.length?`Followed by @${Pe[0].handle??Pe[0].did} you follow`:2===Pe.length?`Followed by @${Pe[0].handle??Pe[0].did}, @${Pe[1].handle??Pe[1].did} you follow`:`Followed by @${Pe[0].handle??Pe[0].did}, @${Pe[1].handle??Pe[1].did} + ${Pe.length-2} more you follow`})]})]})]})]}),ae&&l.jsx(le,{profileDid:ae.did,profileHandle:n,isOwnProfile:gt,isFollowing:xt,hideRepostsFromThisUser:Dt,onToggleHideReposts:Et?()=>Et.toggleHideRepostsFrom(ae.did):void 0,className:T.profileMenu})]}),$e&&l.jsx(Re,{onClose:()=>Le(!1)}),Ae&&ae&&l.jsx(rt,{mode:Ae,actor:ae.did,onClose:()=>Me(null),viewerDid:"followedByFollows"===Ae?xe?.did:void 0,authenticatedClient:"followedByFollows"===Ae?t:void 0}),a&&Ge?$.createPortal(l.jsxs("div",{className:T.modalBottomBarButtons,children:[l.jsx("button",{type:"button",className:`${T.toggleBtn} ${T.toggleBtnBottomBar} ${T.toggleBtnIcon}`,onClick:()=>{const e=ct.indexOf(ge);be(ct[(e+1)%ct.length])},title:`${ge} column(s). Click to cycle.`,"aria-label":`${ge} columns`,children:l.jsx(mt,{cols:"1"===ge?1:"2"===ge?2:3})}),l.jsx("button",{type:"button",className:`${T.toggleBtn} ${T.toggleBtnBottomBar} ${T.toggleBtnIcon} ${"sfw"!==Ct?T.toggleBtnActive:""}`,onClick:e=>Bt(e.currentTarget),title:`${Ct}. Click to cycle: SFW → Blurred → NSFW`,"aria-label":`NSFW filter: ${Ct}`,children:l.jsx(pt,{mode:Ct})})]}),Ge):null,!a&&l.jsx("div",{className:`${T.tabsSticky} ${Ne?"":T.tabsBarHidden}`,children:l.jsx("nav",{className:T.tabs,"aria-label":"Profile sections",children:Mt.map(e=>l.jsx("button",{type:"button",className:`${T.tab} ${r===e?T.tabActive:""}`,onClick:()=>c(e),children:"posts"===e?"Posts":"reposts"===e?"Reposts":"blog"===e?"Threads":"text"===e?"Text":"Feeds"},e))})}),a&&l.jsx("div",{className:T.tabsRowInModal,children:l.jsx("nav",{className:`${T.tabs} ${T.tabsInModal}`,"aria-label":"Profile sections",children:Mt.map(e=>l.jsx("button",{type:"button",className:`${T.tab} ${r===e?T.tabActive:""}`,onClick:()=>c(e),children:"posts"===e?"Posts":"reposts"===e?"Reposts":"blog"===e?"Threads":"text"===e?"Text":"Feeds"},e))})}),ne&&l.jsx("p",{className:T.error,children:ne}),l.jsx("div",{className:T.profileContent,children:Z?l.jsx("div",{className:T.loading,children:"Loading…"}):"blog"===r?0===Y.length?l.jsx("div",{className:T.empty,children:"No standard.site blog posts."}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:T.textList,children:Y.map(e=>{const t=e.authorHandle??e.did,s=e.title||e.path||"Untitled",n=e.createdAt,a=e.baseUrl?`${e.baseUrl.replace(/\/$/,"")}/${(e.path??"").replace(/^\//,"")}`.trim()||e.baseUrl:null;return l.jsx("li",{children:a?l.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:T.textPostLink,children:l.jsx("article",{className:K.postBlock,children:l.jsxs("div",{className:K.postBlockContent,children:[l.jsx("div",{className:K.postHead,children:l.jsxs("div",{className:K.authorRow,children:[l.jsxs(L,{to:`/profile/${encodeURIComponent(t)}`,className:`${K.handleLink} ${T.textPostHandleLink}`,onClick:e=>{e.preventDefault(),e.stopPropagation(),o(t)},children:["@",t]}),n&&l.jsx("span",{className:K.postTimestamp,title:D(n),children:E(n)})]})}),l.jsx("p",{className:K.postText,children:s})]})})}):l.jsx("article",{className:K.postBlock,children:l.jsxs("div",{className:K.postBlockContent,children:[l.jsx("div",{className:K.postHead,children:l.jsxs("div",{className:K.authorRow,children:[l.jsxs(L,{to:`/profile/${encodeURIComponent(t)}`,className:`${K.handleLink} ${T.textPostHandleLink}`,onClick:e=>{e.preventDefault(),o(t)},children:["@",t]}),n&&l.jsx("span",{className:K.postTimestamp,title:D(n),children:E(n)})]})}),l.jsx("p",{className:K.postText,children:s})]})})},e.uri)})}),Q&&l.jsx("button",{type:"button",className:T.more,onClick:()=>ot(Q),disabled:te,children:te?"Loading…":"Load more"})]}):"text"===r?0===Rt.length?l.jsx("div",{className:T.empty,children:"No text-only posts (no media, no replies)."}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`${T.grid} ${T.gridView1}`,"data-view-mode":"1",children:Rt.map(e=>l.jsx("div",{children:l.jsx(I,{item:e,onPostClick:(e,t)=>{t?.initialItem&&P(e,t.initialItem),Ue(e,t?.openReply)},nsfwBlurred:"blurred"===Ct&&k(e.post)&&!St.has(e.post.uri),onNsfwUnblur:()=>Ft(e.post.uri,!0),constrainMediaHeight:!0,likedUriOverride:Ie[e.post.uri],onLikedChange:(e,t)=>Te(s=>({...s,[e]:t??null}))})},e.post.uri))}),x&&l.jsx("div",{ref:ve,className:T.loadMoreSentinel,"aria-hidden":!0}),te&&l.jsx("div",{className:T.loadingMore,children:"Loading…"})]}):"feeds"===r?0===q.length?l.jsx("div",{className:T.empty,children:"No feeds."}):l.jsx("ul",{className:T.feedsList,children:q.map(e=>{const t=e.uri.split("/").pop()??"",s=t?`https://bsky.app/profile/${encodeURIComponent(n)}/feed/${encodeURIComponent(t)}`:e.uri;return l.jsx("li",{children:l.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:T.feedLink,children:[l.jsx("span",{className:T.feedName,children:e.displayName}),e.description&&l.jsx("span",{className:T.feedDesc,children:e.description})]})},e.uri)})}):0===$t.length?l.jsx("div",{className:T.empty,children:"posts"===r?"liked"===d?"No liked posts with images or videos.":"No posts with images or videos.":"No reposts with images or videos."}):l.jsxs(l.Fragment,{children:[l.jsx("div",{ref:Oe,className:`${T.gridColumns} ${T[`gridView${ge}`]}`,"data-view-mode":ge,children:ut($t,Pt).map((e,t)=>l.jsx(U,{column:e,colIndex:t,scrollMargin:We,scrollRef:a?ze:null,loadMoreSentinelRef:x?e=>{Pt>=2?je.current[t]=e:ve.current=e}:void 0,hasCursor:!!x,keyboardFocusIndex:_e,keyboardAddOpen:Ce,actionsMenuOpenForIndex:Se,nsfwPreference:Ct,unblurredUris:St,setUnblurred:Ft,likeOverrides:Ie,setLikeOverrides:Te,openPostModal:Ue,cardRef:e=>t=>{Qe.current[e]=t},onActionsMenuOpenChange:(e,t)=>Fe(t?e:null),onMouseEnter:e=>{st.current&&(st.current=!1,ke(e))},onAddClose:()=>Be(!1),constrainMediaHeight:1===Pt,isSelected:e=>("posts"===r||"reposts"===r)&&e===_e},t))}),te&&l.jsx("div",{className:T.loadingMore,children:"Loading…"})]})})]})})}function ft(){const{handle:e}=A(),t=e?decodeURIComponent(e):"",{openProfileModal:s}=m();return t?l.jsx(O,{title:`@${t}`,showNav:!0,children:l.jsx(ht,{handle:t,openProfileModal:s})}):l.jsx(O,{title:"Profile",showNav:!0,children:l.jsx("div",{className:T.wrap,children:l.jsx("p",{className:T.empty,children:"No profile specified."})})})}export{ht as ProfileContent,ft as default};
