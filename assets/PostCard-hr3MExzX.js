import{j as e,k as t,h as r,ad as n,v as a,w as i,u as o,S as s,a8 as d,f as c,b as l,ay as u}from"./index-CkOm7niF.js";import{b as p,d as m,L as h,h as _}from"./react-vendor-DGaPsC2e.js";import{l as v,P as f,g as x,b as w}from"./PostActionsMenu-6BO8619A.js";import{f as k,g,c as y,a as R,b,i as j}from"./artboards-DNvSVVrd.js";import{p as z}from"./artboardsPds-DWUixJ9h.js";import{P as C,a as L}from"./PostText-DFfMw_cH.js";let A=null;function N(e,t){if(!e||!e.startsWith("http"))return e??"";if(!function(){if(null!==A)return A;if("undefined"==typeof document)return A=!1,A;const e=document.createElement("canvas");return A=!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),A}())return e;return`https://wsrv.nl/?url=${encodeURIComponent(e)}&output=webp`}const T="_progressiveImage_8ku7v_1",q="_placeholder_8ku7v_8",P="_fullImage_8ku7v_21",$="_loaded_8ku7v_30",M="_error_8ku7v_38",I="_errorPlaceholder_8ku7v_46",E="_errorText_8ku7v_60";function S({src:t,alt:r,aspectRatio:n,loading:a="lazy",className:i="",onLoad:o,sizes:s=[320,640,960,1280,1920],sizesAttr:d,maxRetries:c=3,preloadDistance:l=1500}){const[u,m]=p.useState(!1),[h,_]=p.useState(!1),[v,f]=p.useState(0),[x,w]=p.useState(!1),[k,g]=p.useState(!1),[y,R]=p.useState("eager"===a),b=p.useRef(null),j=p.useRef(null),z=p.useRef(null),C=p.useRef(null),L=p.useRef(null),A=p.useMemo(()=>N(t),[t]),S=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return s.map(e=>`${N(t.includes("?")?`${t}&width=${e}`:`${t}?width=${e}`)} ${e}w`).join(", ")},[t,s]),O=p.useMemo(()=>"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",[]),W=d||O,B=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return t.replace(/\/img\/[^/]+\//,"/img/avatar_thumbnail/")},[t]),D=p.useCallback(e=>{j.current&&(clearTimeout(j.current),j.current=null),m(!0),_(!1),w(!1),f(0),o?.(e)},[o]),F=p.useCallback(()=>{g(!0)},[]),G=p.useCallback(()=>{if(h||A===t)if(v<c){const e=1e3*Math.pow(2,v);b.current=setTimeout(()=>{f(e=>e+1),_(!1)},e)}else w(!0);else _(!0)},[h,A,t,v,c]);p.useEffect(()=>()=>{b.current&&clearTimeout(b.current),j.current&&clearTimeout(j.current),L.current&&L.current.disconnect()},[]),p.useEffect(()=>{if("eager"===a||u)return void R(!0);const e=z.current;return e?(L.current=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting&&(R(!0),L.current&&L.current.disconnect())},{rootMargin:`${l}px 0px ${l}px 0px`,threshold:0}),L.current.observe(e),()=>{L.current&&L.current.disconnect()}):void 0},[a,l,u]),p.useEffect(()=>{f(0),w(!1),m(!1),_(!1),g(!1),R("eager"===a)},[t,a]);const U=h?t:A;return p.useEffect(()=>{if(!y||u||x)return;const e=requestAnimationFrame(()=>(()=>{const e=C.current;e?.complete&&e.naturalWidth>0&&(j.current&&(clearTimeout(j.current),j.current=null),m(!0))})());return j.current=setTimeout(()=>{j.current=null,u||m(!0)},12e3),()=>{cancelAnimationFrame(e),j.current&&(clearTimeout(j.current),j.current=null)}},[y,U,v,u,x]),x?e.jsx("div",{className:`${T} ${M} ${i}`,style:{aspectRatio:n?String(n):void 0},role:"img","aria-label":`Failed to load: ${r}`,children:e.jsxs("div",{className:I,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:E,children:"Image failed to load"})]})}):e.jsxs("div",{ref:z,className:`${T} ${u?$:""} ${i}`,style:{aspectRatio:n?String(n):void 0},children:[B&&!u&&!k&&e.jsx("img",{src:B,alt:"",className:q,"aria-hidden":"true",onError:F}),e.jsx("img",{ref:C,src:U,srcSet:S,sizes:S?W:void 0,alt:r,loading:y?"eager":"lazy",onLoad:D,onError:G,className:P},`${U}-${v}`)]})}const O={card:"_card_7q0z6_2",cardLink:"_cardLink_7q0z6_21",cardSelected:"_cardSelected_7q0z6_43",cardLiked:"_cardLiked_7q0z6_73",cardInArtboard:"_cardInArtboard_7q0z6_81",cardTransFlag:"_cardTransFlag_7q0z6_89",mediaWrap:"_mediaWrap_7q0z6_134",nsfwOverlay:"_nsfwOverlay_7q0z6_135",cardArtOnly:"_cardArtOnly_7q0z6_138",textOnlyPreview:"_textOnlyPreview_7q0z6_142",cardSeen:"_cardSeen_7q0z6_147",meta:"_meta_7q0z6_147",handleBlock:"_handleBlock_7q0z6_148",cardActionRow:"_cardActionRow_7q0z6_150",cardFillCell:"_cardFillCell_7q0z6_250",mediaGridCellFocused:"_mediaGridCellFocused_7q0z6_292",addWrap:"_addWrap_7q0z6_308",addWrapOpen:"_addWrapOpen_7q0z6_317",cardActionRowCenter:"_cardActionRowCenter_7q0z6_329",cardLikeRepostBtn:"_cardLikeRepostBtn_7q0z6_353",addToBoardBtn:"_addToBoardBtn_7q0z6_354",cardActionRowAvatarFollow:"_cardActionRowAvatarFollow_7q0z6_357",cardActionRowAvatarPlus:"_cardActionRowAvatarPlus_7q0z6_357",cardActionRowRight:"_cardActionRowRight_7q0z6_371",cardActionRowTime:"_cardActionRowTime_7q0z6_382",postTimeStacked:"_postTimeStacked_7q0z6_389",postTimeMonth:"_postTimeMonth_7q0z6_397",postTimeDayYear:"_postTimeDayYear_7q0z6_404",cardActionRowAvatar:"_cardActionRowAvatar_7q0z6_357",handleRow:"_handleRow_7q0z6_496",authorAvatar:"_authorAvatar_7q0z6_496",authorAvatarPlaceholder:"_authorAvatarPlaceholder_7q0z6_497",handleRowMain:"_handleRowMain_7q0z6_520",handleRowMeta:"_handleRowMeta_7q0z6_523",cardMinimalist:"_cardMinimalist_7q0z6_561",cardLikeRepostBtnActive:"_cardLikeRepostBtnActive_7q0z6_622",addToBoardBtnInCollection:"_addToBoardBtnInCollection_7q0z6_669",collectIcon:"_collectIcon_7q0z6_673",addDropdown:"_addDropdown_7q0z6_686",addDropdownFixed:"_addDropdownFixed_7q0z6_710",addBoardLabel:"_addBoardLabel_7q0z6_716",addBoardCheckbox:"_addBoardCheckbox_7q0z6_730",addBoardText:"_addBoardText_7q0z6_735",addDropdownNew:"_addDropdownNew_7q0z6_741",addBoardInput:"_addBoardInput_7q0z6_747",addDropdownActions:"_addDropdownActions_7q0z6_758",addBoardSubmit:"_addBoardSubmit_7q0z6_764",artOnlyActions:"_artOnlyActions_7q0z6_831",mediaWrapConstrained:"_mediaWrapConstrained_7q0z6_856",nsfwOverlayText:"_nsfwOverlayText_7q0z6_882",mediaWrapFillCell:"_mediaWrapFillCell_7q0z6_891",mediaWrapMultiStack:"_mediaWrapMultiStack_7q0z6_899",media:"_media_7q0z6_134",textOnlyPreviewText:"_textOnlyPreviewText_7q0z6_936",textOnlyPreviewEmpty:"_textOnlyPreviewEmpty_7q0z6_946",textOnlyPreviewLink:"_textOnlyPreviewLink_7q0z6_951",textOnlyPreviewLinkThumb:"_textOnlyPreviewLinkThumb_7q0z6_971",textOnlyPreviewLinkTitle:"_textOnlyPreviewLinkTitle_7q0z6_978",textOnlyPreviewLinkDesc:"_textOnlyPreviewLinkDesc_7q0z6_987",mediaWrapGridSpacer:"_mediaWrapGridSpacer_7q0z6_1024",mediaWrapGrid:"_mediaWrapGrid_7q0z6_1024",mediaGrid:"_mediaGrid_7q0z6_292",mediaGridCell:"_mediaGridCell_7q0z6_292",mediaGridImg:"_mediaGridImg_7q0z6_1081",mediaVideoWrap:"_mediaVideoWrap_7q0z6_1123",postTime:"_postTime_7q0z6_389",repostIconLink:"_repostIconLink_7q0z6_1252",repostIcon:"_repostIcon_7q0z6_1252",pinIconWrap:"_pinIconWrap_7q0z6_1271",pinIcon:"_pinIcon_7q0z6_1271",handleLinkWrap:"_handleLinkWrap_7q0z6_1289",handleLinkWrapLiked:"_handleLinkWrapLiked_7q0z6_1299",handleLink:"_handleLink_7q0z6_1180",text:"_text_7q0z6_142"};function W(){return e.jsx("svg",{className:O.repostIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})})}function B(){return e.jsx("svg",{className:O.pinIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})})}function D(){return e.jsx("svg",{className:O.collectIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}const F=p.memo(function({item:A,isSelected:N,cardRef:T,addButtonRef:q,openAddDropdown:P,onAddClose:$,onPostClick:M,onAspectRatio:I,fillCell:E,nsfwBlurred:F,onNsfwUnblur:G,constrainMediaHeight:U,likedUriOverride:H,onLikedChange:V,seen:Y,onActionsMenuOpenChange:Q,cardIndex:K,actionsMenuOpenForIndex:X,focusedMediaIndex:J,onMediaRef:Z}){const ee=m(),{session:te}=t(),{openLoginModal:re}=r(),{artOnly:ne,minimalist:ae}=n(),{mediaMode:ie}=a(),{unblurredUris:oe,setUnblurred:se}=i(),{openQuotesModal:de,isModalOpen:ce}=o(),le=p.useRef(null),ue=p.useRef(null),pe=p.useRef(null),{post:me,reason:he}=A,_e=A._feedSource,ve=_e?.label??("timeline"===_e?.kind?"Following":void 0),fe=p.useMemo(()=>s(me),[me]),xe=!!fe,we=me.record?.text??"",ke=p.useMemo(()=>d(me),[me]),ge=p.useMemo(()=>c(me),[me]),ye=me.author.handle??me.author.did,Re=he?.by?he.by.handle??he.by.did:null,be=(()=>{const e=me?.embed;return!!e&&("app.bsky.embed.record#view"===e.$type||"app.bsky.embed.recordWithMedia#view"===e.$type)})(),je="app.bsky.feed.defs#reasonPin"===he?.$type,ze=me.author.viewer,Ce=ze?.following,[Le,Ae]=p.useState(Ce??null),Ne=!!(Le??Ce??null),Te=te?.did===me.author.did,[qe,Pe]=p.useState(!1),$e=me.viewer,Me=$e?.like,[Ie,Ee]=p.useState(Me),[Se,Oe]=p.useState(!1),We=void 0!==H?H??void 0:Ie,Be=!!We,De=k(me.uri),Fe=Be&&De,[Ge,Ue]=p.useState(()=>xe&&null!=fe?.aspectRatio?fe.aspectRatio:null),[He,Ve]=p.useState(!1),[Ye,Qe]=p.useState(!1),Ke=p.useRef(null),[Xe,Je]=p.useState(new Set),[Ze,et]=p.useState(""),tt=p.useRef(null),rt=p.useRef(null),nt=p.useRef(null),at=p.useRef(null),[it,ot]=p.useState(null),st=p.useRef(null),dt=p.useRef(N),ct=p.useRef(0),lt=p.useRef(0),ut=p.useRef(!1),pt=p.useRef(!1),mt=p.useRef(!1),ht=p.useRef(null),_t=p.useRef(null);p.useEffect(()=>{null!=K&&X!==K&&Ye&&Qe(!1)},[X,K,Ye]);const vt=p.useRef(null);p.useEffect(()=>{null!=K&&(X===K&&vt.current!==K&&Qe(!0),vt.current=X??null)},[X,K]),p.useEffect(()=>{if(!Ye)return;const e=e=>!e||!st.current?.contains(e)&&!Ke.current?.contains(e),t=t=>{e(t.target)&&Qe(!1)},r=t=>{const r=t.target??t.target;e(r)&&Qe(!1)},n=t=>{e(t.target)&&Qe(!1)};return document.addEventListener("focusin",t),document.addEventListener("mousedown",r),document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("mouseover",n),()=>{document.removeEventListener("focusin",t),document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r),document.removeEventListener("mouseover",n)}},[Ye]),p.useEffect(()=>{Ee(void 0!==H?H??void 0:Me)},[me.uri,Me,H]),p.useEffect(()=>{Ae(Ce??null)},[me.uri,Ce]);const ft=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),qe||Te||!te?.did||Ne)return;Pe(!0);const t=`pending:follow:${me.author.did}:${Date.now()}`;Ae(t);try{const e=await l.follow(me.author.did);Ae(e.uri)}catch{Ae(null)}finally{Pe(!1)}},[qe,Te,te?.did,Ne,me.author.did]),xt=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!te?.did)return void re();if(Se)return;const t=!!We,r=We||void 0;Oe(!0),Ee(t?void 0:"pending");try{if(t)await l.deleteLike(r),Ee(void 0);else{const e=await l.like(me.uri,me.cid);Ee(e.uri)}}catch{Ee(r)}finally{Oe(!1)}},[te?.did,re,Se,We,me.uri,me.cid]);p.useEffect(()=>{P&&Ve(!0)},[P]),p.useEffect(()=>()=>{ht.current&&(clearTimeout(ht.current),ht.current=null)},[]);const wt=p.useRef(He);p.useEffect(()=>{wt.current&&!He&&$?.(),wt.current=He},[He,$]);const kt=p.useCallback(()=>{if(!tt.current)return null;const e=tt.current.getBoundingClientRect(),t=window.innerWidth-8-140,r=e.left+e.width/2,n=Math.max(148,Math.min(t,r));return{bottom:window.innerHeight-e.top,left:n}},[]);p.useLayoutEffect(()=>{He&&tt.current?ot(kt()):ot(null)},[He,kt]),p.useEffect(()=>{if(!He)return;const e=()=>ot(e=>e?kt()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[He,kt]),p.useEffect(()=>{if(He)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){const t=e.target;tt.current?.contains(t)||rt.current?.contains(t)||at.current?.contains(t)||Ve(!1)}},[He]);const gt=g(),yt=p.useCallback(e=>{Je(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),Rt=p.useCallback(async()=>{if(!(Xe.size>0||Ze.trim().length>0))return;const e=u(me),t=ge.length>0?ge.map(e=>e.url):void 0,r={uri:me.uri,cid:me.cid,authorHandle:me.author.handle,text:me.record?.text?.slice(0,200),thumb:e?.url??t?.[0],thumbs:t},n=[];if(Ze.trim()){const e=y(Ze.trim());R(e.id,r),n.push(e.id),et("")}if(Xe.forEach(e=>{R(e,r),n.push(e)}),Je(new Set),Ve(!1),te?.did&&n.length>0)for(const a of n){const e=b(a);if(e)try{await z(l,te.did,e)}catch{}}},[Xe,Ze,me,ge,te?.did]),bt=xe&&"video"===fe.type&&fe.videoPlaylist,jt=xe&&"image"===fe.type&&(fe.imageCount??0)>1,zt=p.useMemo(()=>ge.filter(e=>"image"===e.type),[ge]),Ct=p.useMemo(()=>ge.map((e,t)=>"image"===e.type?t:-1).filter(e=>e>=0),[ge]),Lt=jt&&zt.length?zt[0]?.url:fe?.url??"",At=p.useCallback(e=>{const t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&Ue(e=>null!=e?e:t.naturalWidth/t.naturalHeight)},[jt]);p.useEffect(()=>{xe&&(null!=fe?.aspectRatio?Ue(e=>e??fe.aspectRatio):bt||Ue(e=>e??null))},[xe,fe?.aspectRatio,fe?.videoPlaylist,bt]),p.useEffect(()=>{Ue(xe&&null!=fe?.aspectRatio?fe.aspectRatio:null)},[me.uri]),p.useEffect(()=>{null!=Ge&&I&&I(Ge)},[Ge,I]),p.useEffect(()=>{if(!bt||!fe?.videoPlaylist||!le.current)return;const e=le.current,t=fe.videoPlaylist;let r;var n;return/\.m3u8(\?|$)/i.test(n=t)||n.includes("m3u8")?v().then(n=>{if(le.current)if(n.isSupported()){const a=new n;pe.current=a,a.loadSource(t),a.attachMedia(e),a.on(n.Events.ERROR,()=>{}),r=()=>{a.destroy(),pe.current=null}}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t,r=()=>{e.removeAttribute("src")})}).catch(()=>{e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}):(e.src=t,r=()=>{e.removeAttribute("src")}),()=>{r?.()}},[bt,fe?.videoPlaylist]);const Nt=p.useRef(ce);Nt.current=ce,p.useEffect(()=>{if(!bt||!ue.current||!le.current)return;const e=ue.current,t=le.current;ce&&t.pause();const r=new IntersectionObserver(e=>{const r=e[0];r&&t&&(Nt.current?t.pause():r.isIntersecting?t.play().catch(()=>{}):t.pause())},{threshold:.25,rootMargin:"0px"});return r.observe(e),()=>r.disconnect()},[bt,ce]),p.useEffect(()=>{const e=dt.current;dt.current=N,N&&F&&G&&G(),e&&!N&&oe.has(me.uri)&&se(me.uri,!1)},[N,me.uri,oe,se,F,G]),p.useEffect(()=>{const e=st.current;if(!e||!oe.has(me.uri))return;const t=t=>{const r=t.relatedTarget;null!=r&&e.contains(r)||se(me.uri,!1)};return e.addEventListener("focusout",t),()=>e.removeEventListener("focusout",t)},[me.uri,oe,se]),p.useEffect(()=>{if(!xe||!oe.has(me.uri)||!ue.current)return;const e=ue.current,t=new IntersectionObserver(e=>{const t=e[0];!t||t.intersectionRatio>0||se(me.uri,!1)},{threshold:0,rootMargin:"0px"});return t.observe(e),()=>t.disconnect()},[xe,me.uri,oe,se]);const Tt=p.useCallback(()=>{le.current&&le.current.play().catch(()=>{})},[]),qt=p.useCallback(()=>{le.current&&(le.current.pause(),le.current.currentTime=0)},[]),Pt=p.useCallback(e=>{if(ut.current)return ut.current=!1,e.preventDefault(),void e.stopPropagation();pt.current?e.preventDefault():(e.preventDefault(),M?M(me.uri,{initialItem:A}):ee(`/post/${encodeURIComponent(me.uri)}`))},[ut,pt,M,me.uri,A,ee]),$t=p.useCallback(()=>{M?M(me.uri,{initialItem:A}):ee(`/post/${encodeURIComponent(me.uri)}`)},[M,me.uri,A,ee]),Mt=p.useCallback(()=>{te?.did?We?(Ee(void 0),l.deleteLike(We).then(()=>{V?.(me.uri,null)}).catch(()=>Ee(We))):(Ee("pending"),l.like(me.uri,me.cid).then(e=>{Ee(e.uri),V?.(me.uri,e.uri)}).catch(()=>Ee(void 0))):re()},[te?.did,re,We,me.uri,me.cid,V]),It=p.useCallback(e=>{if(e.stopPropagation(),mt.current)return;const t=Date.now();t-lt.current<400?(lt.current=0,Mt()):(lt.current=t,setTimeout(()=>$t(),400))},[mt,lt,Mt,$t]),Et=p.useCallback(e=>{st.current=e,T&&("function"==typeof T?T(e):T.current=e)},[T]);return e.jsx("div",{ref:Et,"data-post-uri":me.uri,className:`${O.card} ${N?O.cardSelected:""} ${Fe?O.cardTransFlag:""} ${!Fe&&Be?O.cardLiked:""} ${!Fe&&De?O.cardInArtboard:""} ${Y&&!N?O.cardSeen:""} ${E?O.cardFillCell:""} ${ne?O.cardArtOnly:""} ${ae?O.cardMinimalist:""}`,children:e.jsxs(h,{to:`/post/${encodeURIComponent(me.uri)}`,className:O.cardLink,onClick:Pt,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),M?M(me.uri,{initialItem:A}):ee(`/post/${encodeURIComponent(me.uri)}`))},onTouchStart:e=>{pt.current=!0,mt.current=!0;const t=e.touches[0];_t.current=t?{x:t.clientX,y:t.clientY}:null},onTouchEnd:e=>{const t=_t.current;_t.current=null;const r=e.changedTouches[0];if((t&&r?Math.hypot(r.clientX-t.x,r.clientY-t.y):0)>12)return ht.current&&(clearTimeout(ht.current),ht.current=null),pt.current=!1,void(mt.current=!1);const n=Date.now();n-ct.current<400?(ct.current=0,ut.current=!0,ht.current&&(clearTimeout(ht.current),ht.current=null),e.preventDefault(),We?(Ee(void 0),l.deleteLike(We).then(()=>{V?.(me.uri,null)}).catch(()=>Ee(We))):(Ee("pending"),l.like(me.uri,me.cid).then(e=>{Ee(e.uri),V?.(me.uri,e.uri)}).catch(()=>Ee(void 0))),setTimeout(()=>{pt.current=!1,mt.current=!1},500)):(ct.current=n,ht.current&&clearTimeout(ht.current),ht.current=setTimeout(()=>{ht.current=null,pt.current=!1,mt.current=!1,$t()},400))},children:[e.jsxs("div",{ref:e=>{ue.current=e,!Z||"text"!==ie&&(!xe||jt&&zt.length>1)||Z(0,e)},className:`${O.mediaWrap} ${E?O.mediaWrapFillCell:""} ${U?O.mediaWrapConstrained:""} ${jt&&zt.length>1?O.mediaWrapMultiStack:""}`,style:E||U||jt&&zt.length>1?void 0:{aspectRatio:xe?null!=Ge?String(Ge):bt?"1":void 0:"1"},onMouseEnter:Tt,onMouseLeave:qt,...xe&&{onClick:It},children:[xe&&"text"!==ie?bt?e.jsx("div",{className:O.mediaVideoWrap,children:e.jsx("video",{ref:le,className:O.media,poster:fe.url||void 0,muted:!0,playsInline:!0,loop:!0,preload:"metadata",style:{aspectRatio:null!=Ge?`${Ge}`:void 0},onLoadedMetadata:e=>{const t=e.currentTarget;t.videoWidth&&t.videoHeight&&Ue(e=>null!=e?e:t.videoWidth/t.videoHeight)}})}):jt&&zt.length>1?e.jsxs(e.Fragment,{children:[(()=>{const t=1/zt.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return e.jsx("div",{className:O.mediaWrapGridSpacer,style:{aspectRatio:String(t)},"aria-hidden":!0})})(),e.jsx("div",{className:O.mediaWrapGrid,children:e.jsx("div",{className:O.mediaGrid,style:{minHeight:0},children:zt.map((t,r)=>{const n=Ct[r]??r,a=J===n;return e.jsx("div",{ref:e=>Z?.(n,e),className:`${O.mediaGridCell} ${a?O.mediaGridCellFocused:""}`,style:{flex:1/(t.aspectRatio||1)+" 1 0"},children:e.jsx(S,{src:t.url,alt:"",className:O.mediaGridImg,loading:"lazy",onLoad:0===r?At:void 0})},r)})})})]}):e.jsx(e.Fragment,{children:e.jsx(S,{src:Lt,alt:"",className:O.media,loading:"eager",onLoad:At})}):e.jsxs("div",{className:O.textOnlyPreview,children:[we?e.jsx("div",{className:O.textOnlyPreviewText,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(C,{text:we,facets:me.record?.facets,maxLength:500,stopPropagation:!0,interactive:!1})}):null,ke?e.jsxs("a",{href:ke.uri,target:"_blank",rel:"noopener noreferrer",className:O.textOnlyPreviewLink,onClick:e=>e.stopPropagation(),children:[ke.thumb?e.jsx(S,{src:ke.thumb,alt:"",className:O.textOnlyPreviewLinkThumb,loading:"lazy"}):null,e.jsx("span",{className:O.textOnlyPreviewLinkTitle,children:ke.title}),ke.description?e.jsx("span",{className:O.textOnlyPreviewLinkDesc,children:ke.description}):null]}):null,we||ke?null:e.jsx("span",{className:O.textOnlyPreviewEmpty,children:"Text post"})]}),F&&G&&xe&&e.jsx("div",{className:O.nsfwOverlay,onClick:e=>{e.preventDefault(),e.stopPropagation(),G(),$t()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),G(),$t())},role:"button",tabIndex:0,"aria-label":"Reveal sensitive content",children:e.jsx("span",{className:O.nsfwOverlayText,children:"NSFW"})})]}),ne&&!ae&&e.jsx("div",{className:O.artOnlyActions,onClick:e=>e.stopPropagation(),children:e.jsx(f,{postUri:me.uri,postCid:me.cid,authorDid:me.author.did,rootUri:me.uri,isOwnPost:Te,compact:!0,verticalIcon:!0,className:O.cardActionsMenu,open:Ye,onOpenChange:e=>{Qe(e),Q?.(e)},dropdownRef:Ke,feedLabel:ve,postedAt:me.record?.createdAt,onViewQuotes:de})}),(!ne||ae)&&e.jsxs("div",{className:O.meta,children:[e.jsxs("div",{className:O.cardActionRow,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:O.cardActionRowCenter,children:[e.jsxs("div",{className:`${O.addWrap} ${He?O.addWrapOpen:""}`,ref:tt,children:[e.jsx("button",{ref:nt,type:"button",className:`${O.addToBoardBtn} ${De?O.addToBoardBtnInCollection:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:e=>{e.preventDefault(),e.stopPropagation(),te?.did?Ve(e=>!e):re()},"aria-label":"Collect","aria-expanded":He,children:e.jsx(D,{})}),He&&it&&_.createPortal(e.jsxs("div",{ref:at,className:`${O.addDropdown} ${O.addDropdownFixed}`,style:{position:"fixed",bottom:it.bottom,left:it.left,transform:"translateX(-50%)",zIndex:1001},children:[0===gt.length?null:e.jsx(e.Fragment,{children:gt.map(t=>{const r=j(t.id,me.uri),n=Xe.has(t.id);return e.jsxs("label",{className:O.addBoardLabel,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>!r&&yt(t.id),disabled:r,className:O.addBoardCheckbox}),e.jsx("span",{className:O.addBoardText,children:r?e.jsxs(e.Fragment,{children:["✓ ",t.name]}):t.name})]},t.id)})}),e.jsx("div",{className:O.addDropdownNew,children:e.jsx("input",{type:"text",placeholder:"New collection name",value:Ze,onChange:e=>et(e.target.value),className:O.addBoardInput,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),Rt())})}),e.jsx("div",{className:O.addDropdownActions,children:e.jsx("button",{type:"button",className:O.addBoardSubmit,onClick:Rt,disabled:0===Xe.size&&!Ze.trim(),children:"Add to selected"})})]}),document.body)]}),me.author.avatar&&(Te||!te||Ne?e.jsx(L,{handle:ye,className:O.cardActionRowAvatar,onClick:e=>e.stopPropagation(),"aria-label":`View @${ye} profile`,children:e.jsx(S,{src:me.author.avatar,alt:"",loading:"lazy"})}):e.jsxs("button",{type:"button",className:`${O.cardActionRowAvatar} ${O.cardActionRowAvatarFollow}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:ft,disabled:qe,"aria-label":`Follow @${ye}`,title:`Follow @${ye}`,children:[e.jsx(S,{src:me.author.avatar,alt:"",loading:"lazy"}),e.jsx("span",{className:O.cardActionRowAvatarPlus,"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 8 8",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M4 2v4M2 4h4"})})})]})),e.jsx("button",{type:"button",className:`${O.cardLikeRepostBtn} ${Be?O.cardLikeRepostBtnActive:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:xt,disabled:Se,title:Be?"Remove like":"Like","aria-label":Be?"Remove like":"Like",children:Be?"♥":"♡"})]}),e.jsxs("div",{className:O.cardActionRowRight,children:[me.record?.createdAt&&(()=>{const t=me.record.createdAt,r=x(t);return"relative"===r.kind?e.jsx("span",{className:O.cardActionRowTime,title:w(t),"aria-hidden":!0,children:r.text}):e.jsxs("span",{className:`${O.cardActionRowTime} ${O.postTimeStacked}`,title:w(t),"aria-hidden":!0,children:[e.jsx("span",{className:O.postTimeMonth,children:r.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})(),e.jsx(f,{postUri:me.uri,postCid:me.cid,authorDid:me.author.did,rootUri:me.uri,isOwnPost:Te,compact:!0,verticalIcon:!0,className:O.cardActionsMenu,open:Ye,onOpenChange:e=>{Qe(e),Q?.(e)},dropdownRef:Ke,feedLabel:ve,postedAt:me.record?.createdAt,onViewQuotes:de})]})]}),!ae&&e.jsx("div",{className:O.handleBlock,children:e.jsxs("div",{className:O.handleRow,children:[me.author.avatar?e.jsx(S,{src:me.author.avatar,alt:"",className:O.authorAvatar,loading:"lazy"}):me.author.did?e.jsx("span",{className:O.authorAvatarPlaceholder,"aria-hidden":!0,children:(ye||me.author.did).slice(0,1).toUpperCase()}):null,e.jsxs("span",{className:O.handleRowMain,children:[e.jsx("span",{className:We?O.handleLinkWrapLiked:O.handleLinkWrap,children:e.jsxs(L,{handle:ye,className:O.handleLink,onClick:e=>e.stopPropagation(),children:["@",ye]})}),(Re||be)&&e.jsx("span",{className:O.repostIconLink,role:"button",tabIndex:0,title:Re?`Reposted by @${Re}`:"Quote post","aria-label":Re?`Reposted by @${Re}`:"Quote post",onClick:e=>{e.stopPropagation(),Pt(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$t())},children:e.jsx(W,{})})]}),e.jsxs("span",{className:O.handleRowMeta,children:[je&&e.jsx("span",{className:O.pinIconWrap,title:"Pinned",children:e.jsx(B,{})}),me.record?.createdAt&&(()=>{const t=me.record.createdAt,r=x(t);return"relative"===r.kind?e.jsx("span",{className:O.postTime,title:w(t),children:r.text}):e.jsxs("span",{className:`${O.postTime} ${O.postTimeStacked}`,title:w(t),children:[e.jsx("span",{className:O.postTimeMonth,children:r.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})()]})]})}),!ae&&xe&&we?e.jsx("p",{className:O.text,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(C,{text:we,facets:me.record?.facets,maxLength:80,stopPropagation:!0,interactive:!1})}):null]})]})})},(e,t)=>{if(e.item.post.uri!==t.item.post.uri)return!1;if(e.isSelected!==t.isSelected)return!1;if(e.likedUriOverride!==t.likedUriOverride)return!1;if(e.seen!==t.seen)return!1;if(e.nsfwBlurred!==t.nsfwBlurred)return!1;if(e.fillCell!==t.fillCell)return!1;if(e.constrainMediaHeight!==t.constrainMediaHeight)return!1;if(e.openAddDropdown!==t.openAddDropdown)return!1;if(e.cardIndex!==t.cardIndex)return!1;if(e.actionsMenuOpenForIndex!==t.actionsMenuOpenForIndex)return!1;if(e.focusedMediaIndex!==t.focusedMediaIndex)return!1;if(e.item.post.cid!==t.item.post.cid)return!1;if(e.item.post.likeCount!==t.item.post.likeCount)return!1;return e.item.post.repostCount===t.item.post.repostCount});export{F as P};
