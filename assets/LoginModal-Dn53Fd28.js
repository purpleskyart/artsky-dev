import{k as e,A as a,j as s,B as t,C as n,D as r}from"./index-C3JThxTR.js";import{b as o,h as l}from"./react-vendor-DGaPsC2e.js";import"./atproto-3-1TCh3S.js";const i="_card_cxj54_15",c="_cardCloseBtn_cxj54_29",d="_cardContentWithClose_cxj54_54",u="_title_cxj54_58",p="_subtitle_cxj54_66",h="_tabs_cxj54_73",m="_tab_cxj54_73",g="_tabActive_cxj54_99",_="_srOnly_cxj54_113",y="_form_cxj54_125",x="_input_cxj54_131",f="_inputWrap_cxj54_154",j="_suggestionsPortal_cxj54_160",b="_suggestions_cxj54_160",w="_suggestion_cxj54_160",v="_suggestionActive_cxj54_178",C="_suggestionAvatar_cxj54_196",k="_suggestionText_cxj54_204",N="_suggestionDisplayName_cxj54_212",S="_suggestionHandle_cxj54_220",A="_suggestionsLoading_cxj54_229",L="_signupLink_cxj54_234",P="_error_cxj54_252",B="_button_cxj54_258",E="_buttonSecondary_cxj54_288",D="_hint_cxj54_313",F="https://bsky.app";function W(e,a){const s=e&&"object"==typeof e&&"message"in e?String(e.message):"",t=s.toLowerCase();return t.includes("loopback")||t.includes("path component")||t.includes("client id")?"oauth"===a?"Sign-in with Bluesky isn't available from this page address. Try opening the app from its main URL, or use an App Password to log in instead.":"We couldn't complete sign-in from this address. Try opening the app from its main URL.":t.includes("network")||t.includes("fetch")||t.includes("failed to fetch")?"Connection problem. Check your internet and try again.":t.includes("invalid")&&(t.includes("password")||t.includes("credentials"))?"Wrong handle or password. Check your Bluesky handle (or email) and App Password.":t.includes("invalid")||t.includes("unauthorized")?"app-password"===a?"Wrong handle or App Password. Get an App Password from Bluesky: Settings → App passwords.":"We couldn't verify your account. Check your handle and try again, or use an App Password to log in.":s||("app-password"===a?"Log in failed. Use your Bluesky handle (or email) and an App Password from Settings → App passwords.":"Could not start sign-in. Check your handle and try again, or use an App Password to log in.")}function q({initialMode:r="signin",onSuccess:q,onClose:T}){const{login:R,refreshSession:U}=e(),[z,H]=o.useState(r);o.useEffect(()=>{H(r)},[r]);const[M,O]=o.useState(""),[$,G]=o.useState(""),[I,K]=o.useState(!1),[J,Q]=o.useState(""),[V,X]=o.useState(!1),[Y,Z]=o.useState([]),[ee,ae]=o.useState(!1),[se,te]=o.useState(!1),[ne,re]=o.useState(0),oe=o.useRef(null),[le,ie]=o.useState(null),[ce,de]=o.useState(""),[ue,pe]=o.useState(""),[he,me]=o.useState(""),ge=o.useCallback(async e=>{const s=e.trim().replace(/^@/,"");if(!s||s.length<2)Z([]);else{te(!0);try{const e=await a(s,8);Z(e.actors??[]),re(0)}catch{Z([])}finally{te(!1)}}},[]);return o.useEffect(()=>{if(M.trim().replace(/^@/,"").length<2)return Z([]),void ae(!1);const e=setTimeout(()=>ge(M),250);return()=>clearTimeout(e)},[M,ge]),o.useLayoutEffect(()=>{if(!ee||!(Y.length>0||se))return void ie(null);const e=oe.current;if(!e)return;const a=e.getBoundingClientRect();ie({top:a.bottom+2,left:a.left,width:a.width})},[ee,Y.length,se]),o.useEffect(()=>{function e(e){oe.current&&!oe.current.contains(e.target)&&ae(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),s.jsxs("div",{className:i,children:[T&&s.jsx("button",{type:"button",className:c,onClick:T,"aria-label":"Close",children:"×"}),s.jsxs("div",{className:T?d:void 0,children:[s.jsx("h1",{className:u,children:"ArtSky"}),s.jsx("p",{className:p,children:"Bluesky feed & collections"}),"create"===z&&s.jsxs("div",{className:h,role:"tablist","aria-label":"Create account or log in",children:[s.jsx("button",{type:"button",role:"tab",className:m,onClick:()=>{H("signin"),Q("")},children:"Log in"}),s.jsx("span",{className:`${m} ${g}`,role:"tab","aria-selected":!0,id:"tab-create",children:"Create Account"})]}),"signin"===z?s.jsxs("form",{id:"signin-panel",onSubmit:async function(e){e.preventDefault(),Q("");const a=M.trim().replace(/^@/,"");if(a)if($.trim()){X(!0);try{await R(a,$),q?.()}catch(s){Q(W(s,"app-password"))}finally{X(!1)}}else{X(!0);try{await t(a),q?.()}catch(s){Q(W(s,"oauth"))}finally{X(!1)}}},className:y,"aria-label":"Log in",children:[s.jsxs("div",{ref:oe,className:f,children:[s.jsx("label",{htmlFor:"login-identifier",className:_,children:"username.bsky.social or email"}),s.jsx("input",{id:"login-identifier",type:"text",placeholder:"username.bsky.social or email",value:M,onChange:e=>{O(e.target.value),ae(!0)},onFocus:()=>Y.length>0&&ae(!0),onKeyDown:e=>{if(ee&&0!==Y.length)if("ArrowDown"===e.key)e.preventDefault(),re(e=>(e+1)%Y.length);else if("ArrowUp"===e.key)e.preventDefault(),re(e=>(e-1+Y.length)%Y.length);else if("Enter"===e.key&&Y[ne]){e.preventDefault();const a=Y[ne].handle;O(a??""),ae(!1)}else"Escape"===e.key&&ae(!1)},className:x,autoComplete:"username",required:!0,"aria-describedby":J?"login-error":void 0})]}),le&&l.createPortal(s.jsx("div",{className:j,style:{position:"fixed",top:le.top,left:le.left,width:le.width,zIndex:202},children:s.jsx("ul",{className:b,role:"listbox",children:se&&0===Y.length?s.jsx("li",{className:w,role:"option","aria-disabled":!0,children:s.jsx("span",{className:A,children:"Searching…"})}):Y.map((e,a)=>s.jsxs("li",{role:"option","aria-selected":a===ne,className:a===ne?v:w,onMouseDown:a=>{a.preventDefault(),O(e.handle??""),ae(!1)},children:[e.avatar&&s.jsx("img",{src:e.avatar,alt:"",className:C,loading:"lazy"}),s.jsxs("div",{className:k,children:[e.displayName&&s.jsx("span",{className:N,children:e.displayName}),s.jsxs("span",{className:S,children:["@",e.handle]})]})]},e.did))})}),document.body),I&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:"login-password",className:_,children:"App password"}),s.jsx("input",{id:"login-password",type:"password",placeholder:"App password",value:$,onChange:e=>G(e.target.value),className:x,autoComplete:"current-password","aria-describedby":J?"login-error login-app-password-hint":"login-app-password-hint"}),s.jsx("p",{id:"login-app-password-hint",className:D,children:"Create an App Password in Bluesky: Settings → App passwords, then enter it above."})]}),J&&s.jsx("p",{id:"login-error",className:P,role:"alert",children:J}),s.jsx("button",{type:"submit",className:B,disabled:V,children:V?"Logging in…":$.trim()?"Log in":"Log in with Bluesky"}),I?null:s.jsx("button",{type:"button",className:E,onClick:()=>K(!0),children:"or use your app password"}),s.jsx("a",{href:F,target:"_blank",rel:"noopener noreferrer",className:L,children:"Create account"})]}):s.jsxs("form",{id:"create-panel",onSubmit:async function(e){e.preventDefault(),Q(""),X(!0);try{await n({email:ce.trim(),password:he,handle:ue.trim().toLowerCase().replace(/^@/,"")}),U(),q?.()}catch(a){const e=a&&"object"==typeof a&&"message"in a?String(a.message):"Could not create account. Check that the handle is available.",s="string"==typeof e&&(e.toLowerCase().includes("verification")||e.toLowerCase().includes("latest version"));Q(s?"Account creation now requires verification on Bluesky. Please create your account on the Bluesky website or app, then log in here with an App Password.":e)}finally{X(!1)}},className:y,"aria-label":"Create account",role:"tabpanel","aria-labelledby":"tab-create",children:[s.jsx("label",{htmlFor:"create-email",className:_,children:"Email"}),s.jsx("input",{id:"create-email",type:"email",placeholder:"Email",value:ce,onChange:e=>de(e.target.value),className:x,autoComplete:"email",required:!0}),s.jsx("label",{htmlFor:"create-handle",className:_,children:"Handle (e.g. you.bsky.social)"}),s.jsx("input",{id:"create-handle",type:"text",placeholder:"Handle (e.g. you.bsky.social)",value:ue,onChange:e=>pe(e.target.value),className:x,autoComplete:"username",required:!0}),s.jsx("label",{htmlFor:"create-password",className:_,children:"Password"}),s.jsx("input",{id:"create-password",type:"password",placeholder:"Password",value:he,onChange:e=>me(e.target.value),className:x,autoComplete:"new-password",required:!0,minLength:8,"aria-describedby":J?"create-error":void 0}),J&&s.jsx("p",{id:"create-error",className:P,role:"alert",children:J}),s.jsx("button",{type:"submit",className:B,disabled:V,children:V?"Creating account…":"Create account"}),s.jsx("p",{className:D,children:"Bluesky now requires verification to create accounts. Create your account on the Bluesky website or app, then return here to log in with an App Password."}),s.jsx("a",{href:F,target:"_blank",rel:"noopener noreferrer",className:L,children:"Create account on Bluesky →"})]})]})]})}const T="_backdrop_149oe_1",R="_center_149oe_9",U="_cardWrap_149oe_23";function z({isOpen:e,mode:a,onClose:t,onSuccess:n}){const l=r();return o.useEffect(()=>{if(e)return l?.lockScroll(),()=>l?.unlockScroll()},[e,l]),o.useEffect(()=>{if(!e)return;const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t]),e?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:T,onClick:t,"aria-hidden":!0}),s.jsx("div",{className:R,role:"dialog","aria-modal":"true","aria-label":"Log in or create account",children:s.jsx("div",{className:U,onClick:e=>e.stopPropagation(),children:s.jsx(q,{initialMode:a,onSuccess:n,onClose:t})})})]}):null}export{z as default};
