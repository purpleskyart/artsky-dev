const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/virtual_pwa-register-DDfxV8nQ.js","assets/index-DUt1g_SH.js","assets/react-vendor-DGaPsC2e.js","assets/atproto-3-1TCh3S.js","assets/index-D5ReShHa.css"])))=>i.map(i=>d[i]);
import{j as e,u as t,A as n,af as a,z as s,k as r,Q as i,V as o,ag as l,ah as c,ai as d,h as u,O as h,aj as m,l as f,ad as p,w as x,v as g,D as j,n as v,ak as b,r as y,p as w,q as k,al as N,am as _,an as C,ao as S,ap as E,aq as L,ar as A,as as F,at as B,au as $,ae as M,av as P,ab as T}from"./index-DUt1g_SH.js";import{b as R,d as W,h as D,u as I,L as O,j as U}from"./react-vendor-DGaPsC2e.js";import{s as H,b as z,a as K,E as q,C as V,c as G,d as Y}from"./Icons-ePkhofVz.js";import{P as J}from"./PostText-0wJL44t3.js";const Q=[{kind:"timeline",label:"Following"},{kind:"custom",label:"For You",uri:"at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.generator/whats-hot"},{kind:"custom",label:"Popular With Friends",uri:"at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.generator/with-friends"},{kind:"custom",label:"Art",uri:"at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.generator/art"}],X=[{source:Q[0],percent:50},{source:Q[1],percent:50}],Z=R.createContext(null);function ee(){return R.useContext(Z)}function te({feedSources:t,setSingleFeed:n,children:a}){return e.jsx(Z.Provider,{value:{feedSources:t,setSingleFeed:n},children:a})}const ne="_wrap_eb8da_1",ae="_compact_eb8da_6",se="_searchRow_eb8da_6",re="_filterIconBtn_eb8da_11",ie="_input_eb8da_17",oe="_searchSubmitBtn_eb8da_23",le="_filterIconActive_eb8da_69",ce="_searchRowFilterOpen_eb8da_114",de="_filterDropdown_eb8da_119",ue="_filterBtn_eb8da_134",he="_filterActive_eb8da_135",me="_dropdown_eb8da_166",fe="_suggestionsAbove_eb8da_182",pe="_item_eb8da_188",xe="_itemActive_eb8da_205",ge="_itemAvatar_eb8da_209",je="_itemLabel_eb8da_217";function ve(e){const t=e.match(/\/profile\/([^/?\s#]+)/i);if(t)try{return decodeURIComponent(t[1].trim())}catch{return t[1].trim()}const n=e.match(/profile=([^&\s]+)/i);if(!n)return null;try{return decodeURIComponent(n[1].trim())}catch{return n[1].trim()}}function be(e){const t=e.match(/[?&]post=(at%3A%2F%2F[^&\s]+)/i);if(t)try{const e=decodeURIComponent(t[1].trim());if(e.startsWith("at://"))return{type:"uri",uri:e}}catch{}if(/\/profile\//i.test(e)||/\/post\//i.test(e)){const t=e.match(/\/post\/(at%3A%2F%2F[^/?\s#]+)/i);if(t)try{const e=decodeURIComponent(t[1].trim());if(e.startsWith("at://"))return{type:"uri",uri:e}}catch{}const n=e.match(/\/profile\/([^/]+)\/post\/([^/?\s#]+)/i);if(n)try{const e=decodeURIComponent(n[1].trim()),t=n[2].trim();if(e&&t)return{type:"handleRkey",handle:e,rkey:t}}catch{}}return null}function ye(){return e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M4 6h16M4 12h10M4 18h6"})})}function we(){return e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})}function ke({onSelectFeed:r,inputRef:i,compact:o,onClose:l,suggestionsAbove:c}){const d=W(),{openProfileModal:u,openPostModal:h,openTagModal:m,openSearchModal:f}=t(),[p,x]=R.useState(""),[g,j]=R.useState("all"),[v,b]=R.useState(!1),[y,w]=R.useState(!1),[k,N]=R.useState([]),[_,C]=R.useState([]),[S,E]=R.useState(-1),[L,A]=R.useState(!1),[F,B]=R.useState(!1),$=R.useRef(null),M=R.useRef(null),P=i??M,T=p.trim(),D=T.startsWith("#"),I=D?T.slice(1).replace(/\s.*$/,"").toLowerCase():"",O=D&&I&&"feeds"!==g?{type:"tag",tag:I}:null,U=T?be(T):null,H=R.useCallback(async e=>{if(e&&!e.startsWith("#")&&"feeds"!==g){w(!0);try{const t=await n(e,8);N(t.actors??[])}catch{N([])}finally{w(!1)}}else N([])},[g]);R.useEffect(()=>{if(!T||T.startsWith("#")||"feeds"===g)return void N([]);const e=setTimeout(()=>H(T),200);return()=>clearTimeout(e)},[T,g,H]),R.useEffect(()=>{v&&("feeds"===g||"all"===g)&&T?a(6).then(e=>C(e??[])):C([])},[v,T,g]),R.useEffect(()=>{function e(e){$.current?.contains(e.target)||(b(!1),A(!1))}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const z=T?ve(T):null,K=[];async function q(e){let t;if("uri"===e.type)t=e.uri;else{B(!0);try{t=`at://${(await s.getProfile({actor:e.handle})).data.did}/app.bsky.feed.post/${e.rkey}`}catch{return void u(e.handle)}finally{B(!1)}}h(t),x(""),b(!1),P.current?.blur(),l?.()}function V(e){const t=K[e];if(t)if(b(!1),x(""),"postFromUrl"===t.type)q(t.post);else if("profileFromUrl"===t.type)u(t.handle),P.current?.blur(),l?.();else if("tag"===t.type)m(t.tag),P.current?.blur(),l?.();else if("actor"===t.type)u(t.handle),P.current?.blur(),l?.();else if("feed"===t.type){const e=t.view,n={kind:"custom",label:e.displayName??e.uri,uri:e.uri};r?r(n):d("/feed",{state:{feedSource:n}}),P.current?.blur(),l?.()}}U&&"feeds"!==g?K.push({type:"postFromUrl",post:U}):z&&"feeds"!==g&&K.push({type:"profileFromUrl",handle:z}),O&&K.push(O),"feeds"!==g&&k.forEach(e=>K.push({type:"actor",handle:e.handle,did:e.did,avatar:e.avatar,displayName:e.displayName})),"feeds"!==g&&"all"!==g||T||!_.length||_.forEach(e=>K.push({type:"feed",view:e})),R.useEffect(()=>{E(-1)},[p,k.length,_.length,O,z,U]);const G="users"===g?"Search users, #hashtags…":"feeds"===g?"Browse feeds…":"Search users, feeds, #hashtags…",Y=T.length>0&&!/\s/.test(T)&&(T.startsWith("@")||T.includes("."));function J(){const e=be(T);if(e)return void q(e);const t=ve(T);return t?(u(t),x(""),b(!1),P.current?.blur(),void l?.()):Y?(u(T.replace(/^@/,"")),x(""),b(!1),P.current?.blur(),void l?.()):T.length>0?(f(T),x(""),b(!1),P.current?.blur(),void l?.()):void(v&&K.length>0&&S>=0&&V(S))}return e.jsxs("div",{className:`${ne} ${o?ae:""} ${c?fe:""}`,ref:$,children:[e.jsxs("div",{className:`${se} ${L?ce:""}`,children:[e.jsx("button",{type:"button",className:`${re} ${L?le:""}`,onClick:()=>A(e=>!e),"aria-label":"Search filter","aria-expanded":L,children:e.jsx(ye,{})}),e.jsx("input",{ref:e=>{M.current=e,i&&(i.current=e)},type:"search",placeholder:G,value:p,onChange:e=>{x(e.target.value),b(!0)},onFocus:()=>b(!0),onKeyDown:function(e){if("Escape"===e.key)return b(!1),void l?.();if("Enter"===e.key||"e"===e.key&&(e.ctrlKey||e.metaKey))return v&&K.length>0&&S>=0?(e.preventDefault(),void V(S)):(e.preventDefault(),void J());v&&0!==K.length&&("ArrowDown"===e.key?(e.preventDefault(),E(e=>e<0?0:(e+1)%K.length)):"ArrowUp"===e.key&&(e.preventDefault(),E(e=>e<=0?K.length-1:e-1)))},className:ie,"aria-label":"Search","aria-autocomplete":"list","aria-expanded":v&&K.length>0}),e.jsx("button",{type:"button",className:oe,onClick:J,disabled:F,"aria-label":"Search",children:e.jsx(we,{})}),L&&e.jsx("div",{className:de,children:["all","users","feeds"].map(t=>e.jsx("button",{type:"button",className:g===t?he:ue,onClick:()=>{j(t),A(!1)},children:"all"===t?"All":"users"===t?"Users":"Feeds"},t))})]}),v&&(K.length>0||y)&&e.jsxs("div",{className:me,role:"listbox",children:[y&&0===K.length&&e.jsx("div",{className:pe,children:"Searching…"}),K.map((t,n)=>{if("postFromUrl"===t.type)return e.jsx("button",{type:"button",role:"option",className:`${pe} ${n===S?xe:""}`,onClick:()=>V(n),disabled:F,children:e.jsx("span",{className:je,children:F?"Opening post…":"Open post"})},"post-from-url");if("profileFromUrl"===t.type)return e.jsx("button",{type:"button",role:"option",className:`${pe} ${n===S?xe:""}`,onClick:()=>V(n),children:e.jsxs("span",{className:je,children:["Open profile @",t.handle]})},`profile-${t.handle}`);if("tag"===t.type)return e.jsx("button",{type:"button",role:"option",className:`${pe} ${n===S?xe:""}`,onClick:()=>V(n),children:e.jsxs("span",{className:je,children:["Browse #",t.tag]})},`tag-${t.tag}`);if("actor"===t.type)return e.jsxs("button",{type:"button",role:"option",className:`${pe} ${n===S?xe:""}`,onClick:()=>V(n),children:[t.avatar&&e.jsx("img",{src:t.avatar,alt:"",className:ge,loading:"lazy"}),e.jsxs("span",{className:je,children:[t.displayName?`${t.displayName} `:"","@",t.handle]})]},t.did);if("feed"===t.type){const a=t.view;return e.jsxs("button",{type:"button",role:"option",className:`${pe} ${n===S?xe:""}`,onClick:()=>V(n),children:[a.avatar&&e.jsx("img",{src:a.avatar,alt:"",className:ge,loading:"lazy"}),e.jsx("span",{className:je,children:a.displayName??a.uri})]},a.uri)}return null})]})]})}function Ne(){const e=[];let t=0;try{for(let n=0;n<localStorage.length;n++){const a=localStorage.key(n);if(a?.startsWith("artsky-")){e.push(a);const n=localStorage.getItem(a)??"";t+=2*(a.length+n.length)}}}catch{}return{totalBytes:t,keys:e}}async function _e(){const{totalBytes:e}=Ne(),t=await async function(){const e=[];try{if(!("caches"in self))return e;const t=await caches.keys();for(const n of t){const t=await caches.open(n),a=await t.keys();let s=0;for(const e of a)try{const n=await t.match(e);n?.body&&(s+=(await n.blob()).size)}catch{s+=1024}e.push({name:n,bytes:s,entries:a.length})}}catch{}return e}();return{localStorageBytes:e,cacheBytes:t.reduce((e,t)=>e+t.bytes,0),cacheBreakdown:t}}function Ce(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(1)} ${["B","KB","MB"][t]}`}function Se({onClose:t,showToast:n,onLocalDataCleared:a}){const[s,r]=R.useState(!0),[i,o]=R.useState(null),[l,c]=R.useState(null),[d,u]=R.useState(!1),[h,m]=R.useState(!1),f=R.useCallback(async()=>{r(!0);try{const e=await _e();o(e)}catch{o({localStorageBytes:0,cacheBytes:0,cacheBreakdown:[]})}finally{r(!1)}},[]);R.useEffect(()=>{f()},[f]);const p=i?i.localStorageBytes+i.cacheBytes:0,x=i?.cacheBreakdown.find(e=>"artsky-images"===e.name);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.searchOverlayBackdrop,onClick:t,"aria-hidden":!0}),e.jsx("div",{className:H.settingsOverlay,role:"dialog","aria-label":"Storage & Cache",onClick:t,children:e.jsxs("div",{className:H.settingsCard,onClick:e=>e.stopPropagation(),children:[e.jsx("h2",{className:H.settingsTitle,children:"Storage & Cache"}),e.jsxs("section",{className:H.settingsSection,children:[e.jsx("h3",{className:H.settingsSubtitle,children:"Storage usage"}),s?e.jsx("p",{className:H.settingsMuted,children:"Loading…"}):i?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:H.settingsUsage,children:[e.jsx("strong",{children:"Total:"})," ",Ce(p)]}),e.jsxs("ul",{className:H.settingsBreakdown,children:[e.jsxs("li",{children:["App data (settings, artboards, sessions):"," ",Ce(i.localStorageBytes)]}),i.cacheBreakdown.map(t=>e.jsxs("li",{children:["artsky-images"===t.name?"Image cache":t.name,":"," ",Ce(t.bytes)," (",t.entries," items)"]},t.name)),0===i.cacheBreakdown.length&&e.jsx("li",{className:H.settingsMuted,children:"No cache data"})]})]}):null]}),e.jsxs("section",{className:H.settingsSection,children:[e.jsx("h3",{className:H.settingsSubtitle,children:"Actions"}),e.jsxs("div",{className:H.settingsActions,children:[e.jsx("button",{type:"button",className:H.settingsActionBtn,onClick:async()=>{c("image");try{await async function(){try{"caches"in self&&await caches.delete("artsky-images")}catch{}}(),await f(),n("Image cache cleared")}catch{n("Could not clear image cache")}finally{c(null)}},disabled:null!==l||!x?.bytes,title:"Clear cached Bluesky images",children:"image"===l?"Clearing…":"Clear image cache"}),e.jsx("button",{type:"button",className:`${H.settingsActionBtn} ${H.settingsActionBtnDanger}`,onClick:async()=>{if(h){c("local");try{!function(){const{keys:e}=Ne();for(const t of e)try{localStorage.removeItem(t)}catch{}}(),n("Local data cleared"),a?.(),t(),window.location.reload()}catch{n("Could not clear local data")}finally{c(null)}}else m(!0)},disabled:null!==l,title:"Clear all local data including artboards, drafts, and sessions. You will be logged out.",children:"local"===l?"Clearing…":h?"Yes, clear everything":"Clear local data"}),h&&e.jsx("button",{type:"button",className:H.settingsActionBtn,onClick:()=>m(!1),children:"Cancel"})]})]}),e.jsxs("section",{className:H.settingsSection,children:[e.jsx("h3",{className:H.settingsSubtitle,children:"App updates"}),e.jsx("button",{type:"button",className:H.settingsActionBtn,onClick:async()=>{u(!0);try{const e=await(navigator.serviceWorker?.getRegistration());if(!e)return void n("Service worker not active");await e.update(),e.waiting?n("Update available. Refresh to apply."):n("You're up to date")}catch{n("Could not check for updates")}finally{u(!1)}},disabled:d||!("serviceWorker"in navigator),title:"Check for a new version of ArtSky",children:d?"Checking…":"Check for updates"})]}),e.jsx("button",{type:"button",className:H.aboutClose,onClick:t,"aria-label":"Close",children:"Close"})]})})]})}const Ee="_wrap_996id_1",Le="_wrapDropdown_996id_6",Ae="_feedRow_996id_11",Fe="_tabs_996id_20",Be="_feedRowAdd_996id_28",$e="_addFeedPage_996id_34",Me="_helpBtn_996id_42",Pe="_header_996id_49",Te="_headerTitle_996id_59",Re="_headerActions_996id_66",We="_editFeedsBtn_996id_73",De="_editFeedsDoneBtn_996id_74",Ie="_editFeedsSection_996id_90",Oe="_editFeedsBtnPage_996id_94",Ue="_editFeedsList_996id_114",He="_editFeedsItem_996id_120",ze="_editFeedsOrderBtns_996id_129",Ke="_editFeedsOrderBtn_996id_129",qe="_editFeedsRemovePlaceholder_996id_164",Ve="_editFeedsLabel_996id_173",Ge="_editFeedsRemoveBtn_996id_183",Ye="_helpWrap_996id_199",Je="_helpModalOverlay_996id_246",Qe="_helpModalCard_996id_258",Xe="_helpModalIntro_996id_285",Ze="_helpModalSubtitle_996id_293",et="_helpModalShortcuts_996id_303",tt="_helpModalClose_996id_324",nt="_feedContextMenu_996id_345",at="_feedContextMenuItem_996id_356",st="_section_996id_374",rt="_sectionAdd_996id_391",it="_customForm_996id_395",ot="_addFeed_996id_34",lt="_sectionHint_996id_403",ct="_ratioHint_996id_410",dt="_feedPillWrap_996id_431",ut="_wrapTouchFriendly_996id_448",ht="_feedPillRow_996id_463",mt="_ratioBtnSide_996id_463",ft="_feedPillWithFill_996id_470",pt="_feedPillRemoveBtn_996id_551",xt="_feedPillColumn_996id_584",gt="_ratioBtnRow_996id_591",jt="_feedPillLabel_996id_650",vt="_feedPillRatio_996id_651",bt="_feedPillInactive_996id_661",yt="_customInputWrap_996id_744",wt="_input_996id_748",kt="_customSuggestionsWrap_996id_758",Nt="_customSuggestionsSection_996id_777",_t="_customSuggestionsLoading_996id_786",Ct="_customSuggestions_996id_758",St="_customSuggestionItem_996id_804",Et="_customActions_996id_820",Lt="_btn_996id_825",At="_btnSecondary_996id_840";function Ft(e){if("undefined"==typeof window)return()=>{};const t=window.matchMedia("(min-width: 768px)");return t.addEventListener("change",e),()=>t.removeEventListener("change",e)}function Bt(){return"undefined"!=typeof window&&window.innerWidth>=768}function $t(e,t){return(e.uri??e.label)===(t.uri??t.label)}function Mt({sources:t,fallbackSource:n,mixEntries:s,onToggle:o,setEntryPercent:l,onAddCustom:c,onToggleWhenGuest:d,variant:u="page",touchFriendly:h=!1,removableSourceUris:m,onRemoveFeed:f,onShareFeed:p,onReorderSources:x}){const{session:g}=r(),[j,v]=R.useState(""),[b,y]=R.useState(!1),[w,k]=R.useState(!1),[N,_]=R.useState(!1),[C,S]=R.useState([]),[E,L]=R.useState(!1),[A,F]=R.useState(""),[B,$]=R.useState(null),[M,P]=R.useState(!1),T=R.useRef(null),W=R.useRef(null),I=R.useRef(null),O=R.useRef(null),U=R.useSyncExternalStore(Ft,Bt,()=>!1),H=j.trim().toLowerCase(),z=H?H.split(/\s+/).filter(Boolean):[],K=(z.length>0?t.filter(e=>{const t=(e.label??"").toLowerCase(),n=(e.uri??"").toLowerCase();return z.every(e=>t.includes(e)||n.includes(e))}):[]).slice(0,10);R.useEffect(()=>{if(!b)return S([]),void F("");const e=j.trim();return O.current&&(clearTimeout(O.current),O.current=null),O.current=setTimeout(()=>{if(O.current=null,""===e)return void(g?(F("Suggested feeds"),L(!0),a(10).then(e=>{S((e??[]).map(e=>({kind:"custom",label:e.displayName??e.uri??"",uri:e.uri})))}).catch(()=>S([])).finally(()=>L(!1))):S([]));if(/^@?[a-zA-Z0-9.-]+$/.test(e)&&e.length>=2){const t=e.replace(/^@/,"");F(`Feeds by @${t}`),L(!0),i(t,20).then(e=>{S(e.map(e=>({kind:"custom",label:e.displayName??e.uri,uri:e.uri})))}).catch(()=>S([])).finally(()=>L(!1))}else S([]),F("")},350),()=>{O.current&&clearTimeout(O.current)}},[b,j,g]),R.useEffect(()=>{if(N)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){T.current&&!T.current.contains(e.target)&&_(!1)}},[N]),R.useEffect(()=>{if(B)return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e,{passive:!0}),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)};function e(e){const t=e.target;W.current?.contains(t)||$(null)}},[B]);const q=s.length>=2,V="dropdown"===u,G=(t.filter(e=>e.uri&&m?.has(e.uri)).length>0||t.length>0&&x)&&(f||x);R.useEffect(()=>{M&&0===t.length&&P(!1)},[M,t.length]),R.useEffect(()=>{if(!N||V)return;const e=e=>{"Escape"===e.key&&(e.preventDefault(),_(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[N,V]);const Y=e.jsx("div",{className:Ye,ref:T,children:e.jsx("button",{type:"button",className:Me,onClick:()=>_(e=>!e),"aria-label":"Explain remix feed and shortcuts","aria-expanded":N,title:"How mixing works",children:"?"})}),J=N?D.createPortal(e.jsx("div",{className:Je,onClick:()=>_(!1),role:"dialog","aria-label":"Feed mix and shortcuts",children:e.jsxs("div",{className:Qe,onClick:e=>e.stopPropagation(),children:[e.jsx("p",{className:Xe,children:"Use + or - to change how many posts you see from each feed."}),U&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:Ze,children:"Keyboard shortcuts"}),e.jsxs("dl",{className:et,children:[e.jsx("dt",{children:"W / ↑"}),e.jsx("dd",{children:"Move up"}),e.jsx("dt",{children:"A / ←"}),e.jsx("dd",{children:"Move left"}),e.jsx("dt",{children:"S / ↓"}),e.jsx("dd",{children:"Move down"}),e.jsx("dt",{children:"D / →"}),e.jsx("dd",{children:"Move right"}),e.jsx("dt",{children:"Q"}),e.jsx("dd",{children:"Quit / close window"}),e.jsx("dt",{children:"E"}),e.jsx("dd",{children:"Enter post"}),e.jsx("dt",{children:"R"}),e.jsx("dd",{children:"Reply to post"}),e.jsx("dt",{children:"T"}),e.jsx("dd",{children:"Toggle text view"}),e.jsx("dt",{children:"F"}),e.jsx("dd",{children:"Like / unlike"}),e.jsx("dt",{children:"C"}),e.jsx("dd",{children:"Collect post"}),e.jsx("dt",{children:"B"}),e.jsx("dd",{children:"Block author (feed)"}),e.jsx("dt",{children:"4"}),e.jsx("dd",{children:"Follow author"}),e.jsx("dt",{children:"Escape"}),e.jsx("dd",{children:"Escape all windows"}),e.jsx("dt",{children:"1 / 2 / 3"}),e.jsx("dd",{children:"1, 2, or 3 column view"})]})]}),e.jsx("button",{type:"button",className:tt,onClick:()=>_(!1),"aria-label":"Close",children:"Close"})]})}),document.body):null,Q=e.jsx(e.Fragment,{children:t.map(t=>{const a=s.findIndex(e=>$t(e.source,t)),r=a>=0||0===s.length&&$t(t,n),i=r?s[a]:null,c=r&&s.length>=2&&i,u=c&&(i?.percent??0)>=5,h=c&&(i?.percent??0)<100,x=!r,g=i?.percent??0,j=e.jsxs("button",{type:"button",className:`${ft} ${r?"":bt}`,style:r&&i?g>=100?{background:"var(--accent)"}:{backgroundColor:"var(--surface)",backgroundImage:`linear-gradient(to right, var(--accent) 0%, var(--accent) ${g}%, transparent ${g}%)`}:void 0,onClick:()=>d?d():o(t),children:[e.jsx("span",{className:jt,children:t.label}),e.jsx("span",{className:vt,children:r&&i?`${g}% of posts`:"0% of posts"})]}),v=e.jsx("button",{type:"button",className:mt,disabled:!u,onClick:e=>{e.stopPropagation(),d?d():u&&l(a,Math.max(0,(i?.percent??0)-5))},"aria-label":"Fewer posts from this feed",children:"−"}),b=e.jsx("button",{type:"button",className:mt,disabled:!h&&!x,onClick:e=>{e.stopPropagation(),d?d():x?o(t):h&&l(a,Math.min(100,(i?.percent??0)+5))},"aria-label":x?"Add feed to mix":"More posts from this feed",children:"+"}),y=p||f&&t.uri&&m?.has(t.uri),w=!(!t.uri||!m?.has(t.uri)),k=(e,n)=>{y&&$({source:t,x:e,y:n})};return e.jsxs("div",{className:dt,onContextMenu:e=>{y&&(e.preventDefault(),k(e.clientX,e.clientY))},onTouchStart:e=>{if(!y||0===e.changedTouches.length)return;const t=e.changedTouches[0];I.current=setTimeout(()=>{I.current=null,k(t.clientX,t.clientY)},500)},onTouchEnd:()=>{I.current&&(clearTimeout(I.current),I.current=null)},onTouchMove:()=>{I.current&&(clearTimeout(I.current),I.current=null)},children:[!V&&M&&w&&f&&e.jsx("button",{type:"button",className:pt,onClick:e=>{e.stopPropagation(),f(t)},"aria-label":`Remove ${t.label} from pinned feeds`,title:"Remove from pinned feeds",children:"×"}),V?e.jsxs("div",{className:ht,children:[v,j,b]}):e.jsxs("div",{className:xt,children:[j,e.jsxs("div",{className:gt,children:[v,b]})]})]},t.uri??t.label)})}),X=K.length>0||C.length>0||E,Z=b?e.jsxs("form",{onSubmit:async function(e){e.preventDefault();const t=j.trim();if(!t)return;if(/^(https?:\/\/|at:\/\/)/i.test(t)||t.includes("bsky.app")){k(!0);try{await c(t),y(!1),v("")}finally{k(!1)}}else{if(1===K.length)return o(K[0]),y(!1),void v("");if(1!==C.length){k(!0);try{await c(t),y(!1),v("")}finally{k(!1)}}else{k(!0);try{await c(C[0]),y(!1),v("")}finally{k(!1)}}}},className:it,children:[e.jsxs("div",{className:yt,children:[e.jsx("input",{type:"text",placeholder:"Paste feed URL, or type a handle to find their feeds…",value:j,onChange:e=>v(e.target.value),className:wt,disabled:w,autoComplete:"off","aria-autocomplete":"list","aria-controls":X?"feed-search-suggestions":void 0,"aria-expanded":X}),(K.length>0||C.length>0||E)&&e.jsxs("div",{id:"feed-search-suggestions",className:kt,"aria-label":"Feeds",children:[K.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Nt,children:"Your feeds"}),e.jsx("ul",{className:Ct,role:"listbox","aria-label":"Your feeds",children:K.map(t=>e.jsx("li",{role:"option",children:e.jsx("button",{type:"button",className:St,onClick:()=>(o(t),v(""),void y(!1)),children:t.label})},t.uri??t.label))})]}),E&&0===C.length&&e.jsx("div",{className:_t,children:"Searching…"}),C.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Nt,children:A}),e.jsx("ul",{className:Ct,role:"listbox","aria-label":A,children:C.map(t=>e.jsx("li",{role:"option",children:e.jsx("button",{type:"button",className:St,onClick:()=>async function(e){if(e.uri)if(d)d();else{k(!0);try{await c(e),y(!1),v("")}finally{k(!1)}}}(t),disabled:w,children:t.label})},t.uri??t.label))})]})]})]}),e.jsxs("div",{className:Et,children:[e.jsx("button",{type:"submit",className:Lt,disabled:w,children:w?"Adding…":"Add"}),e.jsx("button",{type:"button",className:At,onClick:()=>y(!1),disabled:w,children:"Cancel"})]})]}):e.jsx("button",{type:"button",className:V?ot:$e,onClick:()=>d?d():y(!0),children:"+ Add Custom Feed"}),ee=B&&(p||f)?e.jsxs("div",{ref:W,className:nt,style:{left:B.x+4,top:B.y+4},role:"menu",children:[f&&B.source.uri&&m?.has(B.source.uri)&&e.jsx("button",{type:"button",className:at,role:"menuitem",onClick:()=>{f(B.source),$(null)},children:"Delete"}),p&&e.jsx("button",{type:"button",className:at,role:"menuitem",onClick:()=>{p(B.source),$(null)},children:"Copy link"})]}):null;return V?e.jsxs("div",{className:`${Ee} ${Le} ${h?ut:""}`,children:[ee,J,e.jsxs("header",{className:Pe,children:[e.jsx("span",{className:Te,children:M?"Edit feeds":"Feeds"}),e.jsxs("div",{className:Re,children:[M?e.jsx("button",{type:"button",className:De,onClick:()=>P(!1),children:"Done"}):G?e.jsx("button",{type:"button",className:We,onClick:()=>P(!0),children:"Edit"}):null,Y]})]}),M?e.jsxs("section",{className:Ie,"aria-label":"Edit feeds",children:[e.jsx("p",{className:lt,children:"Use ↑ ↓ to change order. Tap Remove to delete a feed from your list."}),e.jsx("ul",{className:Ue,children:t.map((n,a)=>{const s=x&&a>0,r=x&&a<t.length-1,i=n.uri&&m?.has(n.uri);return e.jsxs("li",{className:He,children:[e.jsxs("div",{className:ze,children:[e.jsx("button",{type:"button",className:Ke,onClick:()=>{if(!s||!x)return;const e=[...t];[e[a-1],e[a]]=[e[a],e[a-1]],x(e)},disabled:!s,"aria-label":`Move ${n.label} up`,title:"Move up",children:"↑"}),e.jsx("button",{type:"button",className:Ke,onClick:()=>{if(!r||!x)return;const e=[...t];[e[a],e[a+1]]=[e[a+1],e[a]],x(e)},disabled:!r,"aria-label":`Move ${n.label} down`,title:"Move down",children:"↓"})]}),e.jsx("span",{className:Ve,children:n.label}),i?e.jsx("button",{type:"button",className:Ge,onClick:()=>f?.(n),"aria-label":`Remove ${n.label}`,children:"Remove"}):e.jsx("span",{className:qe,"aria-hidden":!0})]},n.uri??n.label??a)})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:st,"aria-label":"Choose feeds",children:[e.jsx("p",{className:lt,children:"Tap a feed to add or remove it from your mix."}),e.jsx("div",{className:Fe,children:Q}),q&&e.jsx("p",{className:ct,children:"Use − and + on each side of a feed to set how many posts you see from it."})]}),e.jsx("section",{className:rt,children:Z})]})]}):e.jsxs("div",{className:Ee,children:[ee,J,e.jsx("div",{className:Ae,children:e.jsxs("div",{className:Fe,children:[Q,G?e.jsx("button",{type:"button",className:Oe,onClick:()=>P(e=>!e),children:M?"Done":"Edit"}):null,Y]})}),e.jsx("div",{className:Be,children:Z})]})}const Pt="_wrap_1sgom_1",Tt="_mirror_1sgom_7",Rt="_textarea_1sgom_24",Wt="_dropdown_1sgom_43",Dt="_loading_1sgom_60",It="_list_1sgom_66",Ot="_item_1sgom_74",Ut="_itemActive_1sgom_75",Ht="_avatar_1sgom_98",zt="_avatarPlaceholder_1sgom_106",Kt="_itemMain_1sgom_120",qt="_handle_1sgom_127",Vt="_tag_1sgom_128",Gt="_forumTitle_1sgom_132",Yt="_meta_1sgom_139",Jt=["@","#","%"];function Qt({value:t,onChange:a,onKeyDown:s,placeholder:r,rows:i=3,maxLength:d,disabled:u,autoFocus:h,className:m,id:f,"aria-label":p,inputRef:x}){const g=R.useRef(null),j=x??g,v=R.useRef(null),b=R.useRef(null),y=R.useRef(null),w=R.useRef(null),k=R.useRef(null),[N,_]=R.useState([]),[C,S]=R.useState(!1),[E,L]=R.useState(0),[A,F]=R.useState(!1),[B,$]=R.useState(0),[M,P]=R.useState(null),T=R.useRef(null),W=R.useRef(null),I=280,O=R.useMemo(()=>function(e,t){const n=e.slice(0,t);for(const a of Jt){const e=n.lastIndexOf(a);if(-1===e)continue;const t=0===e?" ":n[e-1];if(" "!==t&&"\n"!==t)continue;const s=n.slice(e+1);if(!("@"===a&&/[\s\n]/.test(s)||"#"===a&&/[\s\n]/.test(s)))return{trigger:a,query:s,startIndex:e}}return null}(t,B),[t,B]),U=R.useCallback(()=>{const e=j.current;e&&$(e.selectionStart)},[j]),H=R.useCallback(async(e,t)=>{if("@"===e){const e=t.trim();if(!e)return void _([]);S(!0);try{const{actors:t}=await n(e,8);_((t??[]).map(e=>({type:"user",handle:e.handle??e.did,displayName:e.displayName,avatar:e.avatar})))}catch{_([])}finally{S(!1)}return}if("#"===e){const e=t.trim().toLowerCase().replace(/\s+/g,"-");if(!e)return void _([]);S(!0);try{const{posts:t}=await o(e,void 0);_([{type:"tag",tag:e,count:t?.length??0}])}catch{_([{type:"tag",tag:e}])}finally{S(!1)}return}if("%"===e){S(!0);try{const e=await l(t,8);_(e.map(e=>({type:"forum",doc:e})))}catch{_([])}finally{S(!1)}}},[]);R.useEffect(()=>{if(!O)return T.current=null,F(!1),void _([]);T.current=O;const{trigger:e,query:t}=O;return W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{W.current=null,H(e,t).then(()=>{L(0),F(!0)})},200),()=>{W.current&&clearTimeout(W.current)}},[O,H]);const z=R.useCallback(e=>{const n=T.current;if(!n||!j.current)return;const s=n.startIndex,r=s+1+n.query.length;let i;i="user"===e.type?`@${e.handle}`:"tag"===e.type?`#${e.tag}`:c(e.doc);const o=t.slice(0,s),l=t.slice(r),u=o+i+l;a(null!=d?u.slice(0,d):u),F(!1),_([]),requestAnimationFrame(()=>{j.current?.focus();const e=s+i.length;j.current?.setSelectionRange(e,e)})},[t,a,d,j]),K=R.useCallback(e=>{if(A&&N.length>0){if("ArrowDown"===e.key)return e.preventDefault(),void L(e=>(e+1)%N.length);if("ArrowUp"===e.key)return e.preventDefault(),void L(e=>(e-1+N.length)%N.length);if("Enter"===e.key||"Tab"===e.key)return e.preventDefault(),void z(N[E]);if("Escape"===e.key)return e.preventDefault(),F(!1),void _([])}s?.(e)},[A,N,E,z,s]),q=R.useCallback(e=>{const t=e.target.value;a(null!=d?t.slice(0,d):t),$(e.target.selectionStart)},[a,d]),V=R.useCallback(()=>{U()},[U]),G=R.useCallback(()=>{F(!1),_([])},[]);R.useEffect(()=>{if(!A||!b.current)return;const e=b.current.children[E];e?.scrollIntoView({block:"nearest",behavior:"smooth"})},[E,A]);const Y=O?.startIndex??-1,J=A&&Y>=0&&(N.length>0||C);R.useLayoutEffect(()=>{if(!J||!w.current||!j.current)return void P(null);const e=w.current.getBoundingClientRect(),t=("undefined"!=typeof window?window.innerHeight-e.bottom:400)<288&&e.top>288;P({left:e.left,...t?{bottom:"undefined"!=typeof window?window.innerHeight-e.top+4:void 0}:{top:e.bottom+4},above:t})},[J,t,Y,N.length,C]),R.useEffect(()=>{A||P(null)},[A]);const Q=R.useCallback(()=>{if(!J||!w.current)return;const e=w.current.getBoundingClientRect(),t=("undefined"!=typeof window?window.innerHeight-e.bottom:400)<288&&e.top>288;P({left:e.left,...t?{bottom:"undefined"!=typeof window?window.innerHeight-e.top+4:void 0}:{top:e.bottom+4},above:t})},[J]);return R.useEffect(()=>{if(!J)return;const e=j.current;if(!e)return;const t=()=>Q(),n=e.ownerDocument?.defaultView;return n?.addEventListener("scroll",t,!0),n?.addEventListener("resize",Q),()=>{n?.removeEventListener("scroll",t,!0),n?.removeEventListener("resize",Q)}},[J,Q]),e.jsxs("div",{ref:v,className:Pt,children:[J&&e.jsxs("div",{ref:y,className:Tt,"aria-hidden":!0,children:[t.slice(0,Y),e.jsx("span",{ref:w})]}),e.jsx("textarea",{ref:j,id:f,className:m??Rt,value:t,onChange:q,onSelect:V,onBlur:G,onKeyUp:U,onKeyDown:K,placeholder:r,rows:i,maxLength:d,disabled:u,autoFocus:h,"aria-label":p}),A&&(N.length>0||C)&&(()=>{const t=e.jsx("div",{ref:k,className:Wt,role:"listbox","aria-label":"Suggestions",style:M?{position:"fixed",left:M.left,...M.above?{bottom:M.bottom,top:"auto"}:{top:M.top},right:"auto",width:"max(200px, min(320px, 90vw))",maxHeight:I}:void 0,children:C&&0===N.length?e.jsx("div",{className:Dt,children:"Searching…"}):e.jsx("ul",{ref:b,className:It,children:N.map((t,n)=>e.jsxs("li",{className:n===E?Ut:Ot,role:"option","aria-selected":n===E,onMouseDown:e=>{e.preventDefault(),z(t)},children:["user"===t.type&&e.jsxs(e.Fragment,{children:[t.avatar?e.jsx("img",{src:t.avatar,alt:"",className:Ht}):e.jsx("span",{className:zt,children:(t.displayName??t.handle).slice(0,1).toUpperCase()}),e.jsxs("span",{className:Kt,children:[e.jsxs("span",{className:qt,children:["@",t.handle]}),t.displayName&&e.jsx("span",{className:Yt,children:t.displayName})]})]}),"tag"===t.type&&e.jsxs("span",{className:Kt,children:[e.jsxs("span",{className:Vt,children:["#",t.tag]}),null!=t.count&&t.count>0&&e.jsxs("span",{className:Yt,children:[t.count," posts"]})]}),"forum"===t.type&&e.jsxs("span",{className:Kt,children:[e.jsx("span",{className:Gt,children:t.doc.title??t.doc.path??t.doc.uri}),t.doc.authorHandle&&e.jsxs("span",{className:Yt,children:["@",t.doc.authorHandle]})]})]},"user"===t.type?t.handle:"tag"===t.type?t.tag:t.doc.uri))})});return M&&"undefined"!=typeof document?D.createPortal(t,document.body):t})()]})}const Xt="_wrap_11h49_1",Zt="_count_11h49_7",en="_circle_11h49_14",tn="_circleBg_11h49_20",nn="_circleBar_11h49_25",an=10,sn=2*Math.PI*an;function rn({used:t,max:n,className:a}){const s=Math.max(0,n-t),r=sn*(1-(n>0?t/n:0));return e.jsxs("div",{className:`${Xt} ${a??""}`,"aria-live":"polite","data-low":s>0&&s<=20?"true":void 0,"data-zero":0===s?"true":void 0,children:[e.jsx("span",{className:Zt,children:s}),e.jsxs("svg",{className:en,viewBox:"0 0 24 24","aria-hidden":!0,children:[e.jsx("circle",{className:tn,cx:12,cy:12,r:an,fill:"none"}),e.jsx("circle",{className:nn,cx:12,cy:12,r:an,fill:"none",strokeDasharray:sn,strokeDashoffset:r,strokeLinecap:"round",transform:"rotate(-90 12 12)"})]})]})}const on="_toast_11tlr_1",ln="_message_11tlr_20",cn="_actions_11tlr_24",dn="_updateBtn_11tlr_30",un="_dismissBtn_11tlr_31";function hn(){const{needRefresh:t,offlineReady:n,updateServiceWorker:a,close:s}=function(){const[e,t]=R.useState(!1),[n,a]=R.useState(!1),[s,r]=R.useState(()=>Promise.resolve());return R.useEffect(()=>{"serviceWorker"in navigator&&d(async()=>{const{registerSW:e}=await import("./virtual_pwa-register-DDfxV8nQ.js");return{registerSW:e}},__vite__mapDeps([0,1,2,3,4])).then(({registerSW:e})=>{const n=e({onNeedRefresh(){t(!0)},onOfflineReady(){a(!0)}});r(()=>n)}).catch(()=>{})},[]),{needRefresh:e,offlineReady:n,updateServiceWorker:s,close:R.useCallback(()=>{t(!1),a(!1)},[])}}();return t||n?e.jsxs("div",{className:`sw-update-toast ${on}`,role:"alert","aria-live":"polite",children:[e.jsx("span",{className:ln,children:t?"Update available":"App ready for offline use"}),e.jsxs("div",{className:cn,children:[t&&e.jsx("button",{type:"button",className:dn,onClick:()=>a(!0),children:"Update"}),e.jsx("button",{type:"button",className:un,onClick:s,children:t?"Later":"Dismiss"})]})]}):null}const mn=[{kind:"timeline",label:"Following"},{kind:"custom",label:"What's Hot",uri:"at://did:plc:z72i7hdynmk6r22z27h6tvur/app.bsky.feed.generator/whats-hot"}],fn="artsky-hidden-preset-feeds",pn="artsky-feed-order";function xn(e){return`${fn}-${e||"guest"}`}function gn(e){return`${pn}-${e||"guest"}`}function jn(e){return e.uri??("timeline"===e.kind?"timeline":e.label??"")}function vn(e){try{const t=xn(e);let n=localStorage.getItem(t),a=!1;if(n||"guest"===e||(n=localStorage.getItem(fn),a=!!n),!n)return new Set;const s=JSON.parse(n),r=Array.isArray(s)?new Set(s):new Set;if(a&&"guest"!==e)try{localStorage.setItem(t,JSON.stringify([...r]))}catch{}return r}catch{return new Set}}function bn(e){try{const t=gn(e);let n=localStorage.getItem(t),a=!1;if(n||"guest"===e||(n=localStorage.getItem(pn),a=!!n),!n)return[];const s=JSON.parse(n),r=Array.isArray(s)?s:[];if(a&&"guest"!==e)try{localStorage.setItem(t,JSON.stringify(r))}catch{}return r}catch{return[]}}const yn=U.createContext({wrapperRef:null,setHandlers:null});function wn({active:t}){const n=t?2.5:2;return e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}function kn(){return e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})}function Nn(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),e.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),e.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})}function _n({active:t}){const n=t?2.5:2;return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]})}function Cn(){return e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"})})}function Sn(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6"}),e.jsx("line",{x1:"4",y1:"12",x2:"20",y2:"12"}),e.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18"})]})}function En(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}function Ln(){return e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}function An({mode:t}){return"open"===t?e.jsx(z,{size:24}):"half"===t?e.jsx(K,{size:24}):e.jsx(q,{size:24})}function Fn({mode:t}){return"default"===t?e.jsx(V,{size:20}):"minimalist"===t?e.jsx(G,{size:20}):e.jsx(Y,{size:20})}function Bn(){return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("rect",{x:"7",y:"3",width:"10",height:"18",rx:"1"})})}function $n(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"3",y:"3",width:"8",height:"18",rx:"1"}),e.jsx("rect",{x:"13",y:"3",width:"8",height:"18",rx:"1"})]})}function Mn(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"2",y:"3",width:"5",height:"18",rx:"1"}),e.jsx("rect",{x:"9.5",y:"3",width:"5",height:"18",rx:"1"}),e.jsx("rect",{x:"17",y:"3",width:"5",height:"18",rx:"1"})]})}function Pn(){return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}function Tn(){return e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})}function Rn(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),e.jsx("polyline",{points:"10 17 15 12 10 7"}),e.jsx("line",{x1:"15",y1:"12",x2:"3",y2:"12"})]})}function Wn(){return e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"4"}),e.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]})}function Dn(){return e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}function In(){return e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9"}),e.jsx("path",{d:"M12 3v18"}),e.jsx("path",{d:"M6 12a6 6 0 0 1 6-6 6 6 0 0 1 6 6"}),e.jsx("circle",{cx:"16.5",cy:"12",r:"2"})]})}function On(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"3"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function Un(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4M12 8h.01"})]})}function Hn(){return e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"})]})}function zn(){return e.jsx("span",{className:H.mediaModeIconWrap,children:e.jsxs("svg",{viewBox:"0 0 20 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("path",{d:"M10 2v6M5.5 2h9"}),e.jsx("rect",{x:"4",y:"12",width:"12",height:"10",rx:"1"}),e.jsx("circle",{cx:"7.5",cy:"15",r:"1"}),e.jsx("path",{d:"M14.5 21l-2.5-2-4 3"})]})})}function Kn(){return"undefined"!=typeof window&&window.innerWidth>=768}function qn(e){if("undefined"==typeof window)return()=>{};const t=window.matchMedia("(min-width: 768px)");return t.addEventListener("change",e),()=>t.removeEventListener("change",e)}function Vn({title:n,children:a,showNav:i}){const o=I(),l=W(),{openProfileModal:c,openPostModal:d,isModalOpen:U,modalScrollHidden:z,openForumModal:K,openArtboardsModal:q,closeAllModals:V}=t(),G=o.search,Y=/\bforum=1\b/.test(G),Z=/\bartboards=1\b/.test(G)||/\bartboard=/.test(G),{openLoginModal:ee}=u(),ne=h(),{session:ae,sessionsList:se,logout:re,switchAccount:ie}=r(),[oe,le]=R.useState({}),[ce,de]=R.useState(0),ue=R.useMemo(()=>se.map(e=>e.did).sort().join(","),[se]),he=ae?oe[ae.did]?.avatar:null;R.useEffect(()=>{ne?.registerOnSaved(()=>de(e=>e+1))},[ne?.registerOnSaved]),R.useEffect(()=>{if(0===se.length)return void le({});let e=!1;return se.forEach(t=>{oe[t.did]&&0===ce||s.getProfile({actor:t.did}).then(n=>{if(e)return;const a=n.data;le(e=>({...e,[t.did]:{avatar:a.avatar,handle:a.handle}}))}).catch(()=>{})}),()=>{e=!0}},[ue,se,ce]);const{theme:me,setTheme:fe}=m(),{viewMode:pe,setViewMode:xe,cycleViewMode:ge}=f(),{cardViewMode:je,cycleCardView:ve}=p(),{nsfwPreference:be,cycleNsfwPreference:ye}=x(),{mediaMode:we,cycleMediaMode:Ne}=g(),_e=o.pathname,Ce=R.useSyncExternalStore(qn,Kn,()=>!1),Ee=j(),[,Le]=R.useState(!1),[Ae,Fe]=R.useState(!1),[Be,$e]=R.useState(!1),Me=R.useRef(null),[Pe,Te]=R.useState(null),[Re,We]=R.useState("all"),[De,Ie]=R.useState(!1),[Oe,Ue]=R.useState(null),[He,ze]=R.useState(!1),Ke=R.useRef(!1),[qe,Ve]=R.useState([]),Ge=ae?.did??"guest",Ye=R.useRef(Ge),[Je,Qe]=R.useState(()=>vn(Ge)),[Xe,Ze]=R.useState(()=>bn(Ge)),[et,tt]=R.useState(null),nt=R.useRef(null),at=R.useRef(null),st=R.useRef(null),[rt,it]=R.useState([]),[ot,lt]=R.useState(!1),[ct,dt]=R.useState(0),ut=R.useRef(!1),[ht,mt]=R.useState(!1),[ft,pt]=R.useState(!1),[xt,gt]=R.useState(0),[jt,vt]=R.useState([{id:Math.random().toString(36).slice(2),text:"",images:[],imageAlts:[]}]),[bt,yt]=R.useState(0),[wt,kt]=R.useState(!1),[Nt,_t]=R.useState(null),Ct=R.useRef(null),St=R.useRef(null),Et=jt[bt]??{text:"",images:[],imageAlts:[]},[Lt,At]=R.useState(!1),[Ft,Bt]=R.useState(!1),$t=R.useRef(null),Pt=R.useRef(null),Tt=R.useRef(0),Rt=R.useRef(null),[Wt,Dt]=R.useState(!1),[It,Ot]=R.useState(!1),[Ut,Ht]=R.useState(0),zt=R.useRef(null),Kt=R.useRef(null),qt=R.useRef(null),Vt=R.useRef(null),Gt=R.useRef(null),Yt=R.useRef(""),Jt=R.useRef(""),Xt=R.useRef(null),Zt=R.useRef(null),en=R.useRef(!1),tn=R.useRef(null),nn=R.useRef(!1),an=R.useRef(null),sn=R.useRef(!1),on=R.useRef(null),ln=v(),cn=b(),{entries:dn,setEntryPercent:un,toggleSource:fn,addEntry:pn,setSingleFeed:Vn}=y(),Gn=new Set(mn.map(e=>e.uri).filter(Boolean)),Yn=mn.filter(e=>!e.uri||!Je.has(e.uri)),Jn=qe.filter(e=>!e.uri||!Gn.has(e.uri)),Qn=R.useMemo(()=>{const e=[...Yn,...Jn];if(0===Xe.length)return e;const t=new Map(Xe.map((e,t)=>[e,t]));return[...e].sort((e,n)=>(t.get(jn(e))??9999)-(t.get(jn(n))??9999))},[Yn,Jn,Xe]),Xn=Yn[0]??mn[0],Zn=R.useCallback(e=>{0===dn.length?(pn(Xn),pn(e)):fn(e)},[dn.length,pn,fn]),ea=R.useCallback(e=>{const t=e.map(jn).filter(Boolean);Ze(t);try{localStorage.setItem(gn(Ge),JSON.stringify(t))}catch{}},[Ge]),ta=R.useMemo(()=>new Set([...Jn.map(e=>e.uri).filter(Boolean),...Gn]),[Jn]),na=R.useCallback(()=>{tn.current=setTimeout(()=>{en.current=!0,ln?.clearSeenAndShowAll(),tn.current=null},500)},[ln]),aa=R.useCallback(()=>{tn.current&&(clearTimeout(tn.current),tn.current=null)},[]),sa=R.useRef(null),ra=R.useCallback(e=>{sa.current=e.currentTarget,an.current=setTimeout(()=>{nn.current=!0,ln?.announceShowSeen(sa.current??void 0),ln?.clearSeenAndShowAll(),an.current=null},500)},[ln]),ia=R.useCallback(()=>{an.current&&(clearTimeout(an.current),an.current=null)},[]),oa=R.useCallback(e=>{nn.current?nn.current=!1:(ln?.onHideSeenOnly(e?.currentTarget??void 0),"/feed"!==_e&&l("/feed"))},[ln,_e,l]),la=R.useCallback(()=>{on.current=setTimeout(()=>{sn.current=!0,Fe(!0),on.current=null},500)},[]),ca=R.useCallback(()=>{on.current&&(clearTimeout(on.current),on.current=null)},[]),da=R.useCallback(()=>{if(sn.current)sn.current=!1;else if(ae){const e=oe[ae.did]?.handle??ae.handle??ae.did;Fe(!1),c(e)}else Fe(e=>!e)},[ae,oe,c]),ua=R.useCallback(e=>{if(en.current)return en.current=!1,void e.preventDefault();e.preventDefault(),U?(V(),"/feed"!==_e&&l("/feed")):"/feed"===_e?ln?.onHomeClick():l("/feed")},[_e,ln,l,U,V]);R.useEffect(()=>{document.title=n?`${n} · ArtSky`:"ArtSky"},[n]),R.useEffect(()=>{const e=e=>{if(U)return;const t=e.target;if("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||t.isContentEditable)return void("Escape"===e.key&&(e.preventDefault(),t.blur()));if(e.ctrlKey||e.metaKey)return;const n=e.key.toLowerCase();return"1"===n||"2"===n||"3"===n?(e.preventDefault(),void xe(n)):"t"===n?(e.preventDefault(),void Ne()):void("q"!==n&&"Backspace"!==e.key||("q"!==n||"/"!==o.pathname&&!o.pathname.startsWith("/feed"))&&(e.preventDefault(),l(-1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,U,xe,Ne,o.pathname]),R.useEffect(()=>{if(!Ae)return;const e=e=>{const t=e.target;qt.current?.contains(t)||Kt.current?.contains(t)||Fe(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ae]),R.useEffect(()=>{if(!Ft)return;const e=e=>{const t=e.target;$t.current?.contains(t)||Pt.current?.contains(t)||Bt(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Ft]),R.useEffect(()=>{if(!Wt)return;const e=e=>{"Escape"===e.key&&(e.preventDefault(),Dt(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Wt]),R.useEffect(()=>{if(!It)return;const e=e=>{"Escape"===e.key&&(e.preventDefault(),Ot(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[It]),R.useEffect(()=>{if(!Be)return;const e=e=>{const t=e.target;Vt.current?.contains(t)||Gt.current?.contains(t)||$e(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Be]);const ha=R.useCallback(async e=>{if(ae)try{const t=(await w()).filter(e=>"feed"===e.type&&e.pinned),n=await Promise.all(t.map(async e=>({kind:"custom",label:await k(e.value).catch(()=>e.value),uri:e.value}))),a=new Set(n.map(e=>e.uri).filter(Boolean));Ve(t=>{const s=[...n];for(const e of t)!e.uri||a.has(e.uri)||s.some(t=>t.uri===e.uri)||s.push(e);return e?.uri&&!s.some(t=>t.uri===e.uri)&&s.push(e),s})}catch{Ve([])}else Ve([])},[ae]),ma=R.useCallback(async e=>{if(e.uri)if(ae){tt(null);try{const t=await N(e.uri);await _(t);const n={kind:"custom",label:e.label??await k(t),uri:t};Ve(e=>e.some(e=>e.uri===t)?e:[...e,n]),Zn(n),await ha(n),l("/feed",{state:{feedSource:n}})}catch(t){tt(t instanceof Error?t.message:"Could not add feed. Try again."),l("/feed",{state:{feedSource:e}})}}else l("/feed",{state:{feedSource:e}});else l("/feed",{state:{feedSource:e}})},[ae,l,Zn,ha]),fa=R.useCallback(async e=>{if(e.uri)try{await C(e.uri),Ve(t=>t.filter(t=>t.uri!==e.uri)),dn.some(t=>t.source.uri===e.uri)&&fn(e),Gn.has(e.uri)&&Qe(t=>{const n=new Set(t);n.add(e.uri);try{localStorage.setItem(xn(Ge),JSON.stringify([...n]))}catch{}return n}),await ha()}catch{}},[dn,fn,ha,Ge]),pa=R.useCallback(async e=>{if(e.uri)try{const t=await S(e.uri);await navigator.clipboard.writeText(t)}catch{}},[]);R.useEffect(()=>{if(Ye.current!==Ge){try{localStorage.setItem(xn(Ye.current),JSON.stringify([...Je])),localStorage.setItem(gn(Ye.current),JSON.stringify(Xe))}catch{}Qe(vn(Ge)),Ze(bn(Ge)),Ye.current=Ge}},[Ge,Je,Xe]);const xa=R.useRef(!1);R.useEffect(()=>{ae?xa.current||(xa.current=!0,ha()):xa.current=!1},[ae,ha]),R.useEffect(()=>{De&&ae&&ha()},[De,ae,ha]),R.useEffect(()=>{De&&tt(null)},[De]),R.useEffect(()=>{Ke.current&&!De&&Ue(360),Ke.current=De},[De]),R.useEffect(()=>{if(!He||null!==Oe)return;const e=requestAnimationFrame(()=>{ze(!1)});return()=>cancelAnimationFrame(e)},[He,Oe]),R.useEffect(()=>{if(!De)return;const e=e=>{const t=e.target;nt.current?.contains(t)||at.current?.contains(t)||Ie(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[De]),R.useEffect(()=>{Be&&ae&&(lt(!0),E(30).then(({notifications:e})=>{it(e),dt(0),L().catch(()=>{})}).catch(()=>it([])).finally(()=>lt(!1)))},[Be,ae]),R.useEffect(()=>{if(!Be||!ae||0===rt.length)return;Jt.current=Yt.current,Zt.current=null;const e=setTimeout(()=>{const e=document.querySelectorAll("[data-notifications-list]");if(0===e.length)return;const t=()=>{const e=Jt.current;""!==e&&e!==Yt.current&&(Yt.current=e,L(e).then(()=>{it(t=>t.map(t=>t.indexedAt<=e?{...t,isRead:!0}:t));const t=rt.filter(t=>t.indexedAt<=e&&!t.isRead).length;dt(e=>Math.max(0,e-t))}).catch(()=>{}))},n=new IntersectionObserver(e=>{for(const t of e){if(!t.isIntersecting)continue;const e=t.target.getAttribute("data-indexed-at");e&&(""===Jt.current||e>Jt.current)&&(Jt.current=e)}Xt.current&&clearTimeout(Xt.current),Xt.current=setTimeout(t,400)},{root:null,rootMargin:"0px",threshold:.25}),a=[];e.forEach(e=>{e.querySelectorAll("[data-indexed-at]").forEach(e=>{n.observe(e),a.push(e)})}),Zt.current=()=>{Xt.current&&clearTimeout(Xt.current),a.forEach(e=>n.unobserve(e))}},0);return()=>{clearTimeout(e),Zt.current?.(),Zt.current=null}},[Be,ae,rt]),R.useEffect(()=>{ae?A().then(e=>{ut.current?dt(e):(ut.current=!0,dt(0))}).catch(()=>dt(0)):ut.current=!1},[ae]);const ga=R.useRef(0);R.useEffect(()=>{if(ae&&"undefined"!=typeof document)return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e);function e(){"visible"===document.visibilityState&&Date.now()-ga.current>12e4&&(ga.current=Date.now(),A().then(dt).catch(()=>{}))}},[ae]);R.useRef(!1).current=Be;const ja=U||ht&&!Ce||ft||Wt||It;function va(){Ce?(window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>zt.current?.focus(),300)):(mt(!0),Ht(0),requestAnimationFrame(()=>{setTimeout(()=>{zt.current?.focus({preventScroll:!1})},200)}))}function ba(){mt(!1),zt.current?.blur()}R.useEffect(()=>{if(Ee&&ja)return Ee.lockScroll(),()=>Ee.unlockScroll()},[ja,Ee]),R.useEffect(()=>{if(!ht||"undefined"==typeof window)return;const e=window.visualViewport;if(!e)return;const t=e;function n(){Ht(window.innerHeight-(t.offsetTop+t.height))}return n(),t.addEventListener("resize",n),t.addEventListener("scroll",n,{passive:!0}),()=>{t.removeEventListener("resize",n),t.removeEventListener("scroll",n)}},[ht]),R.useEffect(()=>{if(!ht||Ce)return;const e=setTimeout(()=>{zt.current?.focus({preventScroll:!1})},100);return()=>clearTimeout(e)},[ht,Ce]),R.useEffect(()=>{if(!ft||Ce||"undefined"==typeof window)return;const e=window.visualViewport;if(!e)return;const t=e;function n(){gt(window.innerHeight-(t.offsetTop+t.height))}return n(),t.addEventListener("resize",n),t.addEventListener("scroll",n,{passive:!0}),()=>{t.removeEventListener("resize",n),t.removeEventListener("scroll",n)}},[ft,Ce]),R.useEffect(()=>{if("undefined"==typeof window||Ce)return;Tt.current=window.scrollY;function e(){const e=window.scrollY,t=e-Tt.current;t>8?(At(!0),Bt(!1)):t<-8&&At(!1),Tt.current=e,Rt.current&&clearTimeout(Rt.current),Rt.current=setTimeout(()=>{Rt.current=null,At(!1)},350)}return window.addEventListener("scroll",e,{passive:!0}),()=>{window.removeEventListener("scroll",e),Rt.current&&clearTimeout(Rt.current)}},[Ce]);function ya(){pt(!0),vt([{id:Math.random().toString(36).slice(2),text:"",images:[],imageAlts:[]}]),yt(0),_t(null),gt(0)}function wa(){pt(!1),_t(null)}const ka=["image/jpeg","image/png","image/gif","image/webp"];function Na(e){const t=Array.from(e).filter(e=>ka.includes(e.type)),n=Et,a=Math.min(t.length,4-n.images.length);if(a<=0)return;const s=t.slice(0,a);vt(e=>{const t=[...e],n=t[bt];return n&&(t[bt]={...n,images:[...n.images,...s],imageAlts:[...n.imageAlts,...s.map(()=>"")]}),t})}const _a=R.useMemo(()=>Et.images.map(e=>URL.createObjectURL(e)),[Et.images]);R.useEffect(()=>()=>_a.forEach(e=>URL.revokeObjectURL(e)),[_a]);const Ca=ht&&!Ce,Sa="/feed"===_e&&!U&&!Ca,Ea=e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:Sa?H.navActive:"","aria-current":Sa?"page":void 0,onPointerDown:na,onPointerUp:aa,onPointerLeave:aa,onPointerCancel:aa,onClick:ua,title:"Home (hold to show all seen posts)",children:[e.jsx("span",{className:H.navIcon,children:e.jsx(wn,{active:Sa})}),e.jsx("span",{className:H.navLabel,children:"Home"})]}),Ce&&e.jsxs("button",{type:"button",className:Z&&!Ca?H.navActive:"",onClick:q,"aria-pressed":Z,children:[e.jsx("span",{className:H.navIcon,children:e.jsx(Nn,{})}),e.jsx("span",{className:H.navLabel,children:"Collections"})]}),e.jsxs("button",{type:"button",className:H.navBtn,onClick:ya,"aria-label":"New post",children:[e.jsx("span",{className:H.navIcon,children:e.jsx(Pn,{})}),e.jsx("span",{className:H.navLabel,children:"New"})]}),e.jsxs("button",{type:"button",className:Ca?H.navActive:H.navBtn,onClick:va,"aria-label":"Search","aria-pressed":Ca,children:[e.jsx("span",{className:H.navIcon,children:e.jsx(_n,{active:Ca})}),e.jsx("span",{className:H.navLabel,children:"Search"})]}),e.jsxs("button",{type:"button",className:Y&&!Ca?H.navActive:"",onClick:K,"aria-pressed":Y,children:[e.jsx("span",{className:H.navIcon,children:e.jsx(Cn,{})}),e.jsx("span",{className:H.navLabel,children:"Forums"})]})]}),La=e.jsx(e.Fragment,{children:Ce?Ea:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.navHomeWrap,children:e.jsx("button",{type:"button",className:Sa?H.navActive:"","aria-current":Sa?"page":void 0,onPointerDown:na,onPointerUp:aa,onPointerLeave:aa,onPointerCancel:aa,onClick:ua,title:"Home (hold to show all read posts)",children:e.jsx("span",{className:H.navIcon,children:e.jsx(wn,{active:Sa})})})}),e.jsx("button",{type:"button",className:Y&&!Ca?H.navActive:"",onClick:K,"aria-pressed":Y,"aria-label":"Forums",children:e.jsx("span",{className:H.navIcon,children:e.jsx(Cn,{})})}),e.jsx("button",{type:"button",className:H.navBtn,onClick:ya,"aria-label":"New post",children:e.jsx("span",{className:H.navIcon,children:e.jsx(Pn,{})})}),e.jsx("button",{type:"button",className:Ca?H.navActive:H.navBtn,onClick:va,"aria-label":"Search","aria-pressed":Ca,children:e.jsx("span",{className:H.navIcon,children:e.jsx(_n,{active:Ca})})}),e.jsx("div",{className:H.navProfileWrap,children:e.jsx("button",{ref:Kt,type:"button",className:H.navProfileBtn,onPointerDown:la,onPointerUp:ca,onPointerLeave:ca,onPointerCancel:ca,onClick:da,"aria-label":ae?"Profile (hold for accounts)":"Account","aria-expanded":Ae,title:ae?"Profile (hold for accounts and settings)":"Account",children:e.jsx("span",{className:H.navIcon,children:ae&&he?e.jsx("img",{src:he,alt:"",className:H.navProfileAvatar,loading:"lazy"}):e.jsx(En,{})})})})]})}),Aa=e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:H.menuTitle,children:"Notifications"}),e.jsxs("div",{className:H.notificationFilters,children:[e.jsx("button",{type:"button",className:"all"===Re?H.notificationFilterActive:H.notificationFilter,onClick:()=>We("all"),children:"All"}),e.jsx("button",{type:"button",className:"reply"===Re?H.notificationFilterActive:H.notificationFilter,onClick:()=>We("reply"),children:"Replies"}),e.jsx("button",{type:"button",className:"follow"===Re?H.notificationFilterActive:H.notificationFilter,onClick:()=>We("follow"),children:"Follows"})]}),ot?e.jsx("p",{className:H.notificationsLoading,children:"Loading…"}):(()=>{const t="all"===Re?rt:rt.filter(e=>e.reason===Re);return 0===t.length?e.jsx("p",{className:H.notificationsEmpty,children:"all"===Re?"No notifications yet.":"No matching notifications."}):e.jsx("ul",{className:H.notificationsList,"data-notifications-list":!0,children:t.map(t=>{const n=t.author.handle??t.author.did,a="follow"===t.reason,s="reply"===t.reason||"like"===t.reason,r=a?`/profile/${encodeURIComponent(n)}`:`/post/${encodeURIComponent(t.reasonSubject??t.uri)}`,i="like"===t.reason?"liked your post":"repost"===t.reason?"reposted your post":"follow"===t.reason?"followed you":"mention"===t.reason?"mentioned you":"reply"===t.reason?"replied to you":"quote"===t.reason?"quoted your post":t.reason,o=!Ce&&(a||s||"repost"===t.reason||"mention"===t.reason||"quote"===t.reason);return e.jsx("li",{"data-indexed-at":t.indexedAt,children:e.jsxs(O,{to:r,className:H.notificationItem,onClick:e=>{$e(!1),o?(e.preventDefault(),a?c(n):s?d(t.uri,void 0,t.uri):d(t.reasonSubject??t.uri)):a&&(e.preventDefault(),c(n))},children:[t.author.avatar?e.jsx("img",{src:t.author.avatar,alt:"",className:H.notificationAvatar,loading:"lazy"}):e.jsx("span",{className:H.notificationAvatarPlaceholder,"aria-hidden":!0,children:n.slice(0,1).toUpperCase()}),e.jsxs("span",{className:H.notificationTextWrap,children:[e.jsxs("span",{className:H.notificationText,children:[e.jsxs("strong",{children:["@",n]})," ",i]}),t.replyPreview&&e.jsx("span",{className:H.notificationReplyPreview,children:t.replyPreview})]})]})},t.uri)})})})()]}),Fa=e.jsxs(e.Fragment,{children:[ae&&e.jsx(e.Fragment,{children:e.jsxs("section",{className:H.menuSection,children:[e.jsxs("div",{className:H.menuProfileAndAccounts,children:[e.jsxs("button",{type:"button",className:`${H.menuProfileBtn} ${H.menuProfileBtnAccentHover}`,onClick:()=>{Fe(!1),Le(!1),q()},title:"Collections",children:[e.jsx("span",{className:H.menuProfileIconWrap,"aria-hidden":!0,children:e.jsx(Nn,{})}),e.jsx("span",{children:"Collections"})]}),e.jsx("div",{className:H.menuAccountsBlock,children:se.map(t=>{const n=oe[t.did],a=n?.handle??t.handle??t.did,s=t.did===ae?.did;return e.jsxs("button",{type:"button",className:s?H.menuItemActive:H.menuItem,onClick:()=>{s?(Fe(!1),Le(!1),c(a)):async function(e){await ie(e)&&(Le(!1),Fe(!1))}(t.did)},title:s?"View my profile":`Switch to @${a}`,children:[n?.avatar?e.jsx("img",{src:n.avatar,alt:"",className:H.accountMenuAvatar,loading:"lazy"}):e.jsx("span",{className:H.accountMenuAvatarPlaceholder,"aria-hidden":!0,children:(a||t.did).slice(0,1).toUpperCase()}),s?e.jsxs("span",{className:H.menuAccountLabel,children:[e.jsxs("span",{className:H.menuAccountLabelDefault,children:["@",a]}),e.jsx("span",{className:H.menuAccountLabelHover,children:"Open profile"})]}):e.jsxs("span",{children:["@",a]}),s&&e.jsx("span",{className:H.sheetCheck,"aria-hidden":!0,children:" ✓"})]},t.did)})})]}),e.jsxs("div",{className:H.menuActions,children:[e.jsx("button",{type:"button",className:H.menuActionBtn,onClick:function(){Le(!1),Fe(!1),ee()},children:"Add account"}),e.jsx("button",{type:"button",className:H.menuActionSecondary,onClick:function(){Le(!1),Fe(!1),re()},children:"Log out"})]})]})}),!ae&&e.jsx("section",{className:H.menuSection,children:e.jsxs("div",{className:H.menuProfileAndAccounts,children:[Ce?e.jsxs("button",{type:"button",className:`${H.menuProfileBtn} ${H.menuProfileBtnAccentHover}`,onClick:()=>{Fe(!1),Le(!1),ee("create")},children:[e.jsx("span",{className:H.menuProfileIconWrap,"aria-hidden":!0,children:e.jsx(En,{})}),e.jsx("span",{children:"Create account"})]}):e.jsxs("a",{href:"https://bsky.app",target:"_blank",rel:"noopener noreferrer",className:`${H.menuProfileBtn} ${H.menuProfileBtnAccentHover}`,onClick:()=>{Fe(!1),Le(!1)},children:[e.jsx("span",{className:H.menuProfileIconWrap,"aria-hidden":!0,children:e.jsx(En,{})}),e.jsx("span",{children:"Create account"})]}),e.jsx("div",{className:H.menuAccountsBlock,children:e.jsxs("button",{type:"button",className:H.menuAuthLink,onClick:()=>{Fe(!1),Le(!1),ee()},children:[e.jsx(Rn,{}),e.jsx("span",{children:"Log in with Bluesky"})]})})]})})]}),Ba=R.useMemo(()=>({wrapperRef:i&&"/feed"===_e?Me:null,setHandlers:i&&"/feed"===_e?Te:null}),[i,_e]);return e.jsx("div",{className:`${H.wrap} ${i&&Ce?H.wrapWithHeader:""} ${i&&!Ce?H.wrapMobileTop:""}`,children:e.jsx(yn.Provider,{value:Ba,children:e.jsxs(te,{feedSources:ae?Qn:Q,setSingleFeed:Vn,children:[e.jsx("a",{href:"#main-content",className:H.skipLink,children:"Skip to main content"}),i&&Ce&&e.jsx("header",{className:`${H.header} ${ae?"":H.headerLoggedOut}`,role:"banner",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:H.headerLeft,children:[Ce&&e.jsxs("div",{ref:Pt,className:H.headerGearWrap,children:[e.jsx("button",{type:"button",className:`${H.headerGearBtn} float-btn ${Ft?H.feedFloatGearActive:""}`,onClick:()=>Bt(e=>!e),title:Ft?"Hide view options":"Show view options","aria-label":Ft?"Hide view options":"Show view options","aria-expanded":Ft,children:e.jsx(On,{})}),e.jsxs("div",{className:`${H.headerGearExpandable} ${H.gearFloatExpandable} ${Ft?H.feedFloatButtonsExpandableOpen:""}`,"aria-hidden":!Ft,children:[e.jsxs("button",{type:"button",className:`${H.nsfwFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ye(e.currentTarget,{showToast:!1}),title:`${be}. Click to cycle: SFW → Blurred → NSFW`,"aria-label":`Content: ${be}. Click to cycle.`,children:[e.jsx(An,{mode:"sfw"===be?"closed":"blurred"===be?"half":"open"}),e.jsx("span",{className:H.gearExpandableLabel,children:F[be]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>fe("light"===me?"system":"system"===me?"dark":"light"),title:`Theme: ${me}. Click to cycle.`,"aria-label":`Theme: ${me}. Click to cycle.`,children:[e.jsx("span",{className:H.feedFloatThemeIcon,children:"light"===me?e.jsx(Wn,{}):"dark"===me?e.jsx(Dn,{}):e.jsx(In,{})}),e.jsx("span",{className:H.gearExpandableLabel,children:"light"===me?"Light":"dark"===me?"Dark":"Auto"})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ve(e.currentTarget,{showToast:!1}),title:B[je],"aria-label":B[je],children:[e.jsx(Fn,{mode:"default"===je?"default":"minimalist"===je?"minimalist":"artOnly"}),e.jsx("span",{className:H.gearExpandableLabel,children:B[je]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>Ne({showToast:!1}),title:`${$[we]}. Click to cycle: All Posts → Media only → Text only.`,"aria-label":$[we],children:[e.jsx(zn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:$[we]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ge(e.currentTarget,{showToast:!1}),title:`${M[pe]}. Click to cycle.`,"aria-label":`Columns: ${M[pe]}. Click to cycle.`,children:["1"===pe&&e.jsx(Bn,{}),"2"===pe&&e.jsx($n,{}),"3"===pe&&e.jsx(Mn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:M[pe]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>{Bt(!1),Ot(!0)},title:"Storage and cache management","aria-label":"Storage & Cache",children:[e.jsx(Hn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:"Storage & Cache"})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>Dt(!0),title:"About ArtSky and keyboard shortcuts","aria-label":"About ArtSky",children:[e.jsx(Un,{}),e.jsx("span",{className:H.gearExpandableLabel,children:"About"})]})]})]}),e.jsxs(O,{to:"/feed",className:H.logoLink,"aria-label":"ArtSky – back to feed",title:"/feed"===_e?"Home (hold to show all read posts)":"Back to feed",onPointerDown:na,onPointerUp:aa,onPointerLeave:aa,onPointerCancel:aa,onClick:ua,children:[e.jsx("img",{src:"/artsky-dev/icon.svg",alt:"",className:H.logoIcon}),e.jsx("span",{className:H.logoText,children:"ArtSky"}),e.jsx("span",{className:H.logoDev,children:" dev"})]})]}),e.jsx("div",{className:H.headerCenter,children:Ce?e.jsxs("div",{className:H.headerSearchRow,children:[e.jsx("div",{className:H.headerSearchSide,children:e.jsxs("div",{className:H.headerFeedsWrap,ref:nt,children:[e.jsx("button",{ref:at,type:"button",className:De?H.headerFeedsLinkActive:H.headerFeedsLink,"aria-label":"Feeds","aria-expanded":De,onClick:()=>Ie(e=>!e),children:"Feeds"}),De&&e.jsxs("div",{className:H.feedsDropdown,role:"dialog","aria-label":"Remix feeds",children:[et&&e.jsx("p",{className:H.feedAddError,role:"alert",children:et}),e.jsx(Mt,{variant:"dropdown",sources:ae?Qn:Q,fallbackSource:ae?Xn:Q[0],mixEntries:ae?dn:X,onToggle:Zn,setEntryPercent:un,onAddCustom:async e=>{if(ae){tt(null);try{const t="object"==typeof e&&null!==e&&"uri"in e,n=t?await N(e.uri):await N(e);await _(n);const a={kind:"custom",label:t?e.label??await k(n):await k(n),uri:n};Ve(e=>e.some(e=>e.uri===n)?e:[...e,a]),Zn(a),await ha(a)}catch(t){tt(t instanceof Error?t.message:"Could not add feed. Try again.")}}},onToggleWhenGuest:ae?void 0:ee,removableSourceUris:ae?ta:void 0,onRemoveFeed:ae?fa:void 0,onShareFeed:ae?pa:void 0,onReorderSources:ae?ea:void 0})]})]})}),e.jsx("div",{className:H.headerSearchBarWrap,children:e.jsx(ke,{inputRef:zt,compact:Ce,onSelectFeed:ma})}),e.jsx("div",{className:H.headerSearchSide,children:e.jsx("button",{type:"button",className:ae?H.headerForumLink:H.headerForumLinkLoggedOut,"aria-label":"Forums",onClick:K,children:"Forums"})})]}):e.jsx("div",{className:H.headerCenterMobile,children:e.jsxs("div",{className:H.headerFeedsWrap,ref:nt,children:[e.jsxs("button",{ref:at,type:"button",className:De?H.headerFeedsBtnActive:H.headerFeedsBtn,"aria-label":"Feeds","aria-expanded":De,onClick:()=>Ie(e=>!e),children:[e.jsx(Sn,{}),e.jsx("span",{className:H.headerFeedsBtnLabel,children:"Feeds"})]}),De&&e.jsxs("div",{className:H.feedsDropdown,role:"dialog","aria-label":"Remix feeds",children:[et&&e.jsx("p",{className:H.feedAddError,role:"alert",children:et}),e.jsx(Mt,{variant:"dropdown",sources:ae?Qn:Q,fallbackSource:ae?Xn:Q[0],mixEntries:ae?dn:X,onToggle:Zn,setEntryPercent:un,onAddCustom:async e=>{if(ae){tt(null);try{const t="object"==typeof e&&null!==e&&"uri"in e,n=t?await N(e.uri):await N(e);await _(n);const a={kind:"custom",label:t?e.label??await k(n):await k(n),uri:n};Ve(e=>e.some(e=>e.uri===n)?e:[...e,a]),Zn(a),await ha(a)}catch(t){tt(t instanceof Error?t.message:"Could not add feed. Try again.")}}},onToggleWhenGuest:ae?void 0:ee,removableSourceUris:ae?ta:void 0,onRemoveFeed:ae?fa:void 0,onShareFeed:ae?pa:void 0,onReorderSources:ae?ea:void 0})]})]})})}),e.jsxs("div",{className:H.headerRight,children:[ae&&Ce&&e.jsxs("button",{type:"button",className:H.headerBtnWithLabel,onClick:ya,"aria-label":"New post",title:"New post",children:[e.jsx(Pn,{}),e.jsx("span",{className:H.headerBtnLabel,children:"New"})]}),ae&&e.jsxs("div",{className:H.headerBtnWrap,children:[e.jsx("button",{ref:Gt,type:"button",className:H.headerBtn,onClick:()=>$e(e=>!e),"aria-label":"Notifications","aria-expanded":Be,title:"Notifications",children:e.jsx(Ln,{})}),ct>0&&e.jsx("span",{className:H.notificationUnreadDot,"aria-hidden":!0}),Be&&e.jsx("div",{ref:Vt,className:H.notificationsMenu,role:"dialog","aria-label":"Notifications",children:Aa})]}),Ce&&e.jsxs(e.Fragment,{children:[!ae&&e.jsx("button",{type:"button",className:H.headerAuthLink,onClick:()=>ee(),children:"Log in"}),e.jsxs("div",{className:H.headerBtnWrap,children:[e.jsx("button",{ref:Kt,type:"button",className:H.headerBtn,onPointerDown:la,onPointerUp:ca,onPointerLeave:ca,onPointerCancel:ca,onClick:da,"aria-label":"Profile (hold for accounts)","aria-expanded":Ae,title:"Profile (hold for accounts and settings)",children:e.jsx("span",{className:H.navIcon,children:he?e.jsx("img",{src:he,alt:"",className:H.headerAccountAvatar,loading:"lazy"}):e.jsx(En,{})})}),Ae&&e.jsx("div",{ref:qt,className:H.accountMenu,role:"menu","aria-label":"Accounts and settings",children:Fa})]})]}),!Ce&&e.jsxs(e.Fragment,{children:[!ae&&e.jsx("button",{type:"button",className:H.headerAuthLink,onClick:()=>ee(),children:"Log in"}),e.jsxs("div",{className:H.headerAccountMenuWrap,children:[e.jsx("button",{ref:Kt,type:"button",className:H.headerAccountNavBtn,onPointerDown:la,onPointerUp:ca,onPointerLeave:ca,onPointerCancel:ca,onClick:da,"aria-label":"Profile (hold for accounts)","aria-expanded":Ae,title:"Profile (hold for accounts and settings)",children:e.jsx("span",{className:H.navIcon,children:he?e.jsx("img",{src:he,alt:"",className:H.headerAccountAvatar,loading:"lazy"}):e.jsx(En,{})})}),Ae&&e.jsx("div",{ref:qt,className:H.accountMenu,role:"menu","aria-label":"Accounts and settings",children:Fa})]})]})]})]})}),i&&!Ce&&e.jsxs("div",{className:`${H.feedsFloatWrap} feeds-float-wrap ${Lt||U&&z?H.feedsFloatWrapScrollHidden:""}`,ref:nt,children:[e.jsxs("button",{ref:at,type:"button",className:`${H.feedsFloatBtn} float-btn ${De?H.feedsFloatBtnActive:""}`,onClick:()=>Ie(e=>!e),"aria-label":"Feeds","aria-expanded":De,children:[e.jsx("span",{className:H.feedsFloatLabel,children:"Feeds"}),e.jsx("span",{ref:st,className:`${H.feedsFloatChevronWrap} ${He?H.feedsFloatChevronWrapNoTransition:""}`,style:{transform:`rotate(${De?180:Oe??0}deg)`},onTransitionEnd:()=>{360===Oe&&(D.flushSync(()=>ze(!0)),Ue(null))},children:e.jsx(Tn,{})})]}),De&&e.jsxs("div",{className:H.feedsDropdown,role:"dialog","aria-label":"Remix feeds",children:[et&&e.jsx("p",{className:H.feedAddError,role:"alert",children:et}),e.jsx(Mt,{variant:"dropdown",touchFriendly:!0,sources:ae?Qn:Q,fallbackSource:ae?Xn:Q[0],mixEntries:ae?dn:X,onToggle:Zn,setEntryPercent:un,onAddCustom:async e=>{if(ae){tt(null);try{const t="object"==typeof e&&null!==e&&"uri"in e,n=t?await N(e.uri):await N(e);await _(n);const a={kind:"custom",label:t?e.label??await k(n):await k(n),uri:n};Ve(e=>e.some(e=>e.uri===n)?e:[...e,a]),Zn(a),await ha(a)}catch(t){tt(t instanceof Error?t.message:"Could not add feed. Try again.")}}},onToggleWhenGuest:ae?void 0:ee,removableSourceUris:ae?ta:void 0,onRemoveFeed:ae?fa:void 0,onShareFeed:ae?pa:void 0,onReorderSources:ae?ea:void 0})]})]}),i&&!Ce&&"/feed"===_e&&e.jsxs("div",{ref:$t,className:`${H.gearFloatWrap} ${U?H.gearFloatWrapModalOpen:""} ${Lt||U&&z?H.gearFloatWrapScrollHidden:""}`,children:[e.jsx("button",{type:"button",className:`${H.feedFloatBtn} float-btn ${Ft?H.feedFloatGearActive:""}`,onClick:()=>Bt(e=>!e),title:Ft?"Hide view options":"Show view options","aria-label":Ft?"Hide view options":"Show view options","aria-expanded":Ft,children:e.jsx(On,{})}),e.jsxs("div",{className:`${H.feedFloatButtonsExpandable} ${H.gearFloatExpandable} ${Ft?H.feedFloatButtonsExpandableOpen:""}`,"aria-hidden":!Ft,children:[e.jsxs("button",{type:"button",className:`${H.nsfwFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ye(e.currentTarget,{showToast:!1}),title:`${be}. Click to cycle: SFW → Blurred → NSFW`,"aria-label":`Content: ${be}. Click to cycle.`,children:[e.jsx(An,{mode:"sfw"===be?"closed":"blurred"===be?"half":"open"}),e.jsx("span",{className:H.gearExpandableLabel,children:F[be]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>fe("light"===me?"system":"system"===me?"dark":"light"),title:`Theme: ${me}. Click to cycle.`,"aria-label":`Theme: ${me}. Click to cycle.`,children:[e.jsx("span",{className:H.feedFloatThemeIcon,children:"light"===me?e.jsx(Wn,{}):"dark"===me?e.jsx(Dn,{}):e.jsx(In,{})}),e.jsx("span",{className:H.gearExpandableLabel,children:"light"===me?"Light":"dark"===me?"Dark":"Auto"})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ve(e.currentTarget,{showToast:!1}),title:B[je],"aria-label":B[je],children:[e.jsx(Fn,{mode:"default"===je?"default":"minimalist"===je?"minimalist":"artOnly"}),e.jsx("span",{className:H.gearExpandableLabel,children:B[je]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>Ne({showToast:!1}),title:`${$[we]}. Click to cycle: All Posts → Media only → Text only.`,"aria-label":$[we],children:[e.jsx(zn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:$[we]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:e=>ge(e.currentTarget,{showToast:!1}),title:`${M[pe]}. Click to cycle.`,"aria-label":`Columns: ${M[pe]}. Click to cycle.`,children:["1"===pe&&e.jsx(Bn,{}),"2"===pe&&e.jsx($n,{}),"3"===pe&&e.jsx(Mn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:M[pe]})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>{Bt(!1),Ot(!0)},title:"Storage and cache management","aria-label":"Storage & Cache",children:[e.jsx(Hn,{}),e.jsx("span",{className:H.gearExpandableLabel,children:"Storage & Cache"})]}),e.jsxs("button",{type:"button",className:`${H.feedFloatBtn} ${H.gearExpandableBtn} float-btn`,onClick:()=>Dt(!0),title:"About ArtSky and keyboard shortcuts","aria-label":"About ArtSky",children:[e.jsx(Un,{}),e.jsx("span",{className:H.gearExpandableLabel,children:"About"})]})]})]}),i&&!Ce&&!ae&&e.jsx("div",{className:`${H.loginFloatWrap} login-float-wrap ${Lt||U&&z?H.loginFloatWrapScrollHidden:""}`,children:e.jsx("button",{type:"button",className:`${H.loginFloatBtn} float-btn`,onClick:()=>ee(),"aria-label":"Log in",title:"Log in",children:"Log in"})}),i&&!Ce&&ae&&e.jsxs("div",{className:`${H.notificationFloatWrap} notification-float-wrap ${Lt||U&&z?H.notificationFloatWrapScrollHidden:""}`,children:[e.jsxs("button",{ref:Gt,type:"button",className:H.notificationFloatBtn,onClick:()=>$e(e=>!e),"aria-label":"Notifications","aria-expanded":Be,title:"Notifications",children:[e.jsx(Ln,{}),ct>0&&e.jsx("span",{className:H.notificationUnreadDot,"aria-hidden":!0})]}),Be&&e.jsx("div",{ref:Vt,className:H.notificationsMenu,role:"dialog","aria-label":"Notifications",children:Aa})]}),i&&!Ce&&Ae&&e.jsx("div",{className:H.accountMenuAboveWrap,children:e.jsx("div",{ref:qt,className:H.accountMenuAbove,role:"menu","aria-label":"Accounts and settings",children:Fa})}),e.jsx("main",{id:"main-content",className:H.main,"aria-label":"Main content",children:i&&"/feed"===_e?e.jsxs("div",{ref:Me,onTouchStart:Pe?.onTouchStart,onTouchMove:Pe?.onTouchMove,onTouchEnd:Pe?.onTouchEnd,children:[e.jsx(Mt,{variant:"page",sources:ae?Qn:Q,fallbackSource:ae?Xn:Q[0],mixEntries:ae?dn:X,onToggle:Zn,setEntryPercent:un,onAddCustom:async e=>{if(ae){tt(null);try{const t="object"==typeof e&&null!==e&&"uri"in e,n=t?await N(e.uri):await N(e);await _(n);const a={kind:"custom",label:t?e.label??await k(n):await k(n),uri:n};Ve(e=>e.some(e=>e.uri===n)?e:[...e,a]),Zn(a),await ha(a)}catch(t){tt(t instanceof Error?t.message:"Could not add feed. Try again.")}}},onToggleWhenGuest:ae?void 0:ee,removableSourceUris:ae?ta:void 0,onRemoveFeed:ae?fa:void 0,onShareFeed:ae?pa:void 0,onReorderSources:ae?ea:void 0}),a]}):a}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`${H.navOuter} nav-outer  ${!Ce&&(Lt||U&&z)?H.navOuterScrollHidden:""}`,children:[!U&&e.jsx("button",{type:"button",className:`${H.seenPostsFloatBtn} hide-seen-fab float-btn`,onPointerDown:e=>ra(e),onPointerUp:ia,onPointerLeave:ia,onPointerCancel:ia,onClick:e=>oa(e),title:"Tap to hide read posts, hold to show them again","aria-label":"Read posts: tap to hide, hold to show again",children:e.jsx(kn,{})}),e.jsx("nav",{className:`${H.nav} nav`,"aria-label":"Main navigation",children:La})]}),ht&&!Ce&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.searchOverlayBackdrop,onClick:ba,"aria-hidden":!0}),e.jsx("div",{className:`${H.searchOverlayCenter} ${Ce?H.searchOverlayAboveKeyboard:H.searchOverlayMobileBottom}`,role:"dialog","aria-label":"Search",style:Ce?{bottom:Ut}:void 0,children:e.jsx("div",{className:H.searchOverlayCard,children:e.jsx(ke,{inputRef:zt,onClose:ba,suggestionsAbove:!0,onSelectFeed:ma})})})]}),ft&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.searchOverlayBackdrop,onClick:wa,"aria-hidden":!0}),e.jsx("div",{className:`${H.composeOverlay} ${Ce?"":H.composeOverlayMobile}`,role:"dialog","aria-label":"New post",onClick:e=>{e.target===e.currentTarget&&wa()},onKeyDown:e=>{"Escape"===e.key&&wa()},onDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:function(e){e.preventDefault(),e.dataTransfer?.files?.length&&Na(e.dataTransfer.files)},style:Ce?void 0:{bottom:xt},children:e.jsxs("div",{className:H.composeCard,children:[e.jsxs("header",{className:H.composeHeader,children:[e.jsx("button",{type:"button",className:H.composeCancel,onClick:wa,disabled:wt,children:"Cancel"}),e.jsx("h2",{className:H.composeTitle,children:"New post"}),e.jsx("div",{className:H.composeHeaderPostWrap,children:ae&&e.jsx("button",{type:"submit",form:"compose-form",className:H.composeSubmit,disabled:wt||jt.every(e=>!e.text.trim()&&0===e.images.length),children:wt?"Posting…":"Post"})})]}),ae?e.jsxs("form",{id:"compose-form",ref:St,onSubmit:async function(e){if(e.preventDefault(),!ae||wt)return;const t=jt.filter(e=>e.text.trim()||e.images.length>0);if(0!==t.length){_t(null),kt(!0);try{let e=null,n=null,a=null,s=null;for(let r=0;r<t.length;r++){const i=t[r];if(0===r){const t=await P(i.text,i.images.length>0?i.images:void 0,i.imageAlts.length>0?i.imageAlts:void 0);e=t.uri,n=t.cid,a=t.uri,s=t.cid}else{if(!i.text.trim())continue;const t=await T(e,n,a,s,i.text);a=t.uri,s=t.cid}}vt([{id:Math.random().toString(36).slice(2),text:"",images:[],imageAlts:[]}]),yt(0),wa(),l("/feed")}catch(n){_t(n instanceof Error?n.message:"Failed to post")}finally{kt(!1)}}},children:[jt.length>1&&e.jsxs("div",{className:H.composePreviousPosts,role:"region","aria-label":"Posts in thread",children:[e.jsx("p",{className:H.composePreviousPostsTitle,children:"Posts in thread — click to edit"}),e.jsx("div",{className:H.composePreviousPostsList,children:jt.map((t,n)=>n===bt?null:e.jsxs("button",{type:"button",className:H.composePreviousPostCard,onClick:()=>yt(n),disabled:wt,"aria-label":`Edit post ${n+1}`,children:[e.jsxs("span",{className:H.composePreviousPostLabel,children:["Post ",n+1]}),t.text.trim()?e.jsx("div",{className:H.composePreviousPostText,children:e.jsx(J,{text:t.text,interactive:!1})}):t.images.length>0?null:e.jsx("div",{className:H.composePreviousPostText,children:e.jsx("em",{children:"Empty"})}),t.images.length>0&&e.jsxs("p",{className:H.composePreviousPostMedia,children:[t.images.length," image",1!==t.images.length?"s":""]})]},t.id))})]}),jt.length>1&&e.jsxs("p",{className:H.composeSegmentLabel,children:["Post ",bt+1," of ",jt.length]}),e.jsx(Qt,{className:H.composeTextarea,value:Et.text,onChange:function(e){vt(t=>{const n=[...t],a=n[bt];return a&&(n[bt]={...a,text:e}),n})},onKeyDown:e=>function(e,t){"Enter"!==e.key&&"E"!==e.key||!e.metaKey&&!e.ctrlKey||(e.preventDefault(),t&&(Et.text.trim()||Et.images.length>0)&&!wt&&t.requestSubmit())}(e,St.current),placeholder:"What's on your mind? Type @ for users, # for hashtags, % for forum posts",rows:4,maxLength:300,disabled:wt,autoFocus:Ce}),Et.images.length>0&&e.jsxs("div",{className:H.composeMediaSection,children:[e.jsx("div",{className:H.composePreviews,children:Et.images.map((t,n)=>e.jsxs("div",{className:H.composePreviewWrap,children:[e.jsx("img",{src:_a[n],alt:"",className:H.composePreviewImg}),e.jsx("button",{type:"button",className:H.composePreviewRemove,onClick:()=>{return e=n,void vt(t=>{const n=[...t],a=n[bt];return a&&(n[bt]={...a,images:a.images.filter((t,n)=>n!==e),imageAlts:a.imageAlts.filter((t,n)=>n!==e)}),n});var e},"aria-label":"Remove image",disabled:wt,children:"×"})]},`${t.name}-${t.size}-${t.lastModified}`))}),e.jsx("p",{className:H.composeAltPrompt,children:"Describe each image for accessibility (alt text)."}),e.jsx("div",{className:H.composeAltFields,children:Et.images.map((t,n)=>e.jsxs("div",{className:H.composeAltRow,children:[e.jsxs("label",{htmlFor:`compose-alt-${bt}-${n}`,className:H.composeAltLabel,children:["Image ",n+1]}),e.jsx("input",{id:`compose-alt-${bt}-${n}`,type:"text",className:H.composeAltInput,placeholder:"Describe this image for people using screen readers",value:Et.imageAlts[n]??"",onChange:e=>{const t=e.target.value.slice(0,1e3);vt(e=>{const a=[...e],s=a[bt];if(!s)return e;const r=[...s.imageAlts];for(;r.length<s.images.length;)r.push("");return r[n]=t,a[bt]={...s,imageAlts:r},a})},maxLength:1e3,disabled:wt,"aria-label":`Alt text for image ${n+1}`})]},`${t.name}-${t.size}-${t.lastModified}`))})]}),e.jsxs("div",{className:H.composeFooter,children:[e.jsxs("div",{className:H.composeFooterLeft,children:[e.jsx("input",{ref:Ct,type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",multiple:!0,className:H.composeFileInput,onChange:e=>{e.target.files?.length&&Na(e.target.files),e.target.value=""}}),e.jsx("button",{type:"button",className:H.composeAddMedia,onClick:()=>Ct.current?.click(),disabled:wt||Et.images.length>=4,title:"Add photo","aria-label":"Add photo",children:"Add media"})]}),e.jsxs("div",{className:H.composeActions,children:[e.jsx(rn,{used:Et.text.length,max:300}),e.jsx("button",{type:"button",className:H.composeAddThread,onClick:function(){vt(e=>[...e,{id:Math.random().toString(36).slice(2),text:"",images:[],imageAlts:[]}]),yt(e=>e+1)},disabled:wt,title:"Add to thread","aria-label":"Add to thread",children:"+"})]})]}),Nt&&e.jsx("p",{className:H.composeError,children:Nt})]}):e.jsxs("p",{className:H.composeSignIn,children:[e.jsx("button",{type:"button",className:H.composeSignInLink,onClick:()=>{wa(),ee()},children:"Log in"})," to post."]})]})})]}),It&&cn&&e.jsx(Se,{onClose:()=>Ot(!1),showToast:cn.showToast}),Wt&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.searchOverlayBackdrop,onClick:()=>Dt(!1),"aria-hidden":!0}),e.jsx("div",{className:H.aboutOverlay,role:"dialog","aria-label":"About ArtSky",onClick:e=>{e.target===e.currentTarget&&Dt(!1)},onKeyDown:e=>{"Escape"===e.key&&Dt(!1)},children:e.jsxs("div",{className:H.aboutCard,children:[e.jsx("h2",{className:H.aboutTitle,children:"ArtSky"}),e.jsx("p",{className:H.aboutIntro,children:"A Bluesky client focused on art."}),e.jsx("h3",{className:H.aboutSubtitle,children:"Keyboard shortcuts"}),e.jsxs("dl",{className:H.aboutShortcuts,children:[e.jsx("dt",{children:"W / ↑"}),e.jsx("dd",{children:"Move up"}),e.jsx("dt",{children:"A / ←"}),e.jsx("dd",{children:"Move left"}),e.jsx("dt",{children:"S / ↓"}),e.jsx("dd",{children:"Move down"}),e.jsx("dt",{children:"D / →"}),e.jsx("dd",{children:"Move right"}),e.jsx("dt",{children:"Q"}),e.jsx("dd",{children:"Quit / close window"}),e.jsx("dt",{children:"E"}),e.jsx("dd",{children:"Enter post"}),e.jsx("dt",{children:"R"}),e.jsx("dd",{children:"Reply to post"}),e.jsx("dt",{children:"T"}),e.jsx("dd",{children:"Toggle text view"}),e.jsx("dt",{children:"F"}),e.jsx("dd",{children:"Like / unlike"}),e.jsx("dt",{children:"C"}),e.jsx("dd",{children:"Collect post"}),e.jsx("dt",{children:"B"}),e.jsx("dd",{children:"Block author (feed)"}),e.jsx("dt",{children:"4"}),e.jsx("dd",{children:"Follow author"}),e.jsx("dt",{children:"Escape"}),e.jsx("dd",{children:"Escape all windows"}),e.jsx("dt",{children:"1 / 2 / 3"}),e.jsx("dd",{children:"1, 2, or 3 column view"})]}),e.jsx("button",{type:"button",className:H.aboutClose,onClick:()=>Dt(!1),"aria-label":"Close",children:"Close"})]})})]})]}),cn?.toastMessage&&e.jsx("div",{className:"app-toast float-btn",role:"status","aria-live":"polite",children:cn.toastMessage}),e.jsx(hn,{})]})})})}export{Qt as C,yn as F,Vn as L,rn as a,ee as u};
