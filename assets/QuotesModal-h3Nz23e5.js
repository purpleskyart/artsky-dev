import{u as e,x as s,aw as o,j as r}from"./index-BXBIaIN_.js";import{b as t}from"./react-vendor-DGaPsC2e.js";import{p as n,P as a}from"./ProfileColumn-v6J4Wnog.js";import{A as i}from"./AppModal-3LvZLydf.js";import{u as l}from"./ModalScrollContext-CNWnUaKs.js";import"./atproto-3-1TCh3S.js";import"./PostCard-DFZPqraO.js";import"./PostActionsMenu-BMUSZoZl.js";import"./artboards-DNvSVVrd.js";import"./artboardsPds-DWUixJ9h.js";import"./PostText-CYuGKBer.js";import"./postCache-CTqU0alO.js";import"./ModalTopBarSlotContext-XWKZv5-E.js";import"./usePullToRefresh-DVlCPYCP.js";const d="_wrap_16j0m_1",c="_error_16j0m_6",u="_loading_16j0m_13",m="_empty_16j0m_14",p="_loadingMore_16j0m_39";function j({postUri:j,onClose:f,onBack:h,canGoBack:x}){const{openPostModal:v}=e(),{nsfwPreference:_,unblurredUris:g,setUnblurred:b}=s(),[M,P]=t.useState([]),[C,S]=t.useState(),[k,w]=t.useState(!0),[y,A]=t.useState(!1),[N,B]=t.useState(null),[I,O]=t.useState(null),[R,E]=t.useState({}),U=t.useRef(null),q=l(),F=t.useCallback(async e=>{try{e?A(!0):w(!0),B(null);const{posts:s,cursor:r}=await o(j,{limit:30,cursor:e}),t=s.map(e=>({post:e}));P(s=>e?[...s,...t]:t),S(r)}catch(s){B(s instanceof Error?s.message:"Failed to load quotes")}finally{w(!1),A(!1)}},[j]);return t.useEffect(()=>{P([]),S(void 0),F()},[j,F]),t.useEffect(()=>{O(()=>()=>F())},[F]),t.useEffect(()=>{if(!C||y)return;const e=U.current;if(!e)return;const s=e.closest("[data-modal-scroll]")??void 0,o=new IntersectionObserver(e=>{e[0]?.isIntersecting&&F(C)},{root:s,rootMargin:"200px",threshold:0});return o.observe(e),()=>o.disconnect()},[C,y,F]),r.jsx(i,{ariaLabel:"Posts that quote this post",onClose:f,onBack:h,canGoBack:x,onPullToRefresh:I?()=>I():void 0,children:r.jsxs("div",{className:d,children:[N&&r.jsx("p",{className:c,children:N}),k?r.jsx("div",{className:u,children:"Loading…"}):0===M.length?r.jsx("div",{className:m,children:"No one has quoted this post yet."}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`${n.gridColumns} ${n.gridView1}`,children:r.jsx(a,{column:M.map((e,s)=>({item:e,originalIndex:s})),colIndex:0,scrollRef:q,loadMoreSentinelRef:C?e=>{U.current=e}:void 0,hasCursor:!!C,keyboardFocusIndex:0,keyboardAddOpen:!1,actionsMenuOpenForIndex:null,nsfwPreference:_,unblurredUris:g,setUnblurred:b,likeOverrides:R,setLikeOverrides:E,openPostModal:v,cardRef:()=>()=>{},onActionsMenuOpenChange:()=>{},onMouseEnter:()=>{},onAddClose:()=>{},constrainMediaHeight:!0,isSelected:()=>!1})}),y&&r.jsx("div",{className:p,children:"Loading more…"})]})]})})}export{j as default};
