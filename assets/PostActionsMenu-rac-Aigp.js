import{ai as e,g as t,b as n,y as r,E as o,az as s,aA as i,aB as l,j as a}from"./index-B6Oq1pSb.js";import{b as c,h as u}from"./react-vendor-DGaPsC2e.js";function d(e,t){const n=e.toLocaleDateString(void 0,{month:"short"}).slice(0,3),r=String(e.getDate()).padStart(2,"0");if(!t)return`${n} ${r}`;return`${n} ${r} ${String(e.getFullYear()%100).padStart(2,"0")}`}function p(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;return n<60?"now":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:n<2592e3?`${Math.floor(n/86400)}d`:d(t,!(n<31536e3))}function h(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;if(n<60)return{kind:"relative",text:"now"};if(n<3600)return{kind:"relative",text:`${Math.floor(n/60)}m`};if(n<86400)return{kind:"relative",text:`${Math.floor(n/3600)}h`};if(n<2592e3)return{kind:"relative",text:`${Math.floor(n/86400)}d`};const r=t.toLocaleDateString(void 0,{month:"short"}).slice(0,3),o=String(t.getDate()).padStart(2,"0");if(n<31536e3)return{kind:"date",month:r,day:o};return{kind:"date",month:r,day:o,year:String(t.getFullYear()%100).padStart(2,"0")}}function m(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;if(n<60)return"Just now";if(n<3600){const e=Math.floor(n/60);return`${e} minute${1===e?"":"s"} ago`}if(n<86400){const e=Math.floor(n/3600);return`${e} hour${1===e?"":"s"} ago`}if(n<2592e3){const e=Math.floor(n/86400);return`${e} day${1===e?"":"s"} ago`}return d(t,!(n<31536e3))}function f(e){return new Date(e).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})}function x(e){const t=new Date(e);return`${t.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}, ${t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})}`}async function k(){const{default:t}=await e(async()=>{const{default:e}=await import("./video-DCuzn9dR.js");return{default:e}},[]);return t}const j="_wrap_qker0_1",y="_wrapCompact_qker0_8",g="_trigger_qker0_8",b="_dropdown_qker0_44",w="_dropdownFixed_qker0_62",v="_dropdownCompact_qker0_68",C="_item_qker0_73",_="_feedLabel_qker0_78",D="_postedAt_qker0_84",L="_feedbackSuccess_qker0_92",N="_feedbackError_qker0_100",$="_reportReasonLabel_qker0_108",S="_itemIcon_qker0_138",M=18;function P(){return a.jsx("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:a.jsx("path",{d:"M12 5v14m0 0l-4-4m4 4l4-4"})})}function T(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),a.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}function B(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H3c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"}),a.jsx("path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-5c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"})]})}function E(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),a.jsx("polyline",{points:"12 19 5 12 12 5"})]})}function q(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]})}function A(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M18 6L6 18M6 6l12 12"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})}function R(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),a.jsx("line",{x1:"4",y1:"22",x2:"4",y2:"15"})]})}function V(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),a.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),a.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]})}function W(){return a.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),a.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),a.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}const F=c.memo(function({postUri:e,postCid:d,authorDid:p,rootUri:h,isOwnPost:x,onHidden:k,className:M,compact:F,feedLabel:H,postedAt:O,open:U,onOpenChange:z,verticalIcon:I,onDownload:Q,downloadLabel:Y,downloadLoading:J,dropdownRef:G,onViewQuotes:K}){const X=t(),[Z,ee]=c.useState(!1),[te,ne]=c.useState(null),[re,oe]=c.useState(null),[se,ie]=c.useState("main"),[le,ae]=c.useState("idle"),[ce,ue]=c.useState(null),[de,pe]=c.useState(null),he=c.useRef(null),me=c.useRef(null),fe=c.useRef(null),xe=c.useRef(null),[ke,je]=c.useState(null),ye=void 0!==U&&void 0!==z,ge=ye?U:Z;function be(e){ye?z?.(e):ee(e)}function we(){if(!xe.current)return null;const e=xe.current.getBoundingClientRect(),t=window.innerWidth-e.right,n=e.left,r=e.right<208;return{bottom:window.innerHeight-e.top,right:t,left:n,flipH:r}}c.useEffect(()=>{ge||(xe.current?.blur(),ie("main"),ae("idle"),oe(null),he.current&&(clearTimeout(he.current),he.current=null))},[ge]),c.useEffect(()=>{if(!ge||!X?.did||x)return;let e=!1;return n.getProfile({actor:p}).then(t=>{if(e)return;const n=t.data;ue(n.viewer?.blocking??null),pe(n.handle??null)}).catch(()=>{e||(ue(null),pe(null))}),()=>{e=!0}},[ge,X?.did,x,p]),c.useLayoutEffect(()=>{ge&&xe.current?je(we()):je(null)},[ge]),c.useEffect(()=>{if(!ge)return;const e=()=>je(e=>e?we()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[ge]),c.useEffect(()=>{if(!ge)return;const e=e=>{const t=e.target;me.current?.contains(t)||fe.current?.contains(t)||be(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ge]),c.useEffect(()=>{if(!ge)return;const e=fe.current;if(e){const t=e.querySelectorAll('button[role="menuitem"]')[0];t&&t.focus()}},[ge]),c.useEffect(()=>{if(!ge)return;const e=e=>{const t=e.key.toLowerCase();if("escape"===t||"q"===t)return e.preventDefault(),void("confirm"===le?ae("idle"):(be(!1),xe.current?.focus()));if("w"===t||"s"===t||"e"===t||"enter"===t||"ArrowUp"===e.key||"ArrowDown"===e.key){const n=fe.current;if(!n)return;const r=Array.from(n.querySelectorAll('button[role="menuitem"]'));if(0===r.length)return;const o=document.activeElement,s=o&&r.includes(o)?r.indexOf(o):-1;if("e"===t||"enter"===t)return e.preventDefault(),void(s>=0&&!r[s].disabled&&r[s].click());if("w"===t||"ArrowUp"===e.key){e.preventDefault();return void r[s<=0?r.length-1:s-1].focus()}if("s"===t||"ArrowDown"===e.key){e.preventDefault();return void r[s<0||s>=r.length-1?0:s+1].focus()}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ge,le]);const ve=c.useCallback(e=>{oe({type:"success",message:e}),he.current&&clearTimeout(he.current),he.current=setTimeout(()=>{he.current=null,be(!1),oe(null)},1800)},[]),Ce=c.useCallback(e=>{oe({type:"error",message:e})},[]),_e=c.useCallback(async()=>{if(X?.did&&!x){ne("block"),oe(null);try{const{uri:e}=await r(p);ue(e),ae("idle"),ve("Account blocked")}catch{Ce("Could not block. Try again.")}finally{ne(null)}}},[X?.did,x,p,ve,Ce]),De=c.useCallback(async()=>{if(ce){ne("unblock"),oe(null);try{await o(ce),ue(null),ve("Account unblocked")}catch{Ce("Could not unblock. Try again.")}finally{ne(null)}}},[ce,ve,Ce]),Le=c.useCallback(async t=>{if(X?.did){ne("report"),oe(null);try{await s(e,d,t),ve("Report sent to Bluesky")}catch{Ce("Could not send report. Try again.")}finally{ne(null)}}},[X?.did,e,d,ve,Ce]),Ne=c.useCallback(async()=>{if(X?.did){ne("mute"),oe(null);try{await i(h),ve("Thread muted")}catch{Ce("Could not mute thread. Try again.")}finally{ne(null)}}},[X?.did,h,ve,Ce]),$e=c.useCallback(()=>{const t=`${"undefined"!=typeof window?window.location.origin+"/artsky-dev/".replace(/\/$/,""):""}/post/${encodeURIComponent(e)}`;navigator.clipboard.writeText(t).then(()=>ve("Link copied"),()=>Ce("Could not copy link"))},[e,ve,Ce]),Se=c.useCallback(async()=>{if(X?.did&&x){ne("delete");try{await l(e),be(!1),k?.()}catch{}finally{ne(null)}}},[X?.did,x,e,k]),Me=!!X?.did;return a.jsxs("div",{ref:me,className:`${j} ${F?y:""} ${M??""}`,children:[a.jsx("button",{ref:xe,type:"button",className:g,onClick:e=>{e.preventDefault(),e.stopPropagation(),!ge&&xe.current&&je(we()),be(!ge)},"aria-expanded":ge,"aria-haspopup":"true","aria-label":"More options",title:"More options",children:I?a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"4",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"20",r:"2",fill:"currentColor"})]}):a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[a.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor"})]})}),ge&&ke&&u.createPortal(a.jsxs("div",{ref:e=>{fe.current=e,G&&(G.current=e)},className:`${b} ${w} ${F?v:""}`,style:{position:"fixed",bottom:ke.bottom,...ke.flipH?{left:ke.left}:{right:ke.right}},role:"menu",children:[H?a.jsxs("div",{className:_,role:"presentation",children:["From: ",H]}):null,O?a.jsxs("div",{className:D,role:"presentation",title:f(O),children:["Posted ",m(O)]}):null,re?a.jsx("div",{className:"success"===re.type?L:N,role:"status",children:re.message}):Me?"confirm"===le?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("idle")},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(E,{})}),"Back"]}),a.jsxs("div",{className:$,children:["Block ",de?`@${de}`:"this user","?"]}),a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),_e()},disabled:"block"===te,role:"menuitem",children:[a.jsx("span",{className:S,children:"block"===te?"…":a.jsx(q,{})}),"block"===te?"":"Yes, block"]})]}):"reason"===se?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ie("main")},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(E,{})}),"Back"]}),a.jsx("div",{className:$,children:"Report to Bluesky"}),[{label:"Spam",reasonType:"com.atproto.moderation.defs#reasonSpam"},{label:"Harassment",reasonType:"com.atproto.moderation.defs#reasonViolation"},{label:"Misleading",reasonType:"com.atproto.moderation.defs#reasonMisleading"},{label:"Other",reasonType:"com.atproto.moderation.defs#reasonOther"}].map(({label:e,reasonType:t})=>a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Le(t)},disabled:"report"===te,role:"menuitem",children:[a.jsx("span",{className:S,children:"report"===te?"…":a.jsx(R,{})}),"report"===te?"":e]},t))]}):a.jsxs(a.Fragment,{children:[x&&a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Se()},disabled:"delete"===te,role:"menuitem",children:[a.jsx("span",{className:S,children:"delete"===te?"…":a.jsx(W,{})}),"delete"===te?"":"Delete post"]}),!x&&(ce?a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),De()},disabled:"unblock"===te,role:"menuitem",children:[a.jsx("span",{className:S,children:"unblock"===te?"…":a.jsx(A,{})}),"unblock"===te?"":"Unblock account"]}):a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("confirm")},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(q,{})}),"Block user"]})),a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ie("reason")},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(R,{})}),"Report post"]}),a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne()},disabled:"mute"===te,role:"menuitem",children:[a.jsx("span",{className:S,children:"mute"===te?"…":a.jsx(V,{})}),"mute"===te?"":"Mute thread"]}),Q&&Y&&a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Q()},disabled:J,role:"menuitem",children:[a.jsx("span",{className:S,children:J?"…":a.jsx(P,{})}),J?"":Y]}),K&&a.jsxs("button",{type:"button",className:C,onClick:t=>{t.preventDefault(),t.stopPropagation(),K(e),be(!1)},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(B,{})}),"View Quotes"]}),a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),$e()},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(T,{})}),"Copy link to post"]})]}):a.jsxs(a.Fragment,{children:[Q&&Y&&a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Q()},disabled:J,role:"menuitem",children:[a.jsx("span",{className:S,children:J?"…":a.jsx(P,{})}),J?"":Y]}),K&&a.jsxs("button",{type:"button",className:C,onClick:t=>{t.preventDefault(),t.stopPropagation(),K(e),be(!1)},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(B,{})}),"View Quotes"]}),a.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),$e()},role:"menuitem",children:[a.jsx("span",{className:S,children:a.jsx(T,{})}),"Copy link to post"]})]})]}),document.body)]})});export{F as P,p as a,f as b,x as f,h as g,k as l};
