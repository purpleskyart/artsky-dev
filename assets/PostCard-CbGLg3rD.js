import{j as e,k as t,h as a,ad as r,v as n,w as i,u as o,S as s,a7 as d,f as l,b as c,ax as u}from"./index-Cixw3jdx.js";import{r as m,e as p,a as h}from"./react-vendor-rw3WIpbI.js";import{l as x,P as _}from"./PostActionsMenu-4D4JLWpJ.js";import{f as v,g as k,c as f,a as w,b as y,i as g}from"./artboards-DNvSVVrd.js";import{p as b}from"./artboardsPds-DWUixJ9h.js";import{g as j,b as R}from"./date-Ct-NsrQr.js";import{P as z,a as C}from"./PostText-0G7hlYgr.js";let L=null;function N(e,t){if(!e||!e.startsWith("http"))return e??"";if(!function(){if(null!==L)return L;if("undefined"==typeof document)return L=!1,L;const e=document.createElement("canvas");return L=!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),L}())return e;return`https://wsrv.nl/?url=${encodeURIComponent(e)}&output=webp`}const T="_progressiveImage_8ku7v_1",A="_placeholder_8ku7v_8",P="_fullImage_8ku7v_21",$="_loaded_8ku7v_30",M="_error_8ku7v_38",I="_errorPlaceholder_8ku7v_46",S="_errorText_8ku7v_60";function E({src:t,alt:a,aspectRatio:r,loading:n="lazy",className:i="",onLoad:o,sizes:s=[320,640,960,1280,1920],sizesAttr:d,maxRetries:l=3}){const[c,u]=m.useState(!1),[p,h]=m.useState(!1),[x,_]=m.useState(0),[v,k]=m.useState(!1),[f,w]=m.useState(!1),y=m.useRef(null),g=m.useMemo(()=>N(t),[t]),b=m.useMemo(()=>{if(t.includes("cdn.bsky.app"))return s.map(e=>`${N(t.includes("?")?`${t}&width=${e}`:`${t}?width=${e}`)} ${e}w`).join(", ")},[t,s]),j=m.useMemo(()=>"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",[]),R=d||j,z=m.useMemo(()=>{if(t.includes("cdn.bsky.app"))return t.replace(/\/img\/[^/]+\//,"/img/avatar_thumbnail/")},[t]),C=m.useCallback(e=>{u(!0),h(!1),k(!1),_(0),o?.(e)},[o]),L=m.useCallback(()=>{w(!0)},[]),E=m.useCallback(()=>{if(p||g===t)if(x<l){const e=1e3*Math.pow(2,x);y.current=setTimeout(()=>{_(e=>e+1),h(!1)},e)}else k(!0);else h(!0)},[p,g,t,x,l]);m.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]),m.useEffect(()=>{_(0),k(!1),u(!1),h(!1),w(!1)},[t]);const O=p?t:g;return v?e.jsx("div",{className:`${T} ${M} ${i}`,style:{aspectRatio:r?String(r):void 0},role:"img","aria-label":`Failed to load: ${a}`,children:e.jsxs("div",{className:I,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:S,children:"Image failed to load"})]})}):e.jsxs("div",{className:`${T} ${c?$:""} ${i}`,style:{aspectRatio:r?String(r):void 0},children:[z&&!c&&!f&&e.jsx("img",{src:z,alt:"",className:A,"aria-hidden":"true",onError:L}),e.jsx("img",{src:O,srcSet:b,sizes:b?R:void 0,alt:a,loading:n,onLoad:C,onError:E,className:P},`${O}-${x}`)]})}const O={card:"_card_mmkxz_2",cardLink:"_cardLink_mmkxz_22",cardSelected:"_cardSelected_mmkxz_44",cardLiked:"_cardLiked_mmkxz_74",cardInArtboard:"_cardInArtboard_mmkxz_82",cardTransFlag:"_cardTransFlag_mmkxz_90",mediaWrap:"_mediaWrap_mmkxz_135",nsfwOverlay:"_nsfwOverlay_mmkxz_136",cardArtOnly:"_cardArtOnly_mmkxz_139",textOnlyPreview:"_textOnlyPreview_mmkxz_143",cardSeen:"_cardSeen_mmkxz_148",cardFillCell:"_cardFillCell_mmkxz_243",meta:"_meta_mmkxz_255",mediaGridCellFocused:"_mediaGridCellFocused_mmkxz_278",addWrap:"_addWrap_mmkxz_295",addWrapOpen:"_addWrapOpen_mmkxz_304",cardActionRow:"_cardActionRow_mmkxz_309",cardActionRowCenter:"_cardActionRowCenter_mmkxz_316",cardLikeRepostBtn:"_cardLikeRepostBtn_mmkxz_345",addToBoardBtn:"_addToBoardBtn_mmkxz_346",cardActionRowAvatarFollow:"_cardActionRowAvatarFollow_mmkxz_349",cardActionRowAvatarPlus:"_cardActionRowAvatarPlus_mmkxz_349",cardActionRowRight:"_cardActionRowRight_mmkxz_363",cardActionRowTime:"_cardActionRowTime_mmkxz_374",postTimeStacked:"_postTimeStacked_mmkxz_381",postTimeMonth:"_postTimeMonth_mmkxz_389",postTimeDayYear:"_postTimeDayYear_mmkxz_396",cardActionRowAvatar:"_cardActionRowAvatar_mmkxz_349",handleRow:"_handleRow_mmkxz_488",authorAvatar:"_authorAvatar_mmkxz_488",authorAvatarPlaceholder:"_authorAvatarPlaceholder_mmkxz_489",handleRowMain:"_handleRowMain_mmkxz_512",handleRowMeta:"_handleRowMeta_mmkxz_515",cardMinimalist:"_cardMinimalist_mmkxz_553",cardLikeRepostBtnActive:"_cardLikeRepostBtnActive_mmkxz_614",addToBoardBtnInCollection:"_addToBoardBtnInCollection_mmkxz_661",collectIcon:"_collectIcon_mmkxz_665",addDropdown:"_addDropdown_mmkxz_678",addDropdownFixed:"_addDropdownFixed_mmkxz_702",addBoardLabel:"_addBoardLabel_mmkxz_708",addBoardCheckbox:"_addBoardCheckbox_mmkxz_722",addBoardText:"_addBoardText_mmkxz_727",addDropdownNew:"_addDropdownNew_mmkxz_733",addBoardInput:"_addBoardInput_mmkxz_739",addDropdownActions:"_addDropdownActions_mmkxz_750",addBoardSubmit:"_addBoardSubmit_mmkxz_756",mediaWrapConstrained:"_mediaWrapConstrained_mmkxz_829",nsfwOverlayText:"_nsfwOverlayText_mmkxz_855",mediaWrapFillCell:"_mediaWrapFillCell_mmkxz_864",mediaWrapMultiStack:"_mediaWrapMultiStack_mmkxz_872",media:"_media_mmkxz_135",textOnlyPreviewText:"_textOnlyPreviewText_mmkxz_909",textOnlyPreviewEmpty:"_textOnlyPreviewEmpty_mmkxz_919",textOnlyPreviewLink:"_textOnlyPreviewLink_mmkxz_924",textOnlyPreviewLinkThumb:"_textOnlyPreviewLinkThumb_mmkxz_944",textOnlyPreviewLinkTitle:"_textOnlyPreviewLinkTitle_mmkxz_951",textOnlyPreviewLinkDesc:"_textOnlyPreviewLinkDesc_mmkxz_960",mediaWrapGridSpacer:"_mediaWrapGridSpacer_mmkxz_997",mediaWrapGrid:"_mediaWrapGrid_mmkxz_997",mediaGrid:"_mediaGrid_mmkxz_278",mediaGridCell:"_mediaGridCell_mmkxz_278",mediaGridImg:"_mediaGridImg_mmkxz_1054",mediaVideoWrap:"_mediaVideoWrap_mmkxz_1096",handleBlock:"_handleBlock_mmkxz_1122",postTime:"_postTime_mmkxz_381",repostIconLink:"_repostIconLink_mmkxz_1225",repostIcon:"_repostIcon_mmkxz_1225",pinIconWrap:"_pinIconWrap_mmkxz_1244",pinIcon:"_pinIcon_mmkxz_1244",handleLinkWrap:"_handleLinkWrap_mmkxz_1262",handleLinkWrapLiked:"_handleLinkWrapLiked_mmkxz_1272",handleLink:"_handleLink_mmkxz_1153",text:"_text_mmkxz_143"};function W(){return e.jsx("svg",{className:O.repostIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})})}function B(){return e.jsx("svg",{className:O.pinIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})})}function D(){return e.jsx("svg",{className:O.collectIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}const F=m.memo(function({item:L,isSelected:N,cardRef:T,addButtonRef:A,openAddDropdown:P,onAddClose:$,onPostClick:M,onAspectRatio:I,fillCell:S,nsfwBlurred:F,onNsfwUnblur:G,constrainMediaHeight:H,likedUriOverride:U,onLikedChange:V,seen:Y,onActionsMenuOpenChange:K,cardIndex:Q,actionsMenuOpenForIndex:X,focusedMediaIndex:q,onMediaRef:J}){const Z=p(),{session:ee}=t(),{openLoginModal:te}=a(),{artOnly:ae,minimalist:re}=r(),{mediaMode:ne}=n(),{unblurredUris:ie,setUnblurred:oe}=i(),{openQuotesModal:se,isModalOpen:de}=o(),le=m.useRef(null),ce=m.useRef(null),ue=m.useRef(null),{post:me,reason:pe}=L,he=L._feedSource,xe=he?.label??("timeline"===he?.kind?"Following":void 0),_e=m.useMemo(()=>s(me),[me]),ve=!!_e,ke=me.record?.text??"",fe=m.useMemo(()=>d(me),[me]),we=m.useMemo(()=>l(me),[me]),ye=me.author.handle??me.author.did,ge=pe?.by?pe.by.handle??pe.by.did:null,be=(()=>{const e=me?.embed;return!!e&&("app.bsky.embed.record#view"===e.$type||"app.bsky.embed.recordWithMedia#view"===e.$type)})(),je="app.bsky.feed.defs#reasonPin"===pe?.$type,Re=me.author.viewer,ze=Re?.following,[Ce,Le]=m.useState(ze??null),Ne=!!(Ce??ze??null),Te=ee?.did===me.author.did,[Ae,Pe]=m.useState(!1),$e=me.viewer,Me=$e?.like,[Ie,Se]=m.useState(Me),[Ee,Oe]=m.useState(!1),We=void 0!==U?U??void 0:Ie,Be=!!We,De=v(me.uri),Fe=Be&&De,[Ge,He]=m.useState(()=>ve&&null!=_e?.aspectRatio?_e.aspectRatio:null),[Ue,Ve]=m.useState(!1),[Ye,Ke]=m.useState(!1),Qe=m.useRef(null),[Xe,qe]=m.useState(new Set),[Je,Ze]=m.useState(""),et=m.useRef(null),tt=m.useRef(null),at=m.useRef(null),rt=m.useRef(null),[nt,it]=m.useState(null),ot=m.useRef(null),st=m.useRef(N),dt=m.useRef(0),lt=m.useRef(0),ct=m.useRef(!1),ut=m.useRef(!1),mt=m.useRef(!1),pt=m.useRef(null),ht=m.useRef(null);m.useEffect(()=>{null!=Q&&X!==Q&&Ye&&Ke(!1)},[X,Q,Ye]);const xt=m.useRef(null);m.useEffect(()=>{null!=Q&&(X===Q&&xt.current!==Q&&Ke(!0),xt.current=X??null)},[X,Q]),m.useEffect(()=>{if(!Ye)return;const e=e=>!e||!ot.current?.contains(e)&&!Qe.current?.contains(e),t=t=>{e(t.target)&&Ke(!1)},a=t=>{const a=t.target??t.target;e(a)&&Ke(!1)},r=t=>{e(t.target)&&Ke(!1)};return document.addEventListener("focusin",t),document.addEventListener("mousedown",a),document.addEventListener("touchstart",a,{passive:!0}),document.addEventListener("mouseover",r),()=>{document.removeEventListener("focusin",t),document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a),document.removeEventListener("mouseover",r)}},[Ye]),m.useEffect(()=>{Se(void 0!==U?U??void 0:Me)},[me.uri,Me,U]),m.useEffect(()=>{Le(ze??null)},[me.uri,ze]);const _t=m.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),Ae||Te||!ee?.did||Ne)return;Pe(!0);const t=`pending:follow:${me.author.did}:${Date.now()}`;Le(t);try{const e=await c.follow(me.author.did);Le(e.uri)}catch{Le(null)}finally{Pe(!1)}},[Ae,Te,ee?.did,Ne,me.author.did]),vt=m.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!ee?.did)return void te();if(Ee)return;const t=!!We,a=We||void 0;Oe(!0),Se(t?void 0:"pending");try{if(t)await c.deleteLike(a),Se(void 0);else{const e=await c.like(me.uri,me.cid);Se(e.uri)}}catch{Se(a)}finally{Oe(!1)}},[ee?.did,te,Ee,We,me.uri,me.cid]);m.useEffect(()=>{P&&Ve(!0)},[P]),m.useEffect(()=>()=>{pt.current&&(clearTimeout(pt.current),pt.current=null)},[]);const kt=m.useRef(Ue);m.useEffect(()=>{kt.current&&!Ue&&$?.(),kt.current=Ue},[Ue,$]);const ft=m.useCallback(()=>{if(!et.current)return null;const e=et.current.getBoundingClientRect(),t=window.innerWidth-8-140,a=e.left+e.width/2,r=Math.max(148,Math.min(t,a));return{bottom:window.innerHeight-e.top,left:r}},[]);m.useLayoutEffect(()=>{Ue&&et.current?it(ft()):it(null)},[Ue,ft]),m.useEffect(()=>{if(!Ue)return;const e=()=>it(e=>e?ft()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[Ue,ft]),m.useEffect(()=>{if(Ue)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){const t=e.target;et.current?.contains(t)||tt.current?.contains(t)||rt.current?.contains(t)||Ve(!1)}},[Ue]);const wt=k(),yt=m.useCallback(e=>{qe(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),gt=m.useCallback(async()=>{if(!(Xe.size>0||Je.trim().length>0))return;const e=u(me),t=we.length>0?we.map(e=>e.url):void 0,a={uri:me.uri,cid:me.cid,authorHandle:me.author.handle,text:me.record?.text?.slice(0,200),thumb:e?.url??t?.[0],thumbs:t},r=[];if(Je.trim()){const e=f(Je.trim());w(e.id,a),r.push(e.id),Ze("")}if(Xe.forEach(e=>{w(e,a),r.push(e)}),qe(new Set),Ve(!1),ee?.did&&r.length>0)for(const n of r){const e=y(n);if(e)try{await b(c,ee.did,e)}catch{}}},[Xe,Je,me,we,ee?.did]),bt=ve&&"video"===_e.type&&_e.videoPlaylist,jt=ve&&"image"===_e.type&&(_e.imageCount??0)>1,Rt=m.useMemo(()=>we.filter(e=>"image"===e.type),[we]),zt=m.useMemo(()=>we.map((e,t)=>"image"===e.type?t:-1).filter(e=>e>=0),[we]),Ct=jt&&Rt.length?Rt[0]?.url:_e?.url??"",Lt=m.useCallback(e=>{const t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&He(e=>null!=e?e:t.naturalWidth/t.naturalHeight)},[jt]);m.useEffect(()=>{ve&&(null!=_e?.aspectRatio?He(e=>e??_e.aspectRatio):bt||He(e=>e??null))},[ve,_e?.aspectRatio,_e?.videoPlaylist,bt]),m.useEffect(()=>{He(ve&&null!=_e?.aspectRatio?_e.aspectRatio:null)},[me.uri]),m.useEffect(()=>{null!=Ge&&I&&I(Ge)},[Ge,I]),m.useEffect(()=>{if(!bt||!_e?.videoPlaylist||!le.current)return;const e=le.current,t=_e.videoPlaylist;let a;var r;return/\.m3u8(\?|$)/i.test(r=t)||r.includes("m3u8")?x().then(r=>{if(le.current)if(r.isSupported()){const n=new r;ue.current=n,n.loadSource(t),n.attachMedia(e),n.on(r.Events.ERROR,()=>{}),a=()=>{n.destroy(),ue.current=null}}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t,a=()=>{e.removeAttribute("src")})}).catch(()=>{e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}):(e.src=t,a=()=>{e.removeAttribute("src")}),()=>{a?.()}},[bt,_e?.videoPlaylist]);const Nt=m.useRef(de);Nt.current=de,m.useEffect(()=>{if(!bt||!ce.current||!le.current)return;const e=ce.current,t=le.current;de&&t.pause();const a=new IntersectionObserver(e=>{const a=e[0];a&&t&&(Nt.current?t.pause():a.isIntersecting?t.play().catch(()=>{}):t.pause())},{threshold:.25,rootMargin:"0px"});return a.observe(e),()=>a.disconnect()},[bt,de]),m.useEffect(()=>{const e=st.current;st.current=N,N&&F&&G&&G(),e&&!N&&ie.has(me.uri)&&oe(me.uri,!1)},[N,me.uri,ie,oe,F,G]),m.useEffect(()=>{const e=ot.current;if(!e||!ie.has(me.uri))return;const t=t=>{const a=t.relatedTarget;null!=a&&e.contains(a)||oe(me.uri,!1)};return e.addEventListener("focusout",t),()=>e.removeEventListener("focusout",t)},[me.uri,ie,oe]),m.useEffect(()=>{if(!ve||!ie.has(me.uri)||!ce.current)return;const e=ce.current,t=new IntersectionObserver(e=>{const t=e[0];!t||t.intersectionRatio>0||oe(me.uri,!1)},{threshold:0,rootMargin:"0px"});return t.observe(e),()=>t.disconnect()},[ve,me.uri,ie,oe]);const Tt=m.useCallback(()=>{le.current&&le.current.play().catch(()=>{})},[]),At=m.useCallback(()=>{le.current&&(le.current.pause(),le.current.currentTime=0)},[]),Pt=m.useCallback(e=>{if(ct.current)return ct.current=!1,e.preventDefault(),void e.stopPropagation();ut.current||(M?M(me.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(me.uri)}`))},[ct,ut,M,me.uri,L,Z]),$t=m.useCallback(()=>{M?M(me.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(me.uri)}`)},[M,me.uri,L,Z]),Mt=m.useCallback(()=>{ee?.did?We?(Se(void 0),c.deleteLike(We).then(()=>{V?.(me.uri,null)}).catch(()=>Se(We))):(Se("pending"),c.like(me.uri,me.cid).then(e=>{Se(e.uri),V?.(me.uri,e.uri)}).catch(()=>Se(void 0))):te()},[ee?.did,te,We,me.uri,me.cid,V]),It=m.useCallback(e=>{if(e.stopPropagation(),mt.current)return;const t=Date.now();t-lt.current<400?(lt.current=0,Mt()):(lt.current=t,setTimeout(()=>$t(),400))},[mt,lt,Mt,$t]),St=m.useCallback(e=>{ot.current=e,T&&("function"==typeof T?T(e):T.current=e)},[T]);return e.jsx("div",{ref:St,"data-post-uri":me.uri,className:`${O.card} ${N?O.cardSelected:""} ${Fe?O.cardTransFlag:""} ${!Fe&&Be?O.cardLiked:""} ${!Fe&&De?O.cardInArtboard:""} ${Y&&!N?O.cardSeen:""} ${S?O.cardFillCell:""} ${ae?O.cardArtOnly:""} ${re?O.cardMinimalist:""}`,children:e.jsxs("div",{role:"button",tabIndex:0,className:O.cardLink,onClick:Pt,onKeyDown:e=>{"Enter"===e.key&&(M?M(me.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(me.uri)}`))},onTouchStart:e=>{ut.current=!0,mt.current=!0;const t=e.touches[0];ht.current=t?{x:t.clientX,y:t.clientY}:null},onTouchEnd:e=>{const t=ht.current;ht.current=null;const a=e.changedTouches[0];if((t&&a?Math.hypot(a.clientX-t.x,a.clientY-t.y):0)>12)return pt.current&&(clearTimeout(pt.current),pt.current=null),ut.current=!1,void(mt.current=!1);const r=Date.now();r-dt.current<400?(dt.current=0,ct.current=!0,pt.current&&(clearTimeout(pt.current),pt.current=null),e.preventDefault(),We?(Se(void 0),c.deleteLike(We).then(()=>{V?.(me.uri,null)}).catch(()=>Se(We))):(Se("pending"),c.like(me.uri,me.cid).then(e=>{Se(e.uri),V?.(me.uri,e.uri)}).catch(()=>Se(void 0))),setTimeout(()=>{ut.current=!1,mt.current=!1},500)):(dt.current=r,pt.current&&clearTimeout(pt.current),pt.current=setTimeout(()=>{pt.current=null,ut.current=!1,mt.current=!1,$t()},400))},children:[e.jsxs("div",{ref:e=>{ce.current=e,!J||"text"!==ne&&(!ve||jt&&Rt.length>1)||J(0,e)},className:`${O.mediaWrap} ${S?O.mediaWrapFillCell:""} ${H?O.mediaWrapConstrained:""} ${jt&&Rt.length>1?O.mediaWrapMultiStack:""}`,style:S||H||jt&&Rt.length>1?void 0:{aspectRatio:ve?null!=Ge?String(Ge):bt?"1":void 0:"1"},onMouseEnter:Tt,onMouseLeave:At,...ve&&{onClick:It},children:[ve&&"text"!==ne?bt?e.jsx("div",{className:O.mediaVideoWrap,children:e.jsx("video",{ref:le,className:O.media,poster:_e.url||void 0,muted:!0,playsInline:!0,loop:!0,preload:"metadata",style:{aspectRatio:null!=Ge?`${Ge}`:void 0},onLoadedMetadata:e=>{const t=e.currentTarget;t.videoWidth&&t.videoHeight&&He(e=>null!=e?e:t.videoWidth/t.videoHeight)}})}):jt&&Rt.length>1?e.jsxs(e.Fragment,{children:[(()=>{const t=1/Rt.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return e.jsx("div",{className:O.mediaWrapGridSpacer,style:{aspectRatio:String(t)},"aria-hidden":!0})})(),e.jsx("div",{className:O.mediaWrapGrid,children:e.jsx("div",{className:O.mediaGrid,style:{minHeight:0},children:Rt.map((t,a)=>{const r=zt[a]??a,n=q===r;return e.jsx("div",{ref:e=>J?.(r,e),className:`${O.mediaGridCell} ${n?O.mediaGridCellFocused:""}`,style:{flex:1/(t.aspectRatio||1)+" 1 0"},children:e.jsx(E,{src:t.url,alt:"",className:O.mediaGridImg,loading:"lazy",onLoad:0===a?Lt:void 0})},a)})})})]}):e.jsx(e.Fragment,{children:e.jsx(E,{src:Ct,alt:"",className:O.media,loading:"eager",onLoad:Lt})}):e.jsxs("div",{className:O.textOnlyPreview,children:[ke?e.jsx("div",{className:O.textOnlyPreviewText,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(z,{text:ke,facets:me.record?.facets,maxLength:500,stopPropagation:!0,interactive:!1})}):null,fe?e.jsxs("a",{href:fe.uri,target:"_blank",rel:"noopener noreferrer",className:O.textOnlyPreviewLink,onClick:e=>e.stopPropagation(),children:[fe.thumb?e.jsx(E,{src:fe.thumb,alt:"",className:O.textOnlyPreviewLinkThumb,loading:"lazy"}):null,e.jsx("span",{className:O.textOnlyPreviewLinkTitle,children:fe.title}),fe.description?e.jsx("span",{className:O.textOnlyPreviewLinkDesc,children:fe.description}):null]}):null,ke||fe?null:e.jsx("span",{className:O.textOnlyPreviewEmpty,children:"Text post"})]}),F&&G&&ve&&e.jsx("div",{className:O.nsfwOverlay,onClick:e=>{e.preventDefault(),e.stopPropagation(),G(),$t()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),G(),$t())},role:"button",tabIndex:0,"aria-label":"Reveal sensitive content",children:e.jsx("span",{className:O.nsfwOverlayText,children:"NSFW"})})]}),(!ae||re)&&e.jsxs("div",{className:O.meta,children:[e.jsxs("div",{className:O.cardActionRow,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:O.cardActionRowCenter,children:[e.jsxs("div",{className:`${O.addWrap} ${Ue?O.addWrapOpen:""}`,ref:et,children:[e.jsx("button",{ref:at,type:"button",className:`${O.addToBoardBtn} ${De?O.addToBoardBtnInCollection:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:e=>{e.preventDefault(),e.stopPropagation(),ee?.did?Ve(e=>!e):te()},"aria-label":"Collect","aria-expanded":Ue,children:e.jsx(D,{})}),Ue&&nt&&h.createPortal(e.jsxs("div",{ref:rt,className:`${O.addDropdown} ${O.addDropdownFixed}`,style:{position:"fixed",bottom:nt.bottom,left:nt.left,transform:"translateX(-50%)",zIndex:1001},children:[0===wt.length?null:e.jsx(e.Fragment,{children:wt.map(t=>{const a=g(t.id,me.uri),r=Xe.has(t.id);return e.jsxs("label",{className:O.addBoardLabel,children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>!a&&yt(t.id),disabled:a,className:O.addBoardCheckbox}),e.jsx("span",{className:O.addBoardText,children:a?e.jsxs(e.Fragment,{children:["✓ ",t.name]}):t.name})]},t.id)})}),e.jsx("div",{className:O.addDropdownNew,children:e.jsx("input",{type:"text",placeholder:"New collection name",value:Je,onChange:e=>Ze(e.target.value),className:O.addBoardInput,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),gt())})}),e.jsx("div",{className:O.addDropdownActions,children:e.jsx("button",{type:"button",className:O.addBoardSubmit,onClick:gt,disabled:0===Xe.size&&!Je.trim(),children:"Add to selected"})})]}),document.body)]}),me.author.avatar&&(Te||!ee||Ne?e.jsx(C,{handle:ye,className:O.cardActionRowAvatar,onClick:e=>e.stopPropagation(),"aria-label":`View @${ye} profile`,children:e.jsx(E,{src:me.author.avatar,alt:"",loading:"lazy"})}):e.jsxs("button",{type:"button",className:`${O.cardActionRowAvatar} ${O.cardActionRowAvatarFollow}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:_t,disabled:Ae,"aria-label":`Follow @${ye}`,title:`Follow @${ye}`,children:[e.jsx(E,{src:me.author.avatar,alt:"",loading:"lazy"}),e.jsx("span",{className:O.cardActionRowAvatarPlus,"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 8 8",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M4 2v4M2 4h4"})})})]})),e.jsx("button",{type:"button",className:`${O.cardLikeRepostBtn} ${Be?O.cardLikeRepostBtnActive:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:vt,disabled:Ee,title:Be?"Remove like":"Like","aria-label":Be?"Remove like":"Like",children:Be?"♥":"♡"})]}),e.jsxs("div",{className:O.cardActionRowRight,children:[me.record?.createdAt&&(()=>{const t=me.record.createdAt,a=j(t);return"relative"===a.kind?e.jsx("span",{className:O.cardActionRowTime,title:R(t),"aria-hidden":!0,children:a.text}):e.jsxs("span",{className:`${O.cardActionRowTime} ${O.postTimeStacked}`,title:R(t),"aria-hidden":!0,children:[e.jsx("span",{className:O.postTimeMonth,children:a.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[a.day,a.year?` ${a.year}`:""]})]})})(),e.jsx(_,{postUri:me.uri,postCid:me.cid,authorDid:me.author.did,rootUri:me.uri,isOwnPost:Te,compact:!0,verticalIcon:!0,className:O.cardActionsMenu,open:Ye,onOpenChange:e=>{Ke(e),K?.(e)},dropdownRef:Qe,feedLabel:xe,postedAt:me.record?.createdAt,onViewQuotes:se})]})]}),!re&&e.jsx("div",{className:O.handleBlock,children:e.jsxs("div",{className:O.handleRow,children:[me.author.avatar?e.jsx(E,{src:me.author.avatar,alt:"",className:O.authorAvatar,loading:"lazy"}):me.author.did?e.jsx("span",{className:O.authorAvatarPlaceholder,"aria-hidden":!0,children:(ye||me.author.did).slice(0,1).toUpperCase()}):null,e.jsxs("span",{className:O.handleRowMain,children:[e.jsx("span",{className:We?O.handleLinkWrapLiked:O.handleLinkWrap,children:e.jsxs(C,{handle:ye,className:O.handleLink,onClick:e=>e.stopPropagation(),children:["@",ye]})}),(ge||be)&&e.jsx("span",{className:O.repostIconLink,role:"button",tabIndex:0,title:ge?`Reposted by @${ge}`:"Quote post","aria-label":ge?`Reposted by @${ge}`:"Quote post",onClick:e=>{e.stopPropagation(),Pt(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$t())},children:e.jsx(W,{})})]}),e.jsxs("span",{className:O.handleRowMeta,children:[je&&e.jsx("span",{className:O.pinIconWrap,title:"Pinned",children:e.jsx(B,{})}),me.record?.createdAt&&(()=>{const t=me.record.createdAt,a=j(t);return"relative"===a.kind?e.jsx("span",{className:O.postTime,title:R(t),children:a.text}):e.jsxs("span",{className:`${O.postTime} ${O.postTimeStacked}`,title:R(t),children:[e.jsx("span",{className:O.postTimeMonth,children:a.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[a.day,a.year?` ${a.year}`:""]})]})})()]})]})}),!re&&ve&&ke?e.jsx("p",{className:O.text,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(z,{text:ke,facets:me.record?.facets,maxLength:80,stopPropagation:!0,interactive:!1})}):null]})]})})},(e,t)=>{if(e.item.post.uri!==t.item.post.uri)return!1;if(e.isSelected!==t.isSelected)return!1;if(e.likedUriOverride!==t.likedUriOverride)return!1;if(e.seen!==t.seen)return!1;if(e.nsfwBlurred!==t.nsfwBlurred)return!1;if(e.fillCell!==t.fillCell)return!1;if(e.constrainMediaHeight!==t.constrainMediaHeight)return!1;if(e.openAddDropdown!==t.openAddDropdown)return!1;if(e.cardIndex!==t.cardIndex)return!1;if(e.actionsMenuOpenForIndex!==t.actionsMenuOpenForIndex)return!1;if(e.focusedMediaIndex!==t.focusedMediaIndex)return!1;if(e.item.post.cid!==t.item.post.cid)return!1;if(e.item.post.likeCount!==t.item.post.likeCount)return!1;return e.item.post.repostCount===t.item.post.repostCount});export{F as P};
