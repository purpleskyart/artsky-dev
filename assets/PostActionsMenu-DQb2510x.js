import{ay as e,g as t,b as n,y as o,E as r,az as s,aA as i,aB as l,j as a}from"./index-Cb7olAwr.js";import{b as c,h as u}from"./react-vendor-DGaPsC2e.js";import{c as d,b as p}from"./date-Ct-NsrQr.js";async function h(){const{default:t}=await e(async()=>{const{default:e}=await import("./video-DCuzn9dR.js");return{default:e}},[]);return t}const m="_wrap_qker0_1",x="_wrapCompact_qker0_8",f="_trigger_qker0_8",k="_dropdown_qker0_44",j="_dropdownFixed_qker0_62",y="_dropdownCompact_qker0_68",b="_item_qker0_73",g="_feedLabel_qker0_78",w="_postedAt_qker0_84",v="_feedbackSuccess_qker0_92",C="_feedbackError_qker0_100",_="_reportReasonLabel_qker0_108",N="_itemIcon_qker0_138",L=18;function D(){return a.jsx("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:a.jsx("path",{d:"M12 5v14m0 0l-4-4m4 4l4-4"})})}function P(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),a.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}function B(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H3c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"}),a.jsx("path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-5c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"})]})}function E(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),a.jsx("polyline",{points:"12 19 5 12 12 5"})]})}function q(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]})}function T(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M18 6L6 18M6 6l12 12"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})}function M(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),a.jsx("line",{x1:"4",y1:"22",x2:"4",y2:"15"})]})}function A(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),a.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),a.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]})}function R(){return a.jsxs("svg",{width:L,height:L,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),a.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),a.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}const S=c.memo(function({postUri:e,postCid:h,authorDid:L,rootUri:S,isOwnPost:V,onHidden:W,className:$,compact:F,feedLabel:H,postedAt:O,open:U,onOpenChange:z,verticalIcon:I,onDownload:Q,downloadLabel:Y,downloadLoading:G,dropdownRef:J,onViewQuotes:K}){const X=t(),[Z,ee]=c.useState(!1),[te,ne]=c.useState(null),[oe,re]=c.useState(null),[se,ie]=c.useState("main"),[le,ae]=c.useState("idle"),[ce,ue]=c.useState(null),[de,pe]=c.useState(null),he=c.useRef(null),me=c.useRef(null),xe=c.useRef(null),fe=c.useRef(null),[ke,je]=c.useState(null),ye=void 0!==U&&void 0!==z,be=ye?U:Z;function ge(e){ye?z?.(e):ee(e)}function we(){if(!fe.current)return null;const e=fe.current.getBoundingClientRect();return{bottom:window.innerHeight-e.top,right:window.innerWidth-e.right}}c.useEffect(()=>{be||(fe.current?.blur(),ie("main"),ae("idle"),re(null),he.current&&(clearTimeout(he.current),he.current=null))},[be]),c.useEffect(()=>{if(!be||!X?.did||V)return;let e=!1;return n.getProfile({actor:L}).then(t=>{if(e)return;const n=t.data;ue(n.viewer?.blocking??null),pe(n.handle??null)}).catch(()=>{e||(ue(null),pe(null))}),()=>{e=!0}},[be,X?.did,V,L]),c.useLayoutEffect(()=>{be&&fe.current?je(we()):je(null)},[be]),c.useEffect(()=>{if(!be)return;const e=()=>je(e=>e?we()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[be]),c.useEffect(()=>{if(!be)return;const e=e=>{const t=e.target;me.current?.contains(t)||xe.current?.contains(t)||ge(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[be]),c.useEffect(()=>{if(!be)return;const e=xe.current;if(e){const t=e.querySelectorAll('button[role="menuitem"]')[0];t&&t.focus()}},[be]),c.useEffect(()=>{if(!be)return;const e=e=>{const t=e.key.toLowerCase();if("escape"===t||"q"===t)return e.preventDefault(),void("confirm"===le?ae("idle"):(ge(!1),fe.current?.focus()));if("w"===t||"s"===t||"e"===t||"enter"===t||"ArrowUp"===e.key||"ArrowDown"===e.key){const n=xe.current;if(!n)return;const o=Array.from(n.querySelectorAll('button[role="menuitem"]'));if(0===o.length)return;const r=document.activeElement,s=r&&o.includes(r)?o.indexOf(r):-1;if("e"===t||"enter"===t)return e.preventDefault(),void(s>=0&&!o[s].disabled&&o[s].click());if("w"===t||"ArrowUp"===e.key){e.preventDefault();return void o[s<=0?o.length-1:s-1].focus()}if("s"===t||"ArrowDown"===e.key){e.preventDefault();return void o[s<0||s>=o.length-1?0:s+1].focus()}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[be,le]);const ve=c.useCallback(e=>{re({type:"success",message:e}),he.current&&clearTimeout(he.current),he.current=setTimeout(()=>{he.current=null,ge(!1),re(null)},1800)},[]),Ce=c.useCallback(e=>{re({type:"error",message:e})},[]),_e=c.useCallback(async()=>{if(X?.did&&!V){ne("block"),re(null);try{const{uri:e}=await o(L);ue(e),ae("idle"),ve("Account blocked")}catch{Ce("Could not block. Try again.")}finally{ne(null)}}},[X?.did,V,L,ve,Ce]),Ne=c.useCallback(async()=>{if(ce){ne("unblock"),re(null);try{await r(ce),ue(null),ve("Account unblocked")}catch{Ce("Could not unblock. Try again.")}finally{ne(null)}}},[ce,ve,Ce]),Le=c.useCallback(async t=>{if(X?.did){ne("report"),re(null);try{await s(e,h,t),ve("Report sent to Bluesky")}catch{Ce("Could not send report. Try again.")}finally{ne(null)}}},[X?.did,e,h,ve,Ce]),De=c.useCallback(async()=>{if(X?.did){ne("mute"),re(null);try{await i(S),ve("Thread muted")}catch{Ce("Could not mute thread. Try again.")}finally{ne(null)}}},[X?.did,S,ve,Ce]),Pe=c.useCallback(()=>{const t=`${"undefined"!=typeof window?window.location.origin+"/artsky-dev/".replace(/\/$/,""):""}/post/${encodeURIComponent(e)}`;navigator.clipboard.writeText(t).then(()=>ve("Link copied"),()=>Ce("Could not copy link"))},[e,ve,Ce]),Be=c.useCallback(async()=>{if(X?.did&&V){ne("delete");try{await l(e),ge(!1),W?.()}catch{}finally{ne(null)}}},[X?.did,V,e,W]),Ee=!!X?.did;return a.jsxs("div",{ref:me,className:`${m} ${F?x:""} ${$??""}`,children:[a.jsx("button",{ref:fe,type:"button",className:f,onClick:e=>{if(e.preventDefault(),e.stopPropagation(),!be&&fe.current){const e=fe.current.getBoundingClientRect();je({bottom:window.innerHeight-e.top,right:window.innerWidth-e.right})}ge(!be)},"aria-expanded":be,"aria-haspopup":"true","aria-label":"More options",title:"More options",children:I?a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"4",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"20",r:"2",fill:"currentColor"})]}):a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[a.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),a.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor"})]})}),be&&ke&&u.createPortal(a.jsxs("div",{ref:e=>{xe.current=e,J&&(J.current=e)},className:`${k} ${j} ${F?y:""}`,style:{position:"fixed",bottom:ke.bottom,right:ke.right},role:"menu",children:[H?a.jsxs("div",{className:g,role:"presentation",children:["From: ",H]}):null,O?a.jsxs("div",{className:w,role:"presentation",title:p(O),children:["Posted ",d(O)]}):null,oe?a.jsx("div",{className:"success"===oe.type?v:C,role:"status",children:oe.message}):Ee?"confirm"===le?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("idle")},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(E,{})}),"Back"]}),a.jsxs("div",{className:_,children:["Block ",de?`@${de}`:"this user","?"]}),a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),_e()},disabled:"block"===te,role:"menuitem",children:[a.jsx("span",{className:N,children:"block"===te?"…":a.jsx(q,{})}),"block"===te?"":"Yes, block"]})]}):"reason"===se?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),ie("main")},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(E,{})}),"Back"]}),a.jsx("div",{className:_,children:"Report to Bluesky"}),[{label:"Spam",reasonType:"com.atproto.moderation.defs#reasonSpam"},{label:"Harassment",reasonType:"com.atproto.moderation.defs#reasonViolation"},{label:"Misleading",reasonType:"com.atproto.moderation.defs#reasonMisleading"},{label:"Other",reasonType:"com.atproto.moderation.defs#reasonOther"}].map(({label:e,reasonType:t})=>a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Le(t)},disabled:"report"===te,role:"menuitem",children:[a.jsx("span",{className:N,children:"report"===te?"…":a.jsx(M,{})}),"report"===te?"":e]},t))]}):a.jsxs(a.Fragment,{children:[V&&a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Be()},disabled:"delete"===te,role:"menuitem",children:[a.jsx("span",{className:N,children:"delete"===te?"…":a.jsx(R,{})}),"delete"===te?"":"Delete post"]}),!V&&(ce?a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne()},disabled:"unblock"===te,role:"menuitem",children:[a.jsx("span",{className:N,children:"unblock"===te?"…":a.jsx(T,{})}),"unblock"===te?"":"Unblock account"]}):a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("confirm")},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(q,{})}),"Block user"]})),a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),ie("reason")},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(M,{})}),"Report post"]}),a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),De()},disabled:"mute"===te,role:"menuitem",children:[a.jsx("span",{className:N,children:"mute"===te?"…":a.jsx(A,{})}),"mute"===te?"":"Mute thread"]}),Q&&Y&&a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Q()},disabled:G,role:"menuitem",children:[a.jsx("span",{className:N,children:G?"…":a.jsx(D,{})}),G?"":Y]}),K&&a.jsxs("button",{type:"button",className:b,onClick:t=>{t.preventDefault(),t.stopPropagation(),K(e),ge(!1)},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(B,{})}),"View Quotes"]}),a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Pe()},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(P,{})}),"Copy link to post"]})]}):a.jsxs(a.Fragment,{children:[Q&&Y&&a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Q()},disabled:G,role:"menuitem",children:[a.jsx("span",{className:N,children:G?"…":a.jsx(D,{})}),G?"":Y]}),K&&a.jsxs("button",{type:"button",className:b,onClick:t=>{t.preventDefault(),t.stopPropagation(),K(e),ge(!1)},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(B,{})}),"View Quotes"]}),a.jsxs("button",{type:"button",className:b,onClick:e=>{e.preventDefault(),e.stopPropagation(),Pe()},role:"menuitem",children:[a.jsx("span",{className:N,children:a.jsx(P,{})}),"Copy link to post"]})]})]}),document.body)]})});export{S as P,h as l};
