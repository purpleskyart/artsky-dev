import{j as e,i as t,f as o}from"./index-DO5u49Z-.js";import{r as n}from"./react-vendor-rw3WIpbI.js";import{a as r,u as i}from"./virtual-SmD9oKU4.js";import{P as l}from"./PostCard-MzAp_gv-.js";import{setInitialPostForUri as s}from"./postCache-CTqU0alO.js";const a={wrap:"_wrap_hto31_1",wrapInModal:"_wrapInModal_hto31_8",profileHeader:"_profileHeader_hto31_18",avatar:"_avatar_hto31_26",profileHeaderMain:"_profileHeaderMain_hto31_44",profileMenu:"_profileMenu_hto31_51",profileMeta:"_profileMeta_hto31_63",handleRow:"_handleRow_hto31_80",followBtn:"_followBtn_hto31_86",blockedMutedBtn:"_blockedMutedBtn_hto31_87",followNotifyRow:"_followNotifyRow_hto31_88",handle:"_handle_hto31_80",displayName:"_displayName_hto31_94",followBtnFollowing:"_followBtnFollowing_hto31_135",followLabelHover:"_followLabelHover_hto31_146",followLabelDefault:"_followLabelDefault_hto31_150",notificationBellBtn:"_notificationBellBtn_hto31_158",notificationBellBtnActive:"_notificationBellBtnActive_hto31_185",notificationBellIcon:"_notificationBellIcon_hto31_196",description:"_description_hto31_234",followListRow:"_followListRow_hto31_245",followListBtn:"_followListBtn_hto31_252",followedByFollowsPreview:"_followedByFollowsPreview_hto31_274",followedByFollowsText:"_followedByFollowsText_hto31_295",followedByFollowsAvatars:"_followedByFollowsAvatars_hto31_304",followedByFollowsAvatar:"_followedByFollowsAvatar_hto31_304",followedByFollowsAvatarPlaceholder:"_followedByFollowsAvatarPlaceholder_hto31_311",tabsSticky:"_tabsSticky_hto31_345",postsFilterRow:"_postsFilterRow_hto31_377",profileContent:"_profileContent_hto31_389",tabsBarHidden:"_tabsBarHidden_hto31_392",tabs:"_tabs_hto31_345",tab:"_tab_hto31_345",modalTopBarRightButtons:"_modalTopBarRightButtons_hto31_418",toggleBtn:"_toggleBtn_hto31_424",toggleBtnActive:"_toggleBtnActive_hto31_438",toggleBtnIcon:"_toggleBtnIcon_hto31_443",modalBottomBarButtons:"_modalBottomBarButtons_hto31_451",toggleBtnBottomBar:"_toggleBtnBottomBar_hto31_458",tabsRowInModal:"_tabsRowInModal_hto31_478",tabsInModal:"_tabsInModal_hto31_490",tabActive:"_tabActive_hto31_529",postsFilterBtn:"_postsFilterBtn_hto31_544",postsFilterBtnActive:"_postsFilterBtnActive_hto31_560",feedsList:"_feedsList_hto31_565",feedLink:"_feedLink_hto31_574",feedName:"_feedName_hto31_588",feedDesc:"_feedDesc_hto31_594",textList:"_textList_hto31_603",textPostLink:"_textPostLink_hto31_612",textPostHandleLink:"_textPostHandleLink_hto31_637",textLink:"_textLink_hto31_641",textSnippet:"_textSnippet_hto31_655",error:"_error_hto31_664",loading:"_loading_hto31_671",empty:"_empty_hto31_672",grid:"_grid_hto31_678",gridView1:"_gridView1_hto31_689",gridView2:"_gridView2_hto31_690",gridView3:"_gridView3_hto31_691",gridView4:"_gridView4_hto31_692",gridView5:"_gridView5_hto31_693",gridColumns:"_gridColumns_hto31_716",gridColumn:"_gridColumn_hto31_716",gridItem:"_gridItem_hto31_735",card:"_card_hto31_742",cardSelected:"_cardSelected_hto31_743",loadMoreSentinel:"_loadMoreSentinel_hto31_748",loadingMore:"_loadingMore_hto31_755",more:"_more_hto31_762"},d=100;function _(e){const t=o(e.post);if(0===t.length)return 180;if(t.length>1){const e=1/t.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return d+Math.ceil(280/e)}const n=t[0];return null!=n.aspectRatio&&n.aspectRatio>0?d+Math.ceil(280/n.aspectRatio):320}function c(o){const{column:r,scrollMargin:d,loadMoreSentinelRef:c,hasCursor:h,keyboardAddOpen:u,actionsMenuOpenForIndex:f,nsfwPreference:p,unblurredUris:w,setUnblurred:g,likeOverrides:m,setLikeOverrides:B,openPostModal:v,cardRef:M,onActionsMenuOpenChange:x,onMouseEnter:b,onAddClose:R,constrainMediaHeight:L=!1,isSelected:A}=o,C=n.useRef(0),I=n.useRef(!1);n.useEffect(()=>{const e=()=>{C.current=window.scrollY};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]);const y=i({count:r.length,estimateSize:e=>_(r[e].item),overscan:8,scrollMargin:d,gap:6,scrollToFn:(e,t)=>{I.current||(t?window.scrollTo({top:e,behavior:"smooth"}):window.scrollTo({top:e}))}});n.useEffect(()=>{const e=C.current,t=window.scrollY;Math.abs(t-e)>5&&(I.current=!0,window.scrollTo({top:e}),requestAnimationFrame(()=>{I.current=!1}))},[r.length,y.getTotalSize()]);const F=y.getVirtualItems(),S=y.getTotalSize(),k=y.options.scrollMargin;return 0===r.length?e.jsx("div",{className:a.gridColumn,children:h&&c&&e.jsx("div",{ref:c,className:a.loadMoreSentinel,"aria-hidden":!0})}):e.jsxs("div",{className:a.gridColumn,children:[e.jsx("div",{style:{height:`${S}px`,width:"100%",position:"relative"},children:F.map(o=>{const{item:n,originalIndex:i}=r[o.index];return e.jsx("div",{"data-index":o.index,ref:y.measureElement,className:a.gridItem,"data-post-uri":n.post.uri,"data-selected":A(i)||void 0,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${o.start-k}px)`},onMouseEnter:()=>b(i),children:e.jsx(l,{item:n,isSelected:A(i),cardRef:M(i),openAddDropdown:A(i)&&u,onAddClose:R,onPostClick:(e,t)=>{t?.initialItem&&s(e,t.initialItem),v(e,t?.openReply)},constrainMediaHeight:L,nsfwBlurred:"blurred"===p&&t(n.post)&&!w.has(n.post.uri),onNsfwUnblur:()=>g(n.post.uri,!0),likedUriOverride:m[n.post.uri],onLikedChange:(e,t)=>B(o=>({...o,[e]:t??null})),onActionsMenuOpenChange:e=>x(i,e),cardIndex:i,actionsMenuOpenForIndex:f})},n.post.uri)})}),h&&c&&e.jsx("div",{ref:c,className:a.loadMoreSentinel,"aria-hidden":!0})]})}function h(o){const{column:i,scrollRef:d,loadMoreSentinelRef:c,hasCursor:h,keyboardAddOpen:u,actionsMenuOpenForIndex:f,nsfwPreference:p,unblurredUris:w,setUnblurred:g,likeOverrides:m,setLikeOverrides:B,openPostModal:v,cardRef:M,onActionsMenuOpenChange:x,onMouseEnter:b,onAddClose:R,constrainMediaHeight:L=!1,isSelected:A}=o,C=n.useRef(null),[I,y]=n.useState(0),F=n.useRef(0),S=n.useRef(!1);n.useLayoutEffect(()=>{const e=d.current,t=C.current;if(!e||!t)return;const o=()=>{const e=d.current,t=C.current;if(!e||!t)return;const o=e.getBoundingClientRect(),n=t.getBoundingClientRect();y(n.top-o.top+e.scrollTop)};o();const n=new ResizeObserver(o);return n.observe(t),()=>n.disconnect()},[d,i.length]),n.useEffect(()=>{const e=d.current;if(!e)return;const t=()=>{F.current=e.scrollTop};return e.addEventListener("scroll",t,{passive:!0}),()=>e.removeEventListener("scroll",t)},[d]);const k=r({count:i.length,getScrollElement:()=>d.current,estimateSize:e=>_(i[e].item),overscan:8,scrollMargin:I,gap:6,scrollToFn:(e,t)=>{const o=d.current;o&&(S.current||(t?o.scrollTo({top:e,behavior:"smooth"}):o.scrollTop=e))}});n.useEffect(()=>{const e=d.current;if(!e)return;const t=F.current,o=e.scrollTop;Math.abs(o-t)>5&&(S.current=!0,e.scrollTop=t,requestAnimationFrame(()=>{S.current=!1}))},[i.length,k.getTotalSize(),d]);const j=k.getVirtualItems(),T=k.getTotalSize();return 0===i.length?e.jsx("div",{ref:C,className:a.gridColumn,children:h&&c&&e.jsx("div",{ref:c,className:a.loadMoreSentinel,"aria-hidden":!0})}):e.jsxs("div",{ref:C,className:a.gridColumn,children:[e.jsx("div",{style:{height:`${T}px`,width:"100%",position:"relative"},children:j.map(o=>{const{item:n,originalIndex:r}=i[o.index];return e.jsx("div",{"data-index":o.index,ref:k.measureElement,className:a.gridItem,"data-post-uri":n.post.uri,"data-selected":A(r)||void 0,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${o.start-I}px)`},onMouseEnter:()=>b(r),children:e.jsx(l,{item:n,isSelected:A(r),cardRef:M(r),openAddDropdown:A(r)&&u,onAddClose:R,onPostClick:(e,t)=>{t?.initialItem&&s(e,t.initialItem),v(e,t?.openReply)},constrainMediaHeight:L,nsfwBlurred:"blurred"===p&&t(n.post)&&!w.has(n.post.uri),onNsfwUnblur:()=>g(n.post.uri,!0),likedUriOverride:m[n.post.uri],onLikedChange:(e,t)=>B(o=>({...o,[e]:t??null})),onActionsMenuOpenChange:e=>x(r,e),cardIndex:r,actionsMenuOpenForIndex:f})},n.post.uri)})}),h&&c&&e.jsx("div",{ref:c,className:a.loadMoreSentinel,"aria-hidden":!0})]})}function u(t){const{scrollRef:o}=t;return o?e.jsx(h,{...t,scrollRef:o}):e.jsx(c,{...t})}export{u as V,a as p};
