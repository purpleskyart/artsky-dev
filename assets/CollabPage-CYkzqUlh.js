import{g as e,b as t,z as r,j as a}from"./index-B6Oq1pSb.js";import{b as n}from"./react-vendor-DGaPsC2e.js";import{L as i}from"./Layout-DN75vOWm.js";import{s as l}from"./ForumPage.module-DLn4V-d3.js";import"./atproto-3-1TCh3S.js";import"./Icons-Cxp2k-Gy.js";import"./PostText-CvbwNCN2.js";const o="app.artsky.collab.project";async function s(a,n){const i=e()?t:r;try{const e=await i.com.atproto.repo.listRecords({repo:a,collection:o,limit:n?.limit??30,cursor:n?.cursor});return{projects:(e.data.records??[]).map(e=>({...e.value,uri:e.uri})),cursor:e.data.cursor}}catch{return{projects:[],cursor:void 0}}}const d=[{value:"blender",label:"Blender",icon:"ðŸŽ¨"},{value:"godot",label:"Godot",icon:"ðŸŽ®"},{value:"general",label:"General",icon:"ðŸ“"}];function c(){const[r,i]=n.useState([]),[c,m]=n.useState(!0),[p,g]=n.useState(!1),[u,v]=n.useState(""),[x,h]=n.useState({name:"",description:"",type:"general",tags:"",version:"0.1.0",externalUrl:"",magnetLink:"",previewUrl:""}),y=e(),j=n.useCallback(async()=>{if(y?.did)try{const e=await s(y.did);i(e.projects)}catch{i([])}finally{m(!1)}else m(!1)},[y?.did]);n.useEffect(()=>{j()},[j]);const f=r.filter(e=>!u||e.type===u);return a.jsxs("div",{className:l.wrap,children:[a.jsxs("header",{className:l.header,children:[a.jsx("h2",{className:l.title,children:"Collaboration"}),a.jsx("p",{className:l.subtitle,children:"Blender, Godot, and general projects. Metadata on PDS, files stored externally."}),y?.did&&a.jsx("button",{type:"button",className:l.tab,style:{marginTop:"0.75rem"},onClick:()=>g(!p),children:"+ New Project"})]}),p&&y?.did&&a.jsxs("div",{style:{padding:"1rem",marginBottom:"1rem",background:"var(--surface)",borderRadius:"0.5rem",border:"1px solid var(--border)"},children:[a.jsx("h3",{style:{marginBottom:"0.75rem"},children:"Create Project"}),a.jsxs("form",{onSubmit:async function(r){if(r.preventDefault(),x.name.trim()&&y?.did)try{await async function(r){const a=e();if(!a?.did)throw new Error("Not logged in");const n=`proj-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,i=await t.com.atproto.repo.putRecord({repo:a.did,collection:o,rkey:n,record:{$type:o,name:r.name.trim(),description:r.description.trim(),type:r.type,tags:r.tags??[],version:r.version??"0.1.0",externalUrl:r.externalUrl,magnetLink:r.magnetLink,previewUrl:r.previewUrl,owner:a.did,createdAt:(new Date).toISOString()},validate:!1});return{uri:i.data.uri,cid:i.data.cid}}({name:x.name,description:x.description,type:x.type,tags:x.tags.split(",").map(e=>e.trim()).filter(Boolean),version:x.version,externalUrl:x.externalUrl||void 0,magnetLink:x.magnetLink||void 0,previewUrl:x.previewUrl||void 0}),g(!1),h({name:"",description:"",type:"general",tags:"",version:"0.1.0",externalUrl:"",magnetLink:"",previewUrl:""});const r=await s(y.did);i(r.projects)}catch(a){alert(a instanceof Error?a.message:"Create failed")}},children:[a.jsx("input",{type:"text",placeholder:"Project name",value:x.name,onChange:e=>h(t=>({...t,name:e.target.value})),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsx("textarea",{placeholder:"Description",value:x.description,onChange:e=>h(t=>({...t,description:e.target.value})),style:{width:"100%",minHeight:"80px",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[a.jsx("select",{value:x.type,onChange:e=>h(t=>({...t,type:e.target.value})),style:{flex:1,padding:"0.5rem"},children:d.map(e=>a.jsxs("option",{value:e.value,children:[e.icon," ",e.label]},e.value))}),a.jsx("input",{type:"text",placeholder:"Version",value:x.version,onChange:e=>h(t=>({...t,version:e.target.value})),style:{width:"100px",padding:"0.5rem"}})]}),a.jsx("input",{type:"text",placeholder:"Tags (comma-separated)",value:x.tags,onChange:e=>h(t=>({...t,tags:e.target.value})),style:{width:"100%",marginBottom:"0.5rem",padding:"0.5rem"}}),a.jsx("p",{style:{fontSize:"0.85rem",color:"var(--muted)",marginBottom:"0.25rem"},children:"External storage (optional):"}),a.jsx("input",{type:"url",placeholder:"Git LFS / Cloud URL",value:x.externalUrl,onChange:e=>h(t=>({...t,externalUrl:e.target.value})),style:{width:"100%",marginBottom:"0.25rem",padding:"0.5rem"}}),a.jsx("input",{type:"text",placeholder:"Torrent magnet link",value:x.magnetLink,onChange:e=>h(t=>({...t,magnetLink:e.target.value})),style:{width:"100%",marginBottom:"0.25rem",padding:"0.5rem"}}),a.jsx("input",{type:"url",placeholder:"Preview URL",value:x.previewUrl,onChange:e=>h(t=>({...t,previewUrl:e.target.value})),style:{width:"100%",marginBottom:"0.75rem",padding:"0.5rem"}}),a.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[a.jsx("button",{type:"submit",className:l.tabActive,children:"Create"}),a.jsx("button",{type:"button",className:l.tab,onClick:()=>g(!1),children:"Cancel"})]})]})]}),a.jsxs("div",{className:l.tabs,style:{marginBottom:"0.75rem"},children:[a.jsx("button",{type:"button",className:u?l.tab:l.tabActive,onClick:()=>v(""),children:"All"}),d.map(e=>a.jsxs("button",{type:"button",className:u===e.value?l.tabActive:l.tab,onClick:()=>v(e.value),children:[e.icon," ",e.label]},e.value))]}),y?c?a.jsx("div",{className:l.loading,children:"Loading projectsâ€¦"}):0===f.length?a.jsx("div",{className:l.empty,children:"No projects yet. Create one to start collaborating!"}):a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"1rem"},children:f.map(e=>{const t=d.find(t=>t.value===e.type);return a.jsxs("div",{style:{padding:"1rem",background:"var(--surface)",borderRadius:"0.5rem",border:"1px solid var(--border)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[a.jsx("span",{style:{fontSize:"1.25rem"},children:t?.icon??"ðŸ“"}),a.jsx("h3",{style:{fontSize:"1rem",fontWeight:700,margin:0},children:e.name}),a.jsx("span",{className:l.commentBadge,style:{marginLeft:"auto"},children:e.version})]}),a.jsx("p",{style:{fontSize:"0.9rem",color:"var(--muted)",marginBottom:"0.75rem"},children:e.description?.slice(0,120)||"No description"}),e.tags&&e.tags.length>0&&a.jsx("div",{style:{display:"flex",gap:"0.25rem",flexWrap:"wrap",marginBottom:"0.5rem"},children:e.tags.map(e=>a.jsxs("span",{className:l.commentBadge,style:{fontSize:"0.75rem"},children:["#",e]},e))}),a.jsxs("div",{style:{display:"flex",gap:"0.5rem",fontSize:"0.85rem"},children:[e.externalUrl&&a.jsx("a",{href:e.externalUrl,target:"_blank",rel:"noopener noreferrer",className:l.standardLink,children:"Files"}),e.magnetLink&&a.jsx("span",{style:{color:"var(--muted)"},children:"Torrent"}),e.previewUrl&&a.jsx("a",{href:e.previewUrl,target:"_blank",rel:"noopener noreferrer",className:l.standardLink,children:"Preview"})]})]},e.uri)})}):a.jsx("div",{className:l.empty,children:"Log in to create and view projects."})]})}function m(){return a.jsx(i,{title:"Collaboration",showNav:!0,children:a.jsx(c,{})})}export{c as CollabContent,m as default};
