import{ai as e,g as t,b as n,y as o,E as r,az as s,aA as i,aB as a,j as l}from"./index-BoghgObz.js";import{b as c,h as u}from"./react-vendor-DGaPsC2e.js";function d(e,t){const n=e.toLocaleDateString(void 0,{month:"short"}).slice(0,3),o=String(e.getDate()).padStart(2,"0");if(!t)return`${n} ${o}`;return`${n} ${o} ${String(e.getFullYear()%100).padStart(2,"0")}`}function p(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;return n<60?"now":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:n<2592e3?`${Math.floor(n/86400)}d`:d(t,!(n<31536e3))}function h(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;if(n<60)return{kind:"relative",text:"now"};if(n<3600)return{kind:"relative",text:`${Math.floor(n/60)}m`};if(n<86400)return{kind:"relative",text:`${Math.floor(n/3600)}h`};if(n<2592e3)return{kind:"relative",text:`${Math.floor(n/86400)}d`};const o=t.toLocaleDateString(void 0,{month:"short"}).slice(0,3),r=String(t.getDate()).padStart(2,"0");if(n<31536e3)return{kind:"date",month:o,day:r};return{kind:"date",month:o,day:r,year:String(t.getFullYear()%100).padStart(2,"0")}}function m(e){const t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3;if(n<60)return"Just now";if(n<3600){const e=Math.floor(n/60);return`${e} minute${1===e?"":"s"} ago`}if(n<86400){const e=Math.floor(n/3600);return`${e} hour${1===e?"":"s"} ago`}if(n<2592e3){const e=Math.floor(n/86400);return`${e} day${1===e?"":"s"} ago`}return d(t,!(n<31536e3))}function f(e){return new Date(e).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})}function x(e){const t=new Date(e);return`${t.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}, ${t.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})}`}async function k(){const{default:t}=await e(async()=>{const{default:e}=await import("./video-DCuzn9dR.js");return{default:e}},[]);return t}const j="_wrap_qker0_1",y="_wrapCompact_qker0_8",g="_trigger_qker0_8",v="_dropdown_qker0_44",b="_dropdownFixed_qker0_62",w="_dropdownCompact_qker0_68",C="_item_qker0_73",_="_feedLabel_qker0_78",N="_postedAt_qker0_84",D="_feedbackSuccess_qker0_92",L="_feedbackError_qker0_100",$="_reportReasonLabel_qker0_108",S="_itemIcon_qker0_138",M=18;function P(){return l.jsx("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:l.jsx("path",{d:"M12 5v14m0 0l-4-4m4 4l4-4"})})}function T(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),l.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"})]})}function B(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),l.jsx("polyline",{points:"16 6 12 2 8 6"}),l.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"15"})]})}function E(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H3c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"}),l.jsx("path",{d:"M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-5c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2z"})]})}function q(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),l.jsx("polyline",{points:"12 19 5 12 12 5"})]})}function A(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]})}function R(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M18 6L6 18M6 6l12 12"}),l.jsx("circle",{cx:"12",cy:"12",r:"10"})]})}function V(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),l.jsx("line",{x1:"4",y1:"22",x2:"4",y2:"15"})]})}function W(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),l.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),l.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]})}function F(){return l.jsxs("svg",{width:M,height:M,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("polyline",{points:"3 6 5 6 21 6"}),l.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),l.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),l.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})}const H=c.memo(function({postUri:e,postCid:d,authorDid:p,rootUri:h,isOwnPost:x,onHidden:k,className:M,compact:H,feedLabel:U,postedAt:O,open:I,onOpenChange:z,verticalIcon:Q,onDownload:Y,downloadLabel:J,downloadLoading:G,dropdownRef:K,onViewQuotes:X}){const Z=t(),[ee,te]=c.useState(!1),[ne,oe]=c.useState(null),[re,se]=c.useState(null),[ie,ae]=c.useState("main"),[le,ce]=c.useState("idle"),[ue,de]=c.useState(null),[pe,he]=c.useState(null),me=c.useRef(null),fe=c.useRef(null),xe=c.useRef(null),ke=c.useRef(null),[je,ye]=c.useState(null),ge=void 0!==I&&void 0!==z,ve=ge?I:ee;function be(e){ge?z?.(e):te(e)}function we(){if(!ke.current)return null;const e=ke.current.getBoundingClientRect(),t=window.innerWidth-e.right,n=e.left,o=e.right<208;return{bottom:window.innerHeight-e.top,right:t,left:n,flipH:o}}c.useEffect(()=>{ve||(ke.current?.blur(),ae("main"),ce("idle"),se(null),me.current&&(clearTimeout(me.current),me.current=null))},[ve]),c.useEffect(()=>{if(!ve||!Z?.did||x)return;let e=!1;return n.getProfile({actor:p}).then(t=>{if(e)return;const n=t.data;de(n.viewer?.blocking??null),he(n.handle??null)}).catch(()=>{e||(de(null),he(null))}),()=>{e=!0}},[ve,Z?.did,x,p]),c.useLayoutEffect(()=>{ve&&ke.current?ye(we()):ye(null)},[ve]),c.useEffect(()=>{if(!ve)return;const e=()=>ye(e=>e?we()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[ve]),c.useEffect(()=>{if(!ve)return;const e=e=>{const t=e.target;fe.current?.contains(t)||xe.current?.contains(t)||be(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ve]),c.useEffect(()=>{if(!ve)return;const e=xe.current;if(e){const t=e.querySelectorAll('button[role="menuitem"]')[0];t&&t.focus()}},[ve]),c.useEffect(()=>{if(!ve)return;const e=e=>{const t=e.key.toLowerCase();if("escape"===t||"q"===t)return e.preventDefault(),void("confirm"===le?ce("idle"):(be(!1),ke.current?.focus()));if("w"===t||"s"===t||"e"===t||"enter"===t||"ArrowUp"===e.key||"ArrowDown"===e.key){const n=xe.current;if(!n)return;const o=Array.from(n.querySelectorAll('button[role="menuitem"]'));if(0===o.length)return;const r=document.activeElement,s=r&&o.includes(r)?o.indexOf(r):-1;if("e"===t||"enter"===t)return e.preventDefault(),void(s>=0&&!o[s].disabled&&o[s].click());if("w"===t||"ArrowUp"===e.key){e.preventDefault();return void o[s<=0?o.length-1:s-1].focus()}if("s"===t||"ArrowDown"===e.key){e.preventDefault();return void o[s<0||s>=o.length-1?0:s+1].focus()}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ve,le]);const Ce=c.useCallback(e=>{se({type:"success",message:e}),me.current&&clearTimeout(me.current),me.current=setTimeout(()=>{me.current=null,be(!1),se(null)},1800)},[]),_e=c.useCallback(e=>{se({type:"error",message:e})},[]),Ne=c.useCallback(async()=>{if(Z?.did&&!x){oe("block"),se(null);try{const{uri:e}=await o(p);de(e),ce("idle"),Ce("Account blocked")}catch{_e("Could not block. Try again.")}finally{oe(null)}}},[Z?.did,x,p,Ce,_e]),De=c.useCallback(async()=>{if(ue){oe("unblock"),se(null);try{await r(ue),de(null),Ce("Account unblocked")}catch{_e("Could not unblock. Try again.")}finally{oe(null)}}},[ue,Ce,_e]),Le=c.useCallback(async t=>{if(Z?.did){oe("report"),se(null);try{await s(e,d,t),Ce("Report sent to Bluesky")}catch{_e("Could not send report. Try again.")}finally{oe(null)}}},[Z?.did,e,d,Ce,_e]),$e=c.useCallback(async()=>{if(Z?.did){oe("mute"),se(null);try{await i(h),Ce("Thread muted")}catch{_e("Could not mute thread. Try again.")}finally{oe(null)}}},[Z?.did,h,Ce,_e]),Se=c.useCallback(()=>{const t=`${"undefined"!=typeof window?window.location.origin+"/artsky-dev/".replace(/\/$/,""):""}/post/${encodeURIComponent(e)}`;navigator.clipboard.writeText(t).then(()=>Ce("Link copied"),()=>_e("Could not copy link"))},[e,Ce,_e]),Me="undefined"!=typeof navigator&&!!navigator.share,Pe=c.useCallback(()=>{const t=`${"undefined"!=typeof window?window.location.origin+"/artsky-dev/".replace(/\/$/,""):""}/post/${encodeURIComponent(e)}`;navigator.share({url:t}).then(()=>be(!1),()=>{})},[e]),Te=c.useCallback(async()=>{if(Z?.did&&x){oe("delete");try{await a(e),be(!1),k?.()}catch{}finally{oe(null)}}},[Z?.did,x,e,k]),Be=!!Z?.did;return l.jsxs("div",{ref:fe,className:`${j} ${H?y:""} ${M??""}`,children:[l.jsx("button",{ref:ke,type:"button",className:g,onClick:e=>{e.preventDefault(),e.stopPropagation(),!ve&&ke.current&&ye(we()),be(!ve)},"aria-expanded":ve,"aria-haspopup":"true","aria-label":"More options",title:"More options",children:Q?l.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[l.jsx("circle",{cx:"12",cy:"4",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"12",cy:"20",r:"2",fill:"currentColor"})]}):l.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[l.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"}),l.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"currentColor"})]})}),ve&&je&&u.createPortal(l.jsxs("div",{ref:e=>{xe.current=e,K&&(K.current=e)},className:`${v} ${b} ${H?w:""}`,style:{position:"fixed",bottom:je.bottom,...je.flipH?{left:je.left}:{right:je.right}},role:"menu",children:[U?l.jsxs("div",{className:_,role:"presentation",children:["From: ",U]}):null,O?l.jsxs("div",{className:N,role:"presentation",title:f(O),children:["Posted ",m(O)]}):null,re?l.jsx("div",{className:"success"===re.type?D:L,role:"status",children:re.message}):Be?"confirm"===le?l.jsxs(l.Fragment,{children:[l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ce("idle")},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(q,{})}),"Back"]}),l.jsxs("div",{className:$,children:["Block ",pe?`@${pe}`:"this user","?"]}),l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Ne()},disabled:"block"===ne,role:"menuitem",children:[l.jsx("span",{className:S,children:"block"===ne?"…":l.jsx(A,{})}),"block"===ne?"":"Yes, block"]})]}):"reason"===ie?l.jsxs(l.Fragment,{children:[l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("main")},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(q,{})}),"Back"]}),l.jsx("div",{className:$,children:"Report to Bluesky"}),[{label:"Spam",reasonType:"com.atproto.moderation.defs#reasonSpam"},{label:"Harassment",reasonType:"com.atproto.moderation.defs#reasonViolation"},{label:"Misleading",reasonType:"com.atproto.moderation.defs#reasonMisleading"},{label:"Other",reasonType:"com.atproto.moderation.defs#reasonOther"}].map(({label:e,reasonType:t})=>l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Le(t)},disabled:"report"===ne,role:"menuitem",children:[l.jsx("span",{className:S,children:"report"===ne?"…":l.jsx(V,{})}),"report"===ne?"":e]},t))]}):l.jsxs(l.Fragment,{children:[x&&l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Te()},disabled:"delete"===ne,role:"menuitem",children:[l.jsx("span",{className:S,children:"delete"===ne?"…":l.jsx(F,{})}),"delete"===ne?"":"Delete post"]}),!x&&(ue?l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),De()},disabled:"unblock"===ne,role:"menuitem",children:[l.jsx("span",{className:S,children:"unblock"===ne?"…":l.jsx(R,{})}),"unblock"===ne?"":"Unblock account"]}):l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ce("confirm")},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(A,{})}),"Block user"]})),l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),ae("reason")},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(V,{})}),"Report post"]}),l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),$e()},disabled:"mute"===ne,role:"menuitem",children:[l.jsx("span",{className:S,children:"mute"===ne?"…":l.jsx(W,{})}),"mute"===ne?"":"Mute thread"]}),Y&&J&&l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Y()},disabled:G,role:"menuitem",children:[l.jsx("span",{className:S,children:G?"…":l.jsx(P,{})}),G?"":J]}),X&&l.jsxs("button",{type:"button",className:C,onClick:t=>{t.preventDefault(),t.stopPropagation(),X(e),be(!1)},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(E,{})}),"View Quotes"]}),Me&&l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Pe()},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(B,{})}),"Share post"]}),l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Se()},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(T,{})}),"Copy link to post"]})]}):l.jsxs(l.Fragment,{children:[Y&&J&&l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Y()},disabled:G,role:"menuitem",children:[l.jsx("span",{className:S,children:G?"…":l.jsx(P,{})}),G?"":J]}),X&&l.jsxs("button",{type:"button",className:C,onClick:t=>{t.preventDefault(),t.stopPropagation(),X(e),be(!1)},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(E,{})}),"View Quotes"]}),Me&&l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Pe()},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(B,{})}),"Share post"]}),l.jsxs("button",{type:"button",className:C,onClick:e=>{e.preventDefault(),e.stopPropagation(),Se()},role:"menuitem",children:[l.jsx("span",{className:S,children:l.jsx(T,{})}),"Copy link to post"]})]})]}),document.body)]})});export{H as P,p as a,f as b,x as f,h as g,k as l};
