import{u as e,w as s,aw as o,j as r}from"./index-bfgQOBc4.js";import{r as t}from"./react-vendor-rw3WIpbI.js";import{p as a,V as n}from"./VirtualizedProfileColumn-BgqQgbBy.js";import{A as i}from"./AppModal-Dx0fpUjX.js";import{u as l}from"./ModalScrollContext-rbkDmTth.js";import"./atproto-JNpM3I1p.js";import"./virtual-SmD9oKU4.js";import"./PostCard-B4f41JDL.js";import"./PostActionsMenu-GtN3G4Kh.js";import"./date-Ct-NsrQr.js";import"./artboards-DNvSVVrd.js";import"./artboardsPds-DWUixJ9h.js";import"./PostText-BWWXdTCb.js";import"./postCache-CTqU0alO.js";import"./ModalTopBarSlotContext-BCMHq62N.js";import"./usePullToRefresh-QiYvLiof.js";const d="_wrap_16j0m_1",c="_error_16j0m_6",u="_loading_16j0m_13",m="_empty_16j0m_14",p="_loadingMore_16j0m_39";function j({postUri:j,onClose:f,onBack:h,canGoBack:x}){const{openPostModal:v}=e(),{nsfwPreference:g,unblurredUris:_,setUnblurred:M}=s(),[C,b]=t.useState([]),[P,S]=t.useState(),[k,w]=t.useState(!0),[y,N]=t.useState(!1),[A,B]=t.useState(null),[I,O]=t.useState(null),[R,E]=t.useState({}),U=t.useRef(null),q=l(),F=t.useCallback(async e=>{try{e?N(!0):w(!0),B(null);const{posts:s,cursor:r}=await o(j,{limit:30,cursor:e}),t=s.map(e=>({post:e}));b(s=>e?[...s,...t]:t),S(r)}catch(s){B(s instanceof Error?s.message:"Failed to load quotes")}finally{w(!1),N(!1)}},[j]);return t.useEffect(()=>{b([]),S(void 0),F()},[j,F]),t.useEffect(()=>{O(()=>()=>F())},[F]),t.useEffect(()=>{if(!P||y)return;const e=U.current;if(!e)return;const s=e.closest("[data-modal-scroll]")??void 0,o=new IntersectionObserver(e=>{e[0]?.isIntersecting&&F(P)},{root:s,rootMargin:"200px",threshold:0});return o.observe(e),()=>o.disconnect()},[P,y,F]),r.jsx(i,{ariaLabel:"Posts that quote this post",onClose:f,onBack:h,canGoBack:x,onPullToRefresh:I?()=>I():void 0,children:r.jsxs("div",{className:d,children:[A&&r.jsx("p",{className:c,children:A}),k?r.jsx("div",{className:u,children:"Loading…"}):0===C.length?r.jsx("div",{className:m,children:"No one has quoted this post yet."}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`${a.gridColumns} ${a.gridView1}`,children:r.jsx(n,{column:C.map((e,s)=>({item:e,originalIndex:s})),colIndex:0,scrollMargin:0,scrollRef:q,loadMoreSentinelRef:P?e=>{U.current=e}:void 0,hasCursor:!!P,keyboardFocusIndex:0,keyboardAddOpen:!1,actionsMenuOpenForIndex:null,nsfwPreference:g,unblurredUris:_,setUnblurred:M,likeOverrides:R,setLikeOverrides:E,openPostModal:v,cardRef:()=>()=>{},onActionsMenuOpenChange:()=>{},onMouseEnter:()=>{},onAddClose:()=>{},constrainMediaHeight:!0,isSelected:()=>!1})}),y&&r.jsx("div",{className:p,children:"Loading more…"})]})]})})}export{j as default};
