import{j as e,k as t,h as r,ad as n,v as a,w as i,u as o,S as s,a7 as d,f as l,b as c,ax as u}from"./index-DlaOPLEe.js";import{b as p,d as m,h as v}from"./react-vendor-DGaPsC2e.js";import{l as h,P as _}from"./PostActionsMenu-BMm0Jr67.js";import{f,g,c as x,a as w,b as k,i as y}from"./artboards-DNvSVVrd.js";import{p as b}from"./artboardsPds-DWUixJ9h.js";import{g as R,b as j}from"./date-Ct-NsrQr.js";import{P as z,a as C}from"./PostText-081Ccbc7.js";let L=null;function T(e,t){if(!e||!e.startsWith("http"))return e??"";if(!function(){if(null!==L)return L;if("undefined"==typeof document)return L=!1,L;const e=document.createElement("canvas");return L=!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),L}())return e;return`https://wsrv.nl/?url=${encodeURIComponent(e)}&output=webp`}const N="_progressiveImage_8ku7v_1",A="_placeholder_8ku7v_8",P="_fullImage_8ku7v_21",$="_loaded_8ku7v_30",M="_error_8ku7v_38",I="_errorPlaceholder_8ku7v_46",E="_errorText_8ku7v_60";function S({src:t,alt:r,aspectRatio:n,loading:a="lazy",className:i="",onLoad:o,sizes:s=[320,640,960,1280,1920],sizesAttr:d,maxRetries:l=3,preloadDistance:c=1500}){const[u,m]=p.useState(!1),[v,h]=p.useState(!1),[_,f]=p.useState(0),[g,x]=p.useState(!1),[w,k]=p.useState(!1),[y,b]=p.useState("eager"===a),R=p.useRef(null),j=p.useRef(null),z=p.useRef(null),C=p.useRef(null),L=p.useRef(null),S=p.useMemo(()=>T(t),[t]),O=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return s.map(e=>`${T(t.includes("?")?`${t}&width=${e}`:`${t}?width=${e}`)} ${e}w`).join(", ")},[t,s]),W=p.useMemo(()=>"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",[]),B=d||W,D=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return t.replace(/\/img\/[^/]+\//,"/img/avatar_thumbnail/")},[t]),F=p.useCallback(e=>{j.current&&(clearTimeout(j.current),j.current=null),m(!0),h(!1),x(!1),f(0),o?.(e)},[o]),G=p.useCallback(()=>{k(!0)},[]),H=p.useCallback(()=>{if(v||S===t)if(_<l){const e=1e3*Math.pow(2,_);R.current=setTimeout(()=>{f(e=>e+1),h(!1)},e)}else x(!0);else h(!0)},[v,S,t,_,l]);p.useEffect(()=>()=>{R.current&&clearTimeout(R.current),j.current&&clearTimeout(j.current),L.current&&L.current.disconnect()},[]),p.useEffect(()=>{if("eager"===a||u)return void b(!0);const e=z.current;return e?(L.current=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting&&(b(!0),L.current&&L.current.disconnect())},{rootMargin:`${c}px 0px ${c}px 0px`,threshold:0}),L.current.observe(e),()=>{L.current&&L.current.disconnect()}):void 0},[a,c,u]),p.useEffect(()=>{f(0),x(!1),m(!1),h(!1),k(!1),b("eager"===a)},[t,a]);const U=v?t:S;return p.useEffect(()=>{if(!y||u||g)return;const e=requestAnimationFrame(()=>(()=>{const e=C.current;e?.complete&&e.naturalWidth>0&&(j.current&&(clearTimeout(j.current),j.current=null),m(!0))})());return j.current=setTimeout(()=>{j.current=null,u||m(!0)},12e3),()=>{cancelAnimationFrame(e),j.current&&(clearTimeout(j.current),j.current=null)}},[y,U,_,u,g]),g?e.jsx("div",{className:`${N} ${M} ${i}`,style:{aspectRatio:n?String(n):void 0},role:"img","aria-label":`Failed to load: ${r}`,children:e.jsxs("div",{className:I,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:E,children:"Image failed to load"})]})}):e.jsxs("div",{ref:z,className:`${N} ${u?$:""} ${i}`,style:{aspectRatio:n?String(n):void 0},children:[D&&!u&&!w&&e.jsx("img",{src:D,alt:"",className:A,"aria-hidden":"true",onError:G}),e.jsx("img",{ref:C,src:U,srcSet:O,sizes:O?B:void 0,alt:r,loading:y?"eager":"lazy",onLoad:F,onError:H,className:P},`${U}-${_}`)]})}const O={card:"_card_1g5zv_2",cardLink:"_cardLink_1g5zv_21",cardSelected:"_cardSelected_1g5zv_43",cardLiked:"_cardLiked_1g5zv_73",cardInArtboard:"_cardInArtboard_1g5zv_81",cardTransFlag:"_cardTransFlag_1g5zv_89",mediaWrap:"_mediaWrap_1g5zv_134",nsfwOverlay:"_nsfwOverlay_1g5zv_135",cardArtOnly:"_cardArtOnly_1g5zv_138",textOnlyPreview:"_textOnlyPreview_1g5zv_142",cardSeen:"_cardSeen_1g5zv_147",meta:"_meta_1g5zv_147",handleBlock:"_handleBlock_1g5zv_148",cardActionRow:"_cardActionRow_1g5zv_150",cardFillCell:"_cardFillCell_1g5zv_250",mediaGridCellFocused:"_mediaGridCellFocused_1g5zv_292",addWrap:"_addWrap_1g5zv_308",addWrapOpen:"_addWrapOpen_1g5zv_317",cardActionRowCenter:"_cardActionRowCenter_1g5zv_329",cardLikeRepostBtn:"_cardLikeRepostBtn_1g5zv_353",addToBoardBtn:"_addToBoardBtn_1g5zv_354",cardActionRowAvatarFollow:"_cardActionRowAvatarFollow_1g5zv_357",cardActionRowAvatarPlus:"_cardActionRowAvatarPlus_1g5zv_357",cardActionRowRight:"_cardActionRowRight_1g5zv_371",cardActionRowTime:"_cardActionRowTime_1g5zv_382",postTimeStacked:"_postTimeStacked_1g5zv_389",postTimeMonth:"_postTimeMonth_1g5zv_397",postTimeDayYear:"_postTimeDayYear_1g5zv_404",cardActionRowAvatar:"_cardActionRowAvatar_1g5zv_357",handleRow:"_handleRow_1g5zv_496",authorAvatar:"_authorAvatar_1g5zv_496",authorAvatarPlaceholder:"_authorAvatarPlaceholder_1g5zv_497",handleRowMain:"_handleRowMain_1g5zv_520",handleRowMeta:"_handleRowMeta_1g5zv_523",cardMinimalist:"_cardMinimalist_1g5zv_561",cardLikeRepostBtnActive:"_cardLikeRepostBtnActive_1g5zv_622",addToBoardBtnInCollection:"_addToBoardBtnInCollection_1g5zv_669",collectIcon:"_collectIcon_1g5zv_673",addDropdown:"_addDropdown_1g5zv_686",addDropdownFixed:"_addDropdownFixed_1g5zv_710",addBoardLabel:"_addBoardLabel_1g5zv_716",addBoardCheckbox:"_addBoardCheckbox_1g5zv_730",addBoardText:"_addBoardText_1g5zv_735",addDropdownNew:"_addDropdownNew_1g5zv_741",addBoardInput:"_addBoardInput_1g5zv_747",addDropdownActions:"_addDropdownActions_1g5zv_758",addBoardSubmit:"_addBoardSubmit_1g5zv_764",mediaWrapConstrained:"_mediaWrapConstrained_1g5zv_837",nsfwOverlayText:"_nsfwOverlayText_1g5zv_863",mediaWrapFillCell:"_mediaWrapFillCell_1g5zv_872",mediaWrapMultiStack:"_mediaWrapMultiStack_1g5zv_880",media:"_media_1g5zv_134",textOnlyPreviewText:"_textOnlyPreviewText_1g5zv_917",textOnlyPreviewEmpty:"_textOnlyPreviewEmpty_1g5zv_927",textOnlyPreviewLink:"_textOnlyPreviewLink_1g5zv_932",textOnlyPreviewLinkThumb:"_textOnlyPreviewLinkThumb_1g5zv_952",textOnlyPreviewLinkTitle:"_textOnlyPreviewLinkTitle_1g5zv_959",textOnlyPreviewLinkDesc:"_textOnlyPreviewLinkDesc_1g5zv_968",mediaWrapGridSpacer:"_mediaWrapGridSpacer_1g5zv_1005",mediaWrapGrid:"_mediaWrapGrid_1g5zv_1005",mediaGrid:"_mediaGrid_1g5zv_292",mediaGridCell:"_mediaGridCell_1g5zv_292",mediaGridImg:"_mediaGridImg_1g5zv_1062",mediaVideoWrap:"_mediaVideoWrap_1g5zv_1104",postTime:"_postTime_1g5zv_389",repostIconLink:"_repostIconLink_1g5zv_1233",repostIcon:"_repostIcon_1g5zv_1233",pinIconWrap:"_pinIconWrap_1g5zv_1252",pinIcon:"_pinIcon_1g5zv_1252",handleLinkWrap:"_handleLinkWrap_1g5zv_1270",handleLinkWrapLiked:"_handleLinkWrapLiked_1g5zv_1280",handleLink:"_handleLink_1g5zv_1161",text:"_text_1g5zv_142"};function W(){return e.jsx("svg",{className:O.repostIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})})}function B(){return e.jsx("svg",{className:O.pinIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})})}function D(){return e.jsx("svg",{className:O.collectIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}const F=p.memo(function({item:L,isSelected:T,cardRef:N,addButtonRef:A,openAddDropdown:P,onAddClose:$,onPostClick:M,onAspectRatio:I,fillCell:E,nsfwBlurred:F,onNsfwUnblur:G,constrainMediaHeight:H,likedUriOverride:U,onLikedChange:V,seen:Y,onActionsMenuOpenChange:K,cardIndex:Q,actionsMenuOpenForIndex:X,focusedMediaIndex:q,onMediaRef:J}){const Z=m(),{session:ee}=t(),{openLoginModal:te}=r(),{artOnly:re,minimalist:ne}=n(),{mediaMode:ae}=a(),{unblurredUris:ie,setUnblurred:oe}=i(),{openQuotesModal:se,isModalOpen:de}=o(),le=p.useRef(null),ce=p.useRef(null),ue=p.useRef(null),{post:pe,reason:me}=L,ve=L._feedSource,he=ve?.label??("timeline"===ve?.kind?"Following":void 0),_e=p.useMemo(()=>s(pe),[pe]),fe=!!_e,ge=pe.record?.text??"",xe=p.useMemo(()=>d(pe),[pe]),we=p.useMemo(()=>l(pe),[pe]),ke=pe.author.handle??pe.author.did,ye=me?.by?me.by.handle??me.by.did:null,be=(()=>{const e=pe?.embed;return!!e&&("app.bsky.embed.record#view"===e.$type||"app.bsky.embed.recordWithMedia#view"===e.$type)})(),Re="app.bsky.feed.defs#reasonPin"===me?.$type,je=pe.author.viewer,ze=je?.following,[Ce,Le]=p.useState(ze??null),Te=!!(Ce??ze??null),Ne=ee?.did===pe.author.did,[Ae,Pe]=p.useState(!1),$e=pe.viewer,Me=$e?.like,[Ie,Ee]=p.useState(Me),[Se,Oe]=p.useState(!1),We=void 0!==U?U??void 0:Ie,Be=!!We,De=f(pe.uri),Fe=Be&&De,[Ge,He]=p.useState(()=>fe&&null!=_e?.aspectRatio?_e.aspectRatio:null),[Ue,Ve]=p.useState(!1),[Ye,Ke]=p.useState(!1),Qe=p.useRef(null),[Xe,qe]=p.useState(new Set),[Je,Ze]=p.useState(""),et=p.useRef(null),tt=p.useRef(null),rt=p.useRef(null),nt=p.useRef(null),[at,it]=p.useState(null),ot=p.useRef(null),st=p.useRef(T),dt=p.useRef(0),lt=p.useRef(0),ct=p.useRef(!1),ut=p.useRef(!1),pt=p.useRef(!1),mt=p.useRef(null),vt=p.useRef(null);p.useEffect(()=>{null!=Q&&X!==Q&&Ye&&Ke(!1)},[X,Q,Ye]);const ht=p.useRef(null);p.useEffect(()=>{null!=Q&&(X===Q&&ht.current!==Q&&Ke(!0),ht.current=X??null)},[X,Q]),p.useEffect(()=>{if(!Ye)return;const e=e=>!e||!ot.current?.contains(e)&&!Qe.current?.contains(e),t=t=>{e(t.target)&&Ke(!1)},r=t=>{const r=t.target??t.target;e(r)&&Ke(!1)},n=t=>{e(t.target)&&Ke(!1)};return document.addEventListener("focusin",t),document.addEventListener("mousedown",r),document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("mouseover",n),()=>{document.removeEventListener("focusin",t),document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r),document.removeEventListener("mouseover",n)}},[Ye]),p.useEffect(()=>{Ee(void 0!==U?U??void 0:Me)},[pe.uri,Me,U]),p.useEffect(()=>{Le(ze??null)},[pe.uri,ze]);const _t=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),Ae||Ne||!ee?.did||Te)return;Pe(!0);const t=`pending:follow:${pe.author.did}:${Date.now()}`;Le(t);try{const e=await c.follow(pe.author.did);Le(e.uri)}catch{Le(null)}finally{Pe(!1)}},[Ae,Ne,ee?.did,Te,pe.author.did]),ft=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!ee?.did)return void te();if(Se)return;const t=!!We,r=We||void 0;Oe(!0),Ee(t?void 0:"pending");try{if(t)await c.deleteLike(r),Ee(void 0);else{const e=await c.like(pe.uri,pe.cid);Ee(e.uri)}}catch{Ee(r)}finally{Oe(!1)}},[ee?.did,te,Se,We,pe.uri,pe.cid]);p.useEffect(()=>{P&&Ve(!0)},[P]),p.useEffect(()=>()=>{mt.current&&(clearTimeout(mt.current),mt.current=null)},[]);const gt=p.useRef(Ue);p.useEffect(()=>{gt.current&&!Ue&&$?.(),gt.current=Ue},[Ue,$]);const xt=p.useCallback(()=>{if(!et.current)return null;const e=et.current.getBoundingClientRect(),t=window.innerWidth-8-140,r=e.left+e.width/2,n=Math.max(148,Math.min(t,r));return{bottom:window.innerHeight-e.top,left:n}},[]);p.useLayoutEffect(()=>{Ue&&et.current?it(xt()):it(null)},[Ue,xt]),p.useEffect(()=>{if(!Ue)return;const e=()=>it(e=>e?xt()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[Ue,xt]),p.useEffect(()=>{if(Ue)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){const t=e.target;et.current?.contains(t)||tt.current?.contains(t)||nt.current?.contains(t)||Ve(!1)}},[Ue]);const wt=g(),kt=p.useCallback(e=>{qe(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),yt=p.useCallback(async()=>{if(!(Xe.size>0||Je.trim().length>0))return;const e=u(pe),t=we.length>0?we.map(e=>e.url):void 0,r={uri:pe.uri,cid:pe.cid,authorHandle:pe.author.handle,text:pe.record?.text?.slice(0,200),thumb:e?.url??t?.[0],thumbs:t},n=[];if(Je.trim()){const e=x(Je.trim());w(e.id,r),n.push(e.id),Ze("")}if(Xe.forEach(e=>{w(e,r),n.push(e)}),qe(new Set),Ve(!1),ee?.did&&n.length>0)for(const a of n){const e=k(a);if(e)try{await b(c,ee.did,e)}catch{}}},[Xe,Je,pe,we,ee?.did]),bt=fe&&"video"===_e.type&&_e.videoPlaylist,Rt=fe&&"image"===_e.type&&(_e.imageCount??0)>1,jt=p.useMemo(()=>we.filter(e=>"image"===e.type),[we]),zt=p.useMemo(()=>we.map((e,t)=>"image"===e.type?t:-1).filter(e=>e>=0),[we]),Ct=Rt&&jt.length?jt[0]?.url:_e?.url??"",Lt=p.useCallback(e=>{const t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&He(e=>null!=e?e:t.naturalWidth/t.naturalHeight)},[Rt]);p.useEffect(()=>{fe&&(null!=_e?.aspectRatio?He(e=>e??_e.aspectRatio):bt||He(e=>e??null))},[fe,_e?.aspectRatio,_e?.videoPlaylist,bt]),p.useEffect(()=>{He(fe&&null!=_e?.aspectRatio?_e.aspectRatio:null)},[pe.uri]),p.useEffect(()=>{null!=Ge&&I&&I(Ge)},[Ge,I]),p.useEffect(()=>{if(!bt||!_e?.videoPlaylist||!le.current)return;const e=le.current,t=_e.videoPlaylist;let r;var n;return/\.m3u8(\?|$)/i.test(n=t)||n.includes("m3u8")?h().then(n=>{if(le.current)if(n.isSupported()){const a=new n;ue.current=a,a.loadSource(t),a.attachMedia(e),a.on(n.Events.ERROR,()=>{}),r=()=>{a.destroy(),ue.current=null}}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t,r=()=>{e.removeAttribute("src")})}).catch(()=>{e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}):(e.src=t,r=()=>{e.removeAttribute("src")}),()=>{r?.()}},[bt,_e?.videoPlaylist]);const Tt=p.useRef(de);Tt.current=de,p.useEffect(()=>{if(!bt||!ce.current||!le.current)return;const e=ce.current,t=le.current;de&&t.pause();const r=new IntersectionObserver(e=>{const r=e[0];r&&t&&(Tt.current?t.pause():r.isIntersecting?t.play().catch(()=>{}):t.pause())},{threshold:.25,rootMargin:"0px"});return r.observe(e),()=>r.disconnect()},[bt,de]),p.useEffect(()=>{const e=st.current;st.current=T,T&&F&&G&&G(),e&&!T&&ie.has(pe.uri)&&oe(pe.uri,!1)},[T,pe.uri,ie,oe,F,G]),p.useEffect(()=>{const e=ot.current;if(!e||!ie.has(pe.uri))return;const t=t=>{const r=t.relatedTarget;null!=r&&e.contains(r)||oe(pe.uri,!1)};return e.addEventListener("focusout",t),()=>e.removeEventListener("focusout",t)},[pe.uri,ie,oe]),p.useEffect(()=>{if(!fe||!ie.has(pe.uri)||!ce.current)return;const e=ce.current,t=new IntersectionObserver(e=>{const t=e[0];!t||t.intersectionRatio>0||oe(pe.uri,!1)},{threshold:0,rootMargin:"0px"});return t.observe(e),()=>t.disconnect()},[fe,pe.uri,ie,oe]);const Nt=p.useCallback(()=>{le.current&&le.current.play().catch(()=>{})},[]),At=p.useCallback(()=>{le.current&&(le.current.pause(),le.current.currentTime=0)},[]),Pt=p.useCallback(e=>{if(ct.current)return ct.current=!1,e.preventDefault(),void e.stopPropagation();ut.current||(M?M(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`))},[ct,ut,M,pe.uri,L,Z]),$t=p.useCallback(()=>{M?M(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`)},[M,pe.uri,L,Z]),Mt=p.useCallback(()=>{ee?.did?We?(Ee(void 0),c.deleteLike(We).then(()=>{V?.(pe.uri,null)}).catch(()=>Ee(We))):(Ee("pending"),c.like(pe.uri,pe.cid).then(e=>{Ee(e.uri),V?.(pe.uri,e.uri)}).catch(()=>Ee(void 0))):te()},[ee?.did,te,We,pe.uri,pe.cid,V]),It=p.useCallback(e=>{if(e.stopPropagation(),pt.current)return;const t=Date.now();t-lt.current<400?(lt.current=0,Mt()):(lt.current=t,setTimeout(()=>$t(),400))},[pt,lt,Mt,$t]),Et=p.useCallback(e=>{ot.current=e,N&&("function"==typeof N?N(e):N.current=e)},[N]);return e.jsx("div",{ref:Et,"data-post-uri":pe.uri,className:`${O.card} ${T?O.cardSelected:""} ${Fe?O.cardTransFlag:""} ${!Fe&&Be?O.cardLiked:""} ${!Fe&&De?O.cardInArtboard:""} ${Y&&!T?O.cardSeen:""} ${E?O.cardFillCell:""} ${re?O.cardArtOnly:""} ${ne?O.cardMinimalist:""}`,children:e.jsxs("div",{role:"button",tabIndex:0,className:O.cardLink,onClick:Pt,onKeyDown:e=>{"Enter"===e.key&&(M?M(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`))},onTouchStart:e=>{ut.current=!0,pt.current=!0;const t=e.touches[0];vt.current=t?{x:t.clientX,y:t.clientY}:null},onTouchEnd:e=>{const t=vt.current;vt.current=null;const r=e.changedTouches[0];if((t&&r?Math.hypot(r.clientX-t.x,r.clientY-t.y):0)>12)return mt.current&&(clearTimeout(mt.current),mt.current=null),ut.current=!1,void(pt.current=!1);const n=Date.now();n-dt.current<400?(dt.current=0,ct.current=!0,mt.current&&(clearTimeout(mt.current),mt.current=null),e.preventDefault(),We?(Ee(void 0),c.deleteLike(We).then(()=>{V?.(pe.uri,null)}).catch(()=>Ee(We))):(Ee("pending"),c.like(pe.uri,pe.cid).then(e=>{Ee(e.uri),V?.(pe.uri,e.uri)}).catch(()=>Ee(void 0))),setTimeout(()=>{ut.current=!1,pt.current=!1},500)):(dt.current=n,mt.current&&clearTimeout(mt.current),mt.current=setTimeout(()=>{mt.current=null,ut.current=!1,pt.current=!1,$t()},400))},children:[e.jsxs("div",{ref:e=>{ce.current=e,!J||"text"!==ae&&(!fe||Rt&&jt.length>1)||J(0,e)},className:`${O.mediaWrap} ${E?O.mediaWrapFillCell:""} ${H?O.mediaWrapConstrained:""} ${Rt&&jt.length>1?O.mediaWrapMultiStack:""}`,style:E||H||Rt&&jt.length>1?void 0:{aspectRatio:fe?null!=Ge?String(Ge):bt?"1":void 0:"1"},onMouseEnter:Nt,onMouseLeave:At,...fe&&{onClick:It},children:[fe&&"text"!==ae?bt?e.jsx("div",{className:O.mediaVideoWrap,children:e.jsx("video",{ref:le,className:O.media,poster:_e.url||void 0,muted:!0,playsInline:!0,loop:!0,preload:"metadata",style:{aspectRatio:null!=Ge?`${Ge}`:void 0},onLoadedMetadata:e=>{const t=e.currentTarget;t.videoWidth&&t.videoHeight&&He(e=>null!=e?e:t.videoWidth/t.videoHeight)}})}):Rt&&jt.length>1?e.jsxs(e.Fragment,{children:[(()=>{const t=1/jt.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return e.jsx("div",{className:O.mediaWrapGridSpacer,style:{aspectRatio:String(t)},"aria-hidden":!0})})(),e.jsx("div",{className:O.mediaWrapGrid,children:e.jsx("div",{className:O.mediaGrid,style:{minHeight:0},children:jt.map((t,r)=>{const n=zt[r]??r,a=q===n;return e.jsx("div",{ref:e=>J?.(n,e),className:`${O.mediaGridCell} ${a?O.mediaGridCellFocused:""}`,style:{flex:1/(t.aspectRatio||1)+" 1 0"},children:e.jsx(S,{src:t.url,alt:"",className:O.mediaGridImg,loading:"lazy",onLoad:0===r?Lt:void 0})},r)})})})]}):e.jsx(e.Fragment,{children:e.jsx(S,{src:Ct,alt:"",className:O.media,loading:"eager",onLoad:Lt})}):e.jsxs("div",{className:O.textOnlyPreview,children:[ge?e.jsx("div",{className:O.textOnlyPreviewText,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(z,{text:ge,facets:pe.record?.facets,maxLength:500,stopPropagation:!0,interactive:!1})}):null,xe?e.jsxs("a",{href:xe.uri,target:"_blank",rel:"noopener noreferrer",className:O.textOnlyPreviewLink,onClick:e=>e.stopPropagation(),children:[xe.thumb?e.jsx(S,{src:xe.thumb,alt:"",className:O.textOnlyPreviewLinkThumb,loading:"lazy"}):null,e.jsx("span",{className:O.textOnlyPreviewLinkTitle,children:xe.title}),xe.description?e.jsx("span",{className:O.textOnlyPreviewLinkDesc,children:xe.description}):null]}):null,ge||xe?null:e.jsx("span",{className:O.textOnlyPreviewEmpty,children:"Text post"})]}),F&&G&&fe&&e.jsx("div",{className:O.nsfwOverlay,onClick:e=>{e.preventDefault(),e.stopPropagation(),G(),$t()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),G(),$t())},role:"button",tabIndex:0,"aria-label":"Reveal sensitive content",children:e.jsx("span",{className:O.nsfwOverlayText,children:"NSFW"})})]}),(!re||ne)&&e.jsxs("div",{className:O.meta,children:[e.jsxs("div",{className:O.cardActionRow,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:O.cardActionRowCenter,children:[e.jsxs("div",{className:`${O.addWrap} ${Ue?O.addWrapOpen:""}`,ref:et,children:[e.jsx("button",{ref:rt,type:"button",className:`${O.addToBoardBtn} ${De?O.addToBoardBtnInCollection:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:e=>{e.preventDefault(),e.stopPropagation(),ee?.did?Ve(e=>!e):te()},"aria-label":"Collect","aria-expanded":Ue,children:e.jsx(D,{})}),Ue&&at&&v.createPortal(e.jsxs("div",{ref:nt,className:`${O.addDropdown} ${O.addDropdownFixed}`,style:{position:"fixed",bottom:at.bottom,left:at.left,transform:"translateX(-50%)",zIndex:1001},children:[0===wt.length?null:e.jsx(e.Fragment,{children:wt.map(t=>{const r=y(t.id,pe.uri),n=Xe.has(t.id);return e.jsxs("label",{className:O.addBoardLabel,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>!r&&kt(t.id),disabled:r,className:O.addBoardCheckbox}),e.jsx("span",{className:O.addBoardText,children:r?e.jsxs(e.Fragment,{children:["✓ ",t.name]}):t.name})]},t.id)})}),e.jsx("div",{className:O.addDropdownNew,children:e.jsx("input",{type:"text",placeholder:"New collection name",value:Je,onChange:e=>Ze(e.target.value),className:O.addBoardInput,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),yt())})}),e.jsx("div",{className:O.addDropdownActions,children:e.jsx("button",{type:"button",className:O.addBoardSubmit,onClick:yt,disabled:0===Xe.size&&!Je.trim(),children:"Add to selected"})})]}),document.body)]}),pe.author.avatar&&(Ne||!ee||Te?e.jsx(C,{handle:ke,className:O.cardActionRowAvatar,onClick:e=>e.stopPropagation(),"aria-label":`View @${ke} profile`,children:e.jsx(S,{src:pe.author.avatar,alt:"",loading:"lazy"})}):e.jsxs("button",{type:"button",className:`${O.cardActionRowAvatar} ${O.cardActionRowAvatarFollow}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:_t,disabled:Ae,"aria-label":`Follow @${ke}`,title:`Follow @${ke}`,children:[e.jsx(S,{src:pe.author.avatar,alt:"",loading:"lazy"}),e.jsx("span",{className:O.cardActionRowAvatarPlus,"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 8 8",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M4 2v4M2 4h4"})})})]})),e.jsx("button",{type:"button",className:`${O.cardLikeRepostBtn} ${Be?O.cardLikeRepostBtnActive:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:ft,disabled:Se,title:Be?"Remove like":"Like","aria-label":Be?"Remove like":"Like",children:Be?"♥":"♡"})]}),e.jsxs("div",{className:O.cardActionRowRight,children:[pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=R(t);return"relative"===r.kind?e.jsx("span",{className:O.cardActionRowTime,title:j(t),"aria-hidden":!0,children:r.text}):e.jsxs("span",{className:`${O.cardActionRowTime} ${O.postTimeStacked}`,title:j(t),"aria-hidden":!0,children:[e.jsx("span",{className:O.postTimeMonth,children:r.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})(),e.jsx(_,{postUri:pe.uri,postCid:pe.cid,authorDid:pe.author.did,rootUri:pe.uri,isOwnPost:Ne,compact:!0,verticalIcon:!0,className:O.cardActionsMenu,open:Ye,onOpenChange:e=>{Ke(e),K?.(e)},dropdownRef:Qe,feedLabel:he,postedAt:pe.record?.createdAt,onViewQuotes:se})]})]}),!ne&&e.jsx("div",{className:O.handleBlock,children:e.jsxs("div",{className:O.handleRow,children:[pe.author.avatar?e.jsx(S,{src:pe.author.avatar,alt:"",className:O.authorAvatar,loading:"lazy"}):pe.author.did?e.jsx("span",{className:O.authorAvatarPlaceholder,"aria-hidden":!0,children:(ke||pe.author.did).slice(0,1).toUpperCase()}):null,e.jsxs("span",{className:O.handleRowMain,children:[e.jsx("span",{className:We?O.handleLinkWrapLiked:O.handleLinkWrap,children:e.jsxs(C,{handle:ke,className:O.handleLink,onClick:e=>e.stopPropagation(),children:["@",ke]})}),(ye||be)&&e.jsx("span",{className:O.repostIconLink,role:"button",tabIndex:0,title:ye?`Reposted by @${ye}`:"Quote post","aria-label":ye?`Reposted by @${ye}`:"Quote post",onClick:e=>{e.stopPropagation(),Pt(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$t())},children:e.jsx(W,{})})]}),e.jsxs("span",{className:O.handleRowMeta,children:[Re&&e.jsx("span",{className:O.pinIconWrap,title:"Pinned",children:e.jsx(B,{})}),pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=R(t);return"relative"===r.kind?e.jsx("span",{className:O.postTime,title:j(t),children:r.text}):e.jsxs("span",{className:`${O.postTime} ${O.postTimeStacked}`,title:j(t),children:[e.jsx("span",{className:O.postTimeMonth,children:r.month}),e.jsxs("span",{className:O.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})()]})]})}),!ne&&fe&&ge?e.jsx("p",{className:O.text,onClick:e=>{e.stopPropagation(),Pt(e)},children:e.jsx(z,{text:ge,facets:pe.record?.facets,maxLength:80,stopPropagation:!0,interactive:!1})}):null]})]})})},(e,t)=>{if(e.item.post.uri!==t.item.post.uri)return!1;if(e.isSelected!==t.isSelected)return!1;if(e.likedUriOverride!==t.likedUriOverride)return!1;if(e.seen!==t.seen)return!1;if(e.nsfwBlurred!==t.nsfwBlurred)return!1;if(e.fillCell!==t.fillCell)return!1;if(e.constrainMediaHeight!==t.constrainMediaHeight)return!1;if(e.openAddDropdown!==t.openAddDropdown)return!1;if(e.cardIndex!==t.cardIndex)return!1;if(e.actionsMenuOpenForIndex!==t.actionsMenuOpenForIndex)return!1;if(e.focusedMediaIndex!==t.focusedMediaIndex)return!1;if(e.item.post.cid!==t.item.post.cid)return!1;if(e.item.post.likeCount!==t.item.post.likeCount)return!1;return e.item.post.repostCount===t.item.post.repostCount});export{F as P};
