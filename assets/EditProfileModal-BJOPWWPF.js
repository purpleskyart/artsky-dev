import{C as e,g as a,b as t,j as l}from"./index-bfgQOBc4.js";import{r as s,a as n}from"./react-vendor-rw3WIpbI.js";import"./atproto-JNpM3I1p.js";const r="_overlay_mv7pf_1",o="_pane_mv7pf_21",i="_scroll_mv7pf_33",c="_modalTopBar_mv7pf_41",m="_closeBtn_mv7pf_51",d="_title_mv7pf_79",u="_loading_mv7pf_85",p="_form_mv7pf_92",_="_avatarSection_mv7pf_99",v="_avatarWrap_mv7pf_105",f="_avatarImg_mv7pf_114",h="_avatarPlaceholder_mv7pf_121",b="_avatarInput_mv7pf_127",g="_avatarActions_mv7pf_135",j="_avatarBtn_mv7pf_141",x="_avatarBtnSecondary_mv7pf_142",N="_error_mv7pf_173",y="_label_mv7pf_182",C="_input_mv7pf_191",k="_textarea_mv7pf_192",S="_hint_mv7pf_216",L="_actions_mv7pf_222",w="_cancelBtn_mv7pf_231",E="_submitBtn_mv7pf_247",R="image/jpeg,image/png,image/gif,image/webp";function P({onClose:P,onSaved:B}){const U=s.useRef(null),I=s.useRef(null),W=e(),[O,D]=s.useState(""),[F,G]=s.useState(""),[z,T]=s.useState(""),[Y,A]=s.useState(null),[H,J]=s.useState(null),[M,q]=s.useState(!0),[K,Q]=s.useState(!1),[V,X]=s.useState(null);s.useEffect(()=>(W?.lockScroll(),()=>W?.unlockScroll()),[W]),s.useEffect(()=>{const e=a();if(!e?.did)return void P();let l=!1;return q(!0),X(null),t.getProfile({actor:e.did}).then(e=>{if(l)return;const a=e.data;D(a.displayName??""),G(a.handle??""),T(a.description??""),A(a.avatar??null)}).catch(()=>{l||X("Failed to load profile")}).finally(()=>{l||q(!1)}),()=>{l=!0}},[P]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopImmediatePropagation(),P())};return window.addEventListener("keydown",e,!0),()=>window.removeEventListener("keydown",e,!0)},[P]),s.useEffect(()=>()=>{Y?.startsWith("blob:")&&URL.revokeObjectURL(Y)},[Y]);const Z=l.jsx("div",{ref:U,className:r,onClick:function(e){e.target===U.current&&P()},role:"dialog","aria-modal":"true","aria-label":"Edit profile",children:l.jsxs("div",{className:o,children:[l.jsxs("div",{className:c,children:[l.jsx("button",{type:"button",className:m,onClick:P,"aria-label":"Close",children:"×"}),l.jsx("span",{className:d,children:"Edit profile"})]}),l.jsx("div",{className:i,children:M?l.jsx("p",{className:u,children:"Loading…"}):l.jsxs("form",{onSubmit:async function(e){e.preventDefault();const l=a();if(!l?.did||K)return;const s=F.trim().toLowerCase(),n=O.trim()||void 0,r=z.trim().slice(0,256)||void 0;X(null),Q(!0);try{const e=await t.getProfile({actor:l.did}).then(e=>e.data);let a;if(s&&s!==(e.handle??"")&&await t.updateHandle({handle:s}),H){const{data:e}=await t.uploadBlob(H,{encoding:H.type});a=e.blob}await t.upsertProfile(e=>{const t={...e,displayName:n,description:r};return a?t.avatar=a:null!==Y||H||(t.avatar=void 0),t}),Y?.startsWith("blob:")&&URL.revokeObjectURL(Y),B?.(),P()}catch(o){const e=o instanceof Error?o.message:"Failed to save profile";X(e)}finally{Q(!1)}},className:p,children:[V&&l.jsx("p",{className:N,role:"alert",children:V}),l.jsxs("div",{className:_,children:[l.jsx("div",{className:v,children:Y?l.jsx("img",{src:Y,alt:"",className:f,loading:"lazy"}):l.jsx("div",{className:h,"aria-hidden":!0})}),l.jsxs("div",{className:g,children:[l.jsx("input",{ref:I,type:"file",accept:R,className:b,onChange:function(e){const a=e.target.files?.[0];e.target.value="",a&&(R.split(",").map(e=>e.trim()).includes(a.type)?a.size>1048576?X("Image must be under 1 MB."):(X(null),J(a),A(URL.createObjectURL(a))):X("Please choose a JPEG, PNG, GIF, or WebP image."))},"aria-label":"Change profile picture"}),l.jsx("button",{type:"button",className:j,onClick:()=>I.current?.click(),children:"Change photo"}),(Y||H)&&l.jsx("button",{type:"button",className:x,onClick:function(){H?(Y&&Y.startsWith("blob:")&&URL.revokeObjectURL(Y),J(null),A(null)):A(null)},children:"Remove"})]})]}),l.jsxs("label",{className:y,children:["Display name",l.jsx("input",{type:"text",className:C,value:O,onChange:e=>D(e.target.value),placeholder:"Your display name",maxLength:64,autoComplete:"name"})]}),l.jsxs("label",{className:y,children:["Username",l.jsx("input",{type:"text",className:C,value:F,onChange:e=>G(e.target.value),placeholder:"you.bsky.social",autoComplete:"username"}),l.jsx("span",{className:S,children:"Your @handle (e.g. you.bsky.social)"})]}),l.jsxs("label",{className:y,children:["Bio",l.jsx("textarea",{className:k,value:z,onChange:e=>T(e.target.value),placeholder:"Tell us about yourself",maxLength:256,rows:4}),l.jsxs("span",{className:S,children:[z.length," / ",256]})]}),l.jsxs("div",{className:L,children:[l.jsx("button",{type:"button",className:w,onClick:P,children:"Cancel"}),l.jsx("button",{type:"submit",className:E,disabled:K,children:K?"Saving…":"Save"})]})]})})]})});return n.createPortal(Z,document.body)}export{P as default};
