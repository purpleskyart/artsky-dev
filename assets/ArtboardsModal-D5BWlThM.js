import{l as e,ad as t,w as s,j as a,ae as n,k as i,u as l,b as o}from"./index-C92fSBT1.js";import{h as r,b as c,L as d}from"./react-vendor-DGaPsC2e.js";import{A as u,s as h}from"./AppModal-DGJJoDV2.js";import{u as m}from"./ModalTopBarSlotContext-XWKZv5-E.js";import{s as x,b as j,a as p,E as f,C as _,c as v,d as b}from"./Icons-BCPupX3c.js";import{u as y}from"./useListKeyboardNav-3q-0e0hq.js";import{g,r as N,c as k,d as w,u as C,b as B}from"./artboards-DNvSVVrd.js";import{l as S,c as F,p as A,d as E}from"./artboardsPds-DWUixJ9h.js";import"./Layout-CULUiZuc.js";import"./atproto-3-1TCh3S.js";import"./ModalScrollContext-BMSdggb0.js";import"./usePullToRefresh-DVlCPYCP.js";import"./PostText-4SKFSD3X.js";function M({mode:e}){return"open"===e?a.jsx(j,{size:24}):"half"===e?a.jsx(p,{size:24}):a.jsx(f,{size:24})}function $({mode:e}){return"default"===e?a.jsx(_,{size:20}):"minimalist"===e?a.jsx(v,{size:20}):a.jsx(b,{size:20})}function D(){return a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:a.jsx("rect",{x:"7",y:"3",width:"10",height:"18",rx:"1"})})}function L(){return a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("rect",{x:"3",y:"3",width:"8",height:"18",rx:"1"}),a.jsx("rect",{x:"13",y:"3",width:"8",height:"18",rx:"1"})]})}function T(){return a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("rect",{x:"2",y:"3",width:"5",height:"18",rx:"1"}),a.jsx("rect",{x:"9.5",y:"3",width:"5",height:"18",rx:"1"}),a.jsx("rect",{x:"17",y:"3",width:"5",height:"18",rx:"1"})]})}function z(){const i=m(),{viewMode:l,cycleViewMode:o}=e(),{cardViewMode:c,cycleCardView:d}=t(),{nsfwPreference:u,cycleNsfwPreference:h}=s(),j=i?.rightSlot??null;return j?r.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:`${x.headerBtn} ${"sfw"!==u?x.headerBtnActive:""}`,onClick:e=>h(e.currentTarget),title:`${u}. Click to cycle: SFW â†’ Blurred â†’ NSFW`,"aria-label":`NSFW filter: ${u}`,children:a.jsx(M,{mode:"sfw"===u?"closed":"blurred"===u?"half":"open"})}),a.jsxs("button",{type:"button",className:x.headerBtn,onClick:e=>o(e.currentTarget),title:`${n[l]}. Click to cycle.`,"aria-label":`${n[l]}. Click to cycle.`,children:["1"===l&&a.jsx(D,{}),"2"===l&&a.jsx(L,{}),"3"===l&&a.jsx(T,{})]}),a.jsx("button",{type:"button",className:`${x.headerBtn} ${"default"!==c?x.headerBtnActive:""}`,onClick:e=>d(e.currentTarget),"aria-label":"default"===c?"Show all":"minimalist"===c?"Minimalist":"Art only",title:"default"===c?"Show all":"minimalist"===c?"Minimalist":"Art only",children:a.jsx($,{mode:"default"===c?"default":"minimalist"===c?"minimalist":"artOnly"})})]}),j):null}const P="_wrap_a3v2x_1",R="_createForm_a3v2x_8",I="_input_a3v2x_14",W="_createBtn_a3v2x_25",V="_empty_a3v2x_41",G="_syncing_a3v2x_49",K="_pdsError_a3v2x_55",O="_bento_a3v2x_62",q="_bentoCard_a3v2x_89",U="_bentoCardFocused_a3v2x_101",H="_bentoLink_a3v2x_107",J="_bentoName_a3v2x_127",Q="_bentoThumbs_a3v2x_131",X="_bentoThumb_a3v2x_131",Y="_bentoEmpty_a3v2x_167",Z="_bentoInfo_a3v2x_179",ee="_bentoCount_a3v2x_197",te="_bentoActions_a3v2x_203",se="_editInput_a3v2x_213",ae="_smallBtn_a3v2x_220",ne="_smallBtnDanger_a3v2x_221",ie="_thumbPlaceholder_a3v2x_254";function le({inModal:e=!1,onRegisterRefresh:t}){const{session:s}=i(),{openArtboardModal:n}=l(),[r,u]=c.useState(()=>g()),[h,m]=c.useState(""),[x,j]=c.useState(null),[p,f]=c.useState(null),[_,v]=c.useState(""),[b,M]=c.useState(!1),[$,D]=c.useState(null),[L,T]=c.useState(0),z=c.useRef(null);function le(){u(g())}async function oe(){if(!x)return;C(x,_);const e=B(x);if(j(null),f(null),le(),s?.did&&e)try{await A(o,s.did,e)}catch{D("Failed to sync rename")}}c.useEffect(()=>{t?.(()=>le())},[t]),c.useEffect(()=>{s?.did&&(M(!0),D(null),S(o,s.did).then(e=>{N(e),le()}).catch(e=>{D(e instanceof Error?e.message:"Failed to sync collections")}).finally(()=>M(!1)))},[s?.did]),c.useEffect(()=>{T(e=>r.length?Math.min(e,r.length-1):0)},[r.length]),c.useEffect(()=>{if(!e||!z.current||L<0)return;const t=z.current.querySelector(`[data-collection-index="${L}"]`);t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})},[e,L]),y({enabled:e&&r.length>0,itemCount:r.length,focusedIndex:L,setFocusedIndex:T,onActivate:e=>{const t=r[e];t&&n(t.id)},useCapture:!0});return a.jsxs("div",{className:P,children:[b&&a.jsx("p",{className:G,children:"Syncing collectionsâ€¦"}),$&&a.jsx("p",{className:K,children:$}),a.jsxs("form",{onSubmit:async function(e){e.preventDefault();const t=h.trim()||"Untitled",a=k(t);if(m(""),le(),s?.did)try{await F(o,s.did,t,a.id)}catch(n){w(a.id),le(),D(n instanceof Error?n.message:"Failed to create on server")}},className:R,children:[a.jsx("input",{type:"text",placeholder:"New collection name",value:h,onChange:e=>m(e.target.value),className:I}),a.jsx("button",{type:"submit",className:W,children:"Create"})]}),0===r.length?a.jsx("p",{className:V,children:'No collections yet. Open a post from the feed and use "Collect" to save it here.'}):a.jsx("div",{ref:z,className:O,children:r.map((t,i)=>a.jsxs("div",{className:`${q} ${e&&i===L?U:""}`,"data-collection-index":e?i:void 0,children:[e?a.jsxs("button",{type:"button",className:H,onClick:()=>n(t.id),children:[t.posts.length>0?a.jsx("div",{className:Q,children:t.posts.slice(0,4).map(e=>a.jsx("div",{className:X,children:e.thumb?a.jsx("img",{src:e.thumb,alt:"",loading:"lazy"}):a.jsx("span",{className:ie,children:"ðŸ“Œ"})},e.uri))}):a.jsx("div",{className:Y,children:"No posts yet"}),a.jsxs("div",{className:Z,children:[a.jsx("span",{className:J,children:t.name}),a.jsxs("span",{className:ee,children:[t.posts.length," post",1!==t.posts.length?"s":""]})]})]}):a.jsxs(d,{to:`/artboard/${t.id}`,className:H,children:[t.posts.length>0?a.jsx("div",{className:Q,children:t.posts.slice(0,4).map(e=>a.jsx("div",{className:X,children:e.thumb?a.jsx("img",{src:e.thumb,alt:"",loading:"lazy"}):a.jsx("span",{className:ie,children:"ðŸ“Œ"})},e.uri))}):a.jsx("div",{className:Y,children:"No posts yet"}),a.jsxs("div",{className:Z,children:[a.jsx("span",{className:J,children:t.name}),a.jsxs("span",{className:ee,children:[t.posts.length," post",1!==t.posts.length?"s":""]})]})]}),a.jsx("div",{className:te,children:x===t.id?a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"text",value:_,onChange:e=>v(e.target.value),className:se,autoFocus:!0,onBlur:oe,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),oe()),onClick:e=>e.preventDefault()}),a.jsx("button",{type:"button",className:ae,onClick:e=>{e.preventDefault(),oe()},children:"Save"})]}):p===t.id?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",className:ae,onClick:e=>{e.preventDefault(),function(e){f(null),j(e.id),v(e.name)}(t)},children:"Rename"}),a.jsx("button",{type:"button",className:ne,onClick:e=>{e.preventDefault(),async function(e){if(confirm("Delete this collection?")){if(s?.did)try{await E(o,s.did,e)}catch{}w(e),le()}}(t.id),f(null)},children:"Delete"})]}):a.jsx("button",{type:"button",className:ae,onClick:e=>{e.preventDefault(),f(e=>e===t.id?null:t.id)},children:"Edit"})})]},t.id))})]})}function oe({onClose:e,onBack:t,canGoBack:s}){const[n,i]=c.useState(null);return a.jsxs(u,{ariaLabel:"Collections",onClose:e,onBack:t,canGoBack:s,onPullToRefresh:n?()=>n():void 0,children:[a.jsx("div",{className:h.modalBetaAlert,role:"status",children:"BETA"}),a.jsx(z,{}),a.jsx(le,{inModal:!0,onRegisterRefresh:e=>i(()=>e)})]})}export{oe as default};
