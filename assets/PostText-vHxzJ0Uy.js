import{u as e,j as t,aD as a}from"./index-BDZjbCDF.js";import{b as l,L as n}from"./react-vendor-DGaPsC2e.js";const s=l.memo(function({handle:a,className:s,title:r,"aria-label":i,onClick:o,children:c}){const{openProfileModal:u}=e(),p=l.useCallback(e=>{e.preventDefault(),e.stopPropagation(),u(a),o?.(e)},[u,a,o]);return t.jsx(n,{to:`/profile/${encodeURIComponent(a)}`,className:s,title:r,"aria-label":i,onClick:p,children:c})});function r({tag:a,className:l,onClick:s,children:r}){const{openTagModal:i}=e(),o=encodeURIComponent(a.replace(/^#/,""));return t.jsx(n,{to:`/tag/${o}`,className:l,onClick:e=>{e.preventDefault(),i(a.replace(/^#/,"")),s?.(e)},children:r})}const i="_link_5eq9n_1",o="_hashtag_5eq9n_2",c="_mention_5eq9n_3",u="_preview_5eq9n_25",p=new RegExp("([\\w.%+-]+@(?:[\\w-]+\\.)+[a-zA-Z]{2,})|(https?:\\/\\/[^\\s<>\"']+)|(www\\.[^\\s<>\"'\\],;:)!?]+)|(?<![@\\/])((?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,}(?:\\/[^\\s<>\"']*)?)|(#[\\w]+)|(?<![a-zA-Z0-9])(@[\\w.-]+)","gi");function h(e,t,a){if("domain"!==a)return t;try{return new URL(e).hostname.replace(/^www\./,"")}catch{return t}}function g(e,a,l,n,u){if("text"===e.type)return t.jsx("span",{children:e.value},a);if(!u)return t.jsx("span",{className:"hashtag"===e.type?o:"mention"===e.type?c:i,children:e.value},a);if("email"===e.type){const l=e.value.replace(/[.,;:)!?]+$/,"");return t.jsx("a",{href:`mailto:${l}`,className:i,onClick:n,title:l,children:e.value},a)}if("url"===e.type||"bareUrl"===e.type&&e.href){const s=e.href??e.value,r=h(s,e.value,l);return t.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:i,onClick:n,title:s,children:r},a)}if("bareUrl"===e.type){const s=`https://${e.value.replace(/[.,;:)!?]+$/,"")}`,r=h(s,e.value,l);return t.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:i,onClick:n,title:s,children:r},a)}if("hashtag"===e.type){const l=(e.tag??e.value).replace(/^#/,"");return t.jsx(r,{tag:l,className:o,onClick:n,children:e.value},a)}const p=e.value.replace(/^@/,"");return t.jsx(s,{handle:p,className:c,onClick:n,children:e.value},a)}const f=l.memo(function({text:e,facets:n,className:s,maxLength:r,stopPropagation:i,linkDisplay:o="url",interactive:c=!0}){const h=l.useMemo(()=>i?e=>e.stopPropagation():void 0,[i]);if(n&&Array.isArray(n)&&n.length>0)try{const l=new a.RichText({text:e,facets:n}),i=[];let p=0;for(const e of l.segments()){const t=e.text;let a=t.length;if(e.isLink()&&e.link?.uri){const l=e.link.uri,n=/^https?:\/\/[^/]+$/.test(l)||!/^https?:\/\//i.test(l),s=i[i.length-1];if(n&&"text"===s?.type&&/@\s*$/.test(s.value)){const e=s.value.replace(/\s*@\s*$/,"");i.pop(),p-=s.value.length;const l=e?`${e}@${t}`:t;i.push({type:"email",value:l}),a=l.length}else i.push({type:"url",value:t,href:l})}else e.isMention()&&e.mention?.did?i.push({type:"mention",value:t,did:e.mention.did}):e.isTag()&&null!=e.tag?.tag?i.push({type:"hashtag",value:t,tag:"#"+e.tag.tag}):i.push({type:"text",value:t});if(p+=a,null!=r&&p>=r&&"text"===i[i.length-1].type){const e=i[i.length-1],t=e.value.length-(p-r);t<e.value.length&&(i[i.length-1]={...e,value:e.value.slice(0,t)+"…"});break}}if(i.length>0)return t.jsx("span",{className:[s,!c&&u].filter(Boolean).join(" ")||void 0,children:i.map((e,t)=>g(e,t,o,h,c))})}catch{}const f=[];let v,m=0;const d=new RegExp(p.source,"gi");for(;null!==(v=d.exec(e));){v.index>m&&f.push({type:"text",value:e.slice(m,v.index)});const t=v[1]??v[2]??v[3]??v[4]??v[5]??v[6];v[1]?f.push({type:"email",value:t}):v[2]?f.push({type:"url",value:t}):v[3]||v[4]?f.push({type:"bareUrl",value:t}):v[5]?f.push({type:"hashtag",value:t}):v[6]&&f.push({type:"mention",value:t}),m=d.lastIndex}let x;if(m<e.length&&f.push({type:"text",value:e.slice(m)}),null!=r){let e=0;x=[];for(const t of f)if("text"===t.type){if(!(e+t.value.length<=r)){const a=r-e;a>0&&x.push({type:"text",value:t.value.slice(0,a)+"…"});break}x.push(t),e+=t.value.length}else x.push(t)}else x=f;const y=0===f.length?null!=r&&e.length>r?e.slice(0,r)+"…":e:"";return 0===x.length?t.jsx("span",{className:s,children:y||e}):t.jsx("span",{className:[s,!c&&u].filter(Boolean).join(" ")||void 0,children:x.map((e,t)=>g(e,t,o,h,c))})});export{f as P,s as a};
