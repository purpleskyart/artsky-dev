import{j as e,k as t,h as r,ad as n,v as a,w as i,u as o,S as s,a8 as d,f as c,b as l,ay as u}from"./index-BoghgObz.js";import{b as p,d as m,h}from"./react-vendor-DGaPsC2e.js";import{l as _,P as v,g as f,b as x}from"./PostActionsMenu-Dkj0Rosp.js";import{f as w,g as k,c as g,a as y,b,i as R}from"./artboards-DNvSVVrd.js";import{p as j}from"./artboardsPds-DWUixJ9h.js";import{P as z,a as C}from"./PostText-iHQxuE5l.js";let L=null;function A(e,t){if(!e||!e.startsWith("http"))return e??"";if(!function(){if(null!==L)return L;if("undefined"==typeof document)return L=!1,L;const e=document.createElement("canvas");return L=!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),L}())return e;return`https://wsrv.nl/?url=${encodeURIComponent(e)}&output=webp`}const N="_progressiveImage_8ku7v_1",T="_placeholder_8ku7v_8",q="_fullImage_8ku7v_21",P="_loaded_8ku7v_30",$="_error_8ku7v_38",M="_errorPlaceholder_8ku7v_46",I="_errorText_8ku7v_60";function E({src:t,alt:r,aspectRatio:n,loading:a="lazy",className:i="",onLoad:o,sizes:s=[320,640,960,1280,1920],sizesAttr:d,maxRetries:c=3,preloadDistance:l=1500}){const[u,m]=p.useState(!1),[h,_]=p.useState(!1),[v,f]=p.useState(0),[x,w]=p.useState(!1),[k,g]=p.useState(!1),[y,b]=p.useState("eager"===a),R=p.useRef(null),j=p.useRef(null),z=p.useRef(null),C=p.useRef(null),L=p.useRef(null),E=p.useMemo(()=>A(t),[t]),S=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return s.map(e=>`${A(t.includes("?")?`${t}&width=${e}`:`${t}?width=${e}`)} ${e}w`).join(", ")},[t,s]),O=p.useMemo(()=>"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw",[]),W=d||O,B=p.useMemo(()=>{if(t.includes("cdn.bsky.app"))return t.replace(/\/img\/[^/]+\//,"/img/avatar_thumbnail/")},[t]),D=p.useCallback(e=>{j.current&&(clearTimeout(j.current),j.current=null),m(!0),_(!1),w(!1),f(0),o?.(e)},[o]),F=p.useCallback(()=>{g(!0)},[]),G=p.useCallback(()=>{if(h||E===t)if(v<c){const e=1e3*Math.pow(2,v);R.current=setTimeout(()=>{f(e=>e+1),_(!1)},e)}else w(!0);else _(!0)},[h,E,t,v,c]);p.useEffect(()=>()=>{R.current&&clearTimeout(R.current),j.current&&clearTimeout(j.current),L.current&&L.current.disconnect()},[]),p.useEffect(()=>{if("eager"===a||u)return void b(!0);const e=z.current;return e?(L.current=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting&&(b(!0),L.current&&L.current.disconnect())},{rootMargin:`${l}px 0px ${l}px 0px`,threshold:0}),L.current.observe(e),()=>{L.current&&L.current.disconnect()}):void 0},[a,l,u]),p.useEffect(()=>{f(0),w(!1),m(!1),_(!1),g(!1),b("eager"===a)},[t,a]);const U=h?t:E;return p.useEffect(()=>{if(!y||u||x)return;const e=requestAnimationFrame(()=>(()=>{const e=C.current;e?.complete&&e.naturalWidth>0&&(j.current&&(clearTimeout(j.current),j.current=null),m(!0))})());return j.current=setTimeout(()=>{j.current=null,u||m(!0)},12e3),()=>{cancelAnimationFrame(e),j.current&&(clearTimeout(j.current),j.current=null)}},[y,U,v,u,x]),x?e.jsx("div",{className:`${N} ${$} ${i}`,style:{aspectRatio:n?String(n):void 0},role:"img","aria-label":`Failed to load: ${r}`,children:e.jsxs("div",{className:M,children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{className:I,children:"Image failed to load"})]})}):e.jsxs("div",{ref:z,className:`${N} ${u?P:""} ${i}`,style:{aspectRatio:n?String(n):void 0},children:[B&&!u&&!k&&e.jsx("img",{src:B,alt:"",className:T,"aria-hidden":"true",onError:F}),e.jsx("img",{ref:C,src:U,srcSet:S,sizes:S?W:void 0,alt:r,loading:y?"eager":"lazy",onLoad:D,onError:G,className:q},`${U}-${v}`)]})}const S={card:"_card_7q0z6_2",cardLink:"_cardLink_7q0z6_21",cardSelected:"_cardSelected_7q0z6_43",cardLiked:"_cardLiked_7q0z6_73",cardInArtboard:"_cardInArtboard_7q0z6_81",cardTransFlag:"_cardTransFlag_7q0z6_89",mediaWrap:"_mediaWrap_7q0z6_134",nsfwOverlay:"_nsfwOverlay_7q0z6_135",cardArtOnly:"_cardArtOnly_7q0z6_138",textOnlyPreview:"_textOnlyPreview_7q0z6_142",cardSeen:"_cardSeen_7q0z6_147",meta:"_meta_7q0z6_147",handleBlock:"_handleBlock_7q0z6_148",cardActionRow:"_cardActionRow_7q0z6_150",cardFillCell:"_cardFillCell_7q0z6_250",mediaGridCellFocused:"_mediaGridCellFocused_7q0z6_292",addWrap:"_addWrap_7q0z6_308",addWrapOpen:"_addWrapOpen_7q0z6_317",cardActionRowCenter:"_cardActionRowCenter_7q0z6_329",cardLikeRepostBtn:"_cardLikeRepostBtn_7q0z6_353",addToBoardBtn:"_addToBoardBtn_7q0z6_354",cardActionRowAvatarFollow:"_cardActionRowAvatarFollow_7q0z6_357",cardActionRowAvatarPlus:"_cardActionRowAvatarPlus_7q0z6_357",cardActionRowRight:"_cardActionRowRight_7q0z6_371",cardActionRowTime:"_cardActionRowTime_7q0z6_382",postTimeStacked:"_postTimeStacked_7q0z6_389",postTimeMonth:"_postTimeMonth_7q0z6_397",postTimeDayYear:"_postTimeDayYear_7q0z6_404",cardActionRowAvatar:"_cardActionRowAvatar_7q0z6_357",handleRow:"_handleRow_7q0z6_496",authorAvatar:"_authorAvatar_7q0z6_496",authorAvatarPlaceholder:"_authorAvatarPlaceholder_7q0z6_497",handleRowMain:"_handleRowMain_7q0z6_520",handleRowMeta:"_handleRowMeta_7q0z6_523",cardMinimalist:"_cardMinimalist_7q0z6_561",cardLikeRepostBtnActive:"_cardLikeRepostBtnActive_7q0z6_622",addToBoardBtnInCollection:"_addToBoardBtnInCollection_7q0z6_669",collectIcon:"_collectIcon_7q0z6_673",addDropdown:"_addDropdown_7q0z6_686",addDropdownFixed:"_addDropdownFixed_7q0z6_710",addBoardLabel:"_addBoardLabel_7q0z6_716",addBoardCheckbox:"_addBoardCheckbox_7q0z6_730",addBoardText:"_addBoardText_7q0z6_735",addDropdownNew:"_addDropdownNew_7q0z6_741",addBoardInput:"_addBoardInput_7q0z6_747",addDropdownActions:"_addDropdownActions_7q0z6_758",addBoardSubmit:"_addBoardSubmit_7q0z6_764",artOnlyActions:"_artOnlyActions_7q0z6_831",mediaWrapConstrained:"_mediaWrapConstrained_7q0z6_856",nsfwOverlayText:"_nsfwOverlayText_7q0z6_882",mediaWrapFillCell:"_mediaWrapFillCell_7q0z6_891",mediaWrapMultiStack:"_mediaWrapMultiStack_7q0z6_899",media:"_media_7q0z6_134",textOnlyPreviewText:"_textOnlyPreviewText_7q0z6_936",textOnlyPreviewEmpty:"_textOnlyPreviewEmpty_7q0z6_946",textOnlyPreviewLink:"_textOnlyPreviewLink_7q0z6_951",textOnlyPreviewLinkThumb:"_textOnlyPreviewLinkThumb_7q0z6_971",textOnlyPreviewLinkTitle:"_textOnlyPreviewLinkTitle_7q0z6_978",textOnlyPreviewLinkDesc:"_textOnlyPreviewLinkDesc_7q0z6_987",mediaWrapGridSpacer:"_mediaWrapGridSpacer_7q0z6_1024",mediaWrapGrid:"_mediaWrapGrid_7q0z6_1024",mediaGrid:"_mediaGrid_7q0z6_292",mediaGridCell:"_mediaGridCell_7q0z6_292",mediaGridImg:"_mediaGridImg_7q0z6_1081",mediaVideoWrap:"_mediaVideoWrap_7q0z6_1123",postTime:"_postTime_7q0z6_389",repostIconLink:"_repostIconLink_7q0z6_1252",repostIcon:"_repostIcon_7q0z6_1252",pinIconWrap:"_pinIconWrap_7q0z6_1271",pinIcon:"_pinIcon_7q0z6_1271",handleLinkWrap:"_handleLinkWrap_7q0z6_1289",handleLinkWrapLiked:"_handleLinkWrapLiked_7q0z6_1299",handleLink:"_handleLink_7q0z6_1180",text:"_text_7q0z6_142"};function O(){return e.jsx("svg",{className:S.repostIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"})})}function W(){return e.jsx("svg",{className:S.pinIcon,viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":!0,children:e.jsx("path",{d:"M16 12V4h1V2H7v2h1v8l-2 2v2h5.2v6h1.6v-6H18v-2l-2-2z"})})}function B(){return e.jsx("svg",{className:S.collectIcon,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}const D=p.memo(function({item:L,isSelected:A,cardRef:N,addButtonRef:T,openAddDropdown:q,onAddClose:P,onPostClick:$,onAspectRatio:M,fillCell:I,nsfwBlurred:D,onNsfwUnblur:F,constrainMediaHeight:G,likedUriOverride:U,onLikedChange:H,seen:V,onActionsMenuOpenChange:Y,cardIndex:Q,actionsMenuOpenForIndex:K,focusedMediaIndex:X,onMediaRef:J}){const Z=m(),{session:ee}=t(),{openLoginModal:te}=r(),{artOnly:re,minimalist:ne}=n(),{mediaMode:ae}=a(),{unblurredUris:ie,setUnblurred:oe}=i(),{openQuotesModal:se,isModalOpen:de}=o(),ce=p.useRef(null),le=p.useRef(null),ue=p.useRef(null),{post:pe,reason:me}=L,he=L._feedSource,_e=he?.label??("timeline"===he?.kind?"Following":void 0),ve=p.useMemo(()=>s(pe),[pe]),fe=!!ve,xe=pe.record?.text??"",we=p.useMemo(()=>d(pe),[pe]),ke=p.useMemo(()=>c(pe),[pe]),ge=pe.author.handle??pe.author.did,ye=me?.by?me.by.handle??me.by.did:null,be=(()=>{const e=pe?.embed;return!!e&&("app.bsky.embed.record#view"===e.$type||"app.bsky.embed.recordWithMedia#view"===e.$type)})(),Re="app.bsky.feed.defs#reasonPin"===me?.$type,je=pe.author.viewer,ze=je?.following,[Ce,Le]=p.useState(ze??null),Ae=!!(Ce??ze??null),Ne=ee?.did===pe.author.did,[Te,qe]=p.useState(!1),Pe=pe.viewer,$e=Pe?.like,[Me,Ie]=p.useState($e),[Ee,Se]=p.useState(!1),Oe=void 0!==U?U??void 0:Me,We=!!Oe,Be=w(pe.uri),De=We&&Be,[Fe,Ge]=p.useState(()=>fe&&null!=ve?.aspectRatio?ve.aspectRatio:null),[Ue,He]=p.useState(!1),[Ve,Ye]=p.useState(!1),Qe=p.useRef(null),[Ke,Xe]=p.useState(new Set),[Je,Ze]=p.useState(""),et=p.useRef(null),tt=p.useRef(null),rt=p.useRef(null),nt=p.useRef(null),[at,it]=p.useState(null),ot=p.useRef(null),st=p.useRef(A),dt=p.useRef(0),ct=p.useRef(0),lt=p.useRef(!1),ut=p.useRef(!1),pt=p.useRef(!1),mt=p.useRef(null),ht=p.useRef(null);p.useEffect(()=>{null!=Q&&K!==Q&&Ve&&Ye(!1)},[K,Q,Ve]);const _t=p.useRef(null);p.useEffect(()=>{null!=Q&&(K===Q&&_t.current!==Q&&Ye(!0),_t.current=K??null)},[K,Q]),p.useEffect(()=>{if(!Ve)return;const e=e=>!e||!ot.current?.contains(e)&&!Qe.current?.contains(e),t=t=>{e(t.target)&&Ye(!1)},r=t=>{const r=t.target??t.target;e(r)&&Ye(!1)},n=t=>{e(t.target)&&Ye(!1)};return document.addEventListener("focusin",t),document.addEventListener("mousedown",r),document.addEventListener("touchstart",r,{passive:!0}),document.addEventListener("mouseover",n),()=>{document.removeEventListener("focusin",t),document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r),document.removeEventListener("mouseover",n)}},[Ve]),p.useEffect(()=>{Ie(void 0!==U?U??void 0:$e)},[pe.uri,$e,U]),p.useEffect(()=>{Le(ze??null)},[pe.uri,ze]);const vt=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),Te||Ne||!ee?.did||Ae)return;qe(!0);const t=`pending:follow:${pe.author.did}:${Date.now()}`;Le(t);try{const e=await l.follow(pe.author.did);Le(e.uri)}catch{Le(null)}finally{qe(!1)}},[Te,Ne,ee?.did,Ae,pe.author.did]),ft=p.useCallback(async e=>{if(e.preventDefault(),e.stopPropagation(),!ee?.did)return void te();if(Ee)return;const t=!!Oe,r=Oe||void 0;Se(!0),Ie(t?void 0:"pending");try{if(t)await l.deleteLike(r),Ie(void 0);else{const e=await l.like(pe.uri,pe.cid);Ie(e.uri)}}catch{Ie(r)}finally{Se(!1)}},[ee?.did,te,Ee,Oe,pe.uri,pe.cid]);p.useEffect(()=>{q&&He(!0)},[q]),p.useEffect(()=>()=>{mt.current&&(clearTimeout(mt.current),mt.current=null)},[]);const xt=p.useRef(Ue);p.useEffect(()=>{xt.current&&!Ue&&P?.(),xt.current=Ue},[Ue,P]);const wt=p.useCallback(()=>{if(!et.current)return null;const e=et.current.getBoundingClientRect(),t=window.innerWidth-8-140,r=e.left+e.width/2,n=Math.max(148,Math.min(t,r));return{bottom:window.innerHeight-e.top,left:n}},[]);p.useLayoutEffect(()=>{Ue&&et.current?it(wt()):it(null)},[Ue,wt]),p.useEffect(()=>{if(!Ue)return;const e=()=>it(e=>e?wt()??e:e);return window.addEventListener("scroll",e,!0),()=>window.removeEventListener("scroll",e,!0)},[Ue,wt]),p.useEffect(()=>{if(Ue)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e);function e(e){const t=e.target;et.current?.contains(t)||tt.current?.contains(t)||nt.current?.contains(t)||He(!1)}},[Ue]);const kt=k(),gt=p.useCallback(e=>{Xe(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},[]),yt=p.useCallback(async()=>{if(!(Ke.size>0||Je.trim().length>0))return;const e=u(pe),t=ke.length>0?ke.map(e=>e.url):void 0,r={uri:pe.uri,cid:pe.cid,authorHandle:pe.author.handle,text:pe.record?.text?.slice(0,200),thumb:e?.url??t?.[0],thumbs:t},n=[];if(Je.trim()){const e=g(Je.trim());y(e.id,r),n.push(e.id),Ze("")}if(Ke.forEach(e=>{y(e,r),n.push(e)}),Xe(new Set),He(!1),ee?.did&&n.length>0)for(const a of n){const e=b(a);if(e)try{await j(l,ee.did,e)}catch{}}},[Ke,Je,pe,ke,ee?.did]),bt=fe&&"video"===ve.type&&ve.videoPlaylist,Rt=fe&&"image"===ve.type&&(ve.imageCount??0)>1,jt=p.useMemo(()=>ke.filter(e=>"image"===e.type),[ke]),zt=p.useMemo(()=>ke.map((e,t)=>"image"===e.type?t:-1).filter(e=>e>=0),[ke]),Ct=Rt&&jt.length?jt[0]?.url:ve?.url??"",Lt=p.useCallback(e=>{const t=e.currentTarget;t.naturalWidth&&t.naturalHeight&&Ge(e=>null!=e?e:t.naturalWidth/t.naturalHeight)},[Rt]);p.useEffect(()=>{fe&&(null!=ve?.aspectRatio?Ge(e=>e??ve.aspectRatio):bt||Ge(e=>e??null))},[fe,ve?.aspectRatio,ve?.videoPlaylist,bt]),p.useEffect(()=>{Ge(fe&&null!=ve?.aspectRatio?ve.aspectRatio:null)},[pe.uri]),p.useEffect(()=>{null!=Fe&&M&&M(Fe)},[Fe,M]),p.useEffect(()=>{if(!bt||!ve?.videoPlaylist||!ce.current)return;const e=ce.current,t=ve.videoPlaylist;let r;var n;return/\.m3u8(\?|$)/i.test(n=t)||n.includes("m3u8")?_().then(n=>{if(ce.current)if(n.isSupported()){const a=new n;ue.current=a,a.loadSource(t),a.attachMedia(e),a.on(n.Events.ERROR,()=>{}),r=()=>{a.destroy(),ue.current=null}}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t,r=()=>{e.removeAttribute("src")})}).catch(()=>{e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}):(e.src=t,r=()=>{e.removeAttribute("src")}),()=>{r?.()}},[bt,ve?.videoPlaylist]);const At=p.useRef(de);At.current=de,p.useEffect(()=>{if(!bt||!le.current||!ce.current)return;const e=le.current,t=ce.current;de&&t.pause();const r=new IntersectionObserver(e=>{const r=e[0];r&&t&&(At.current?t.pause():r.isIntersecting?t.play().catch(()=>{}):t.pause())},{threshold:.25,rootMargin:"0px"});return r.observe(e),()=>r.disconnect()},[bt,de]),p.useEffect(()=>{const e=st.current;st.current=A,A&&D&&F&&F(),e&&!A&&ie.has(pe.uri)&&oe(pe.uri,!1)},[A,pe.uri,ie,oe,D,F]),p.useEffect(()=>{const e=ot.current;if(!e||!ie.has(pe.uri))return;const t=t=>{const r=t.relatedTarget;null!=r&&e.contains(r)||oe(pe.uri,!1)};return e.addEventListener("focusout",t),()=>e.removeEventListener("focusout",t)},[pe.uri,ie,oe]),p.useEffect(()=>{if(!fe||!ie.has(pe.uri)||!le.current)return;const e=le.current,t=new IntersectionObserver(e=>{const t=e[0];!t||t.intersectionRatio>0||oe(pe.uri,!1)},{threshold:0,rootMargin:"0px"});return t.observe(e),()=>t.disconnect()},[fe,pe.uri,ie,oe]);const Nt=p.useCallback(()=>{ce.current&&ce.current.play().catch(()=>{})},[]),Tt=p.useCallback(()=>{ce.current&&(ce.current.pause(),ce.current.currentTime=0)},[]),qt=p.useCallback(e=>{if(lt.current)return lt.current=!1,e.preventDefault(),void e.stopPropagation();ut.current||($?$(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`))},[lt,ut,$,pe.uri,L,Z]),Pt=p.useCallback(()=>{$?$(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`)},[$,pe.uri,L,Z]),$t=p.useCallback(()=>{ee?.did?Oe?(Ie(void 0),l.deleteLike(Oe).then(()=>{H?.(pe.uri,null)}).catch(()=>Ie(Oe))):(Ie("pending"),l.like(pe.uri,pe.cid).then(e=>{Ie(e.uri),H?.(pe.uri,e.uri)}).catch(()=>Ie(void 0))):te()},[ee?.did,te,Oe,pe.uri,pe.cid,H]),Mt=p.useCallback(e=>{if(e.stopPropagation(),pt.current)return;const t=Date.now();t-ct.current<400?(ct.current=0,$t()):(ct.current=t,setTimeout(()=>Pt(),400))},[pt,ct,$t,Pt]),It=p.useCallback(e=>{ot.current=e,N&&("function"==typeof N?N(e):N.current=e)},[N]);return e.jsx("div",{ref:It,"data-post-uri":pe.uri,className:`${S.card} ${A?S.cardSelected:""} ${De?S.cardTransFlag:""} ${!De&&We?S.cardLiked:""} ${!De&&Be?S.cardInArtboard:""} ${V&&!A?S.cardSeen:""} ${I?S.cardFillCell:""} ${re?S.cardArtOnly:""} ${ne?S.cardMinimalist:""}`,children:e.jsxs("div",{role:"button",tabIndex:0,className:S.cardLink,onClick:qt,onKeyDown:e=>{"Enter"===e.key&&($?$(pe.uri,{initialItem:L}):Z(`/post/${encodeURIComponent(pe.uri)}`))},onTouchStart:e=>{ut.current=!0,pt.current=!0;const t=e.touches[0];ht.current=t?{x:t.clientX,y:t.clientY}:null},onTouchEnd:e=>{const t=ht.current;ht.current=null;const r=e.changedTouches[0];if((t&&r?Math.hypot(r.clientX-t.x,r.clientY-t.y):0)>12)return mt.current&&(clearTimeout(mt.current),mt.current=null),ut.current=!1,void(pt.current=!1);const n=Date.now();n-dt.current<400?(dt.current=0,lt.current=!0,mt.current&&(clearTimeout(mt.current),mt.current=null),e.preventDefault(),Oe?(Ie(void 0),l.deleteLike(Oe).then(()=>{H?.(pe.uri,null)}).catch(()=>Ie(Oe))):(Ie("pending"),l.like(pe.uri,pe.cid).then(e=>{Ie(e.uri),H?.(pe.uri,e.uri)}).catch(()=>Ie(void 0))),setTimeout(()=>{ut.current=!1,pt.current=!1},500)):(dt.current=n,mt.current&&clearTimeout(mt.current),mt.current=setTimeout(()=>{mt.current=null,ut.current=!1,pt.current=!1,Pt()},400))},children:[e.jsxs("div",{ref:e=>{le.current=e,!J||"text"!==ae&&(!fe||Rt&&jt.length>1)||J(0,e)},className:`${S.mediaWrap} ${I?S.mediaWrapFillCell:""} ${G?S.mediaWrapConstrained:""} ${Rt&&jt.length>1?S.mediaWrapMultiStack:""}`,style:I||G||Rt&&jt.length>1?void 0:{aspectRatio:fe?null!=Fe?String(Fe):bt?"1":void 0:"1"},onMouseEnter:Nt,onMouseLeave:Tt,...fe&&{onClick:Mt},children:[fe&&"text"!==ae?bt?e.jsx("div",{className:S.mediaVideoWrap,children:e.jsx("video",{ref:ce,className:S.media,poster:ve.url||void 0,muted:!0,playsInline:!0,loop:!0,preload:"metadata",style:{aspectRatio:null!=Fe?`${Fe}`:void 0},onLoadedMetadata:e=>{const t=e.currentTarget;t.videoWidth&&t.videoHeight&&Ge(e=>null!=e?e:t.videoWidth/t.videoHeight)}})}):Rt&&jt.length>1?e.jsxs(e.Fragment,{children:[(()=>{const t=1/jt.reduce((e,t)=>e+1/(t.aspectRatio||1),0);return e.jsx("div",{className:S.mediaWrapGridSpacer,style:{aspectRatio:String(t)},"aria-hidden":!0})})(),e.jsx("div",{className:S.mediaWrapGrid,children:e.jsx("div",{className:S.mediaGrid,style:{minHeight:0},children:jt.map((t,r)=>{const n=zt[r]??r,a=X===n;return e.jsx("div",{ref:e=>J?.(n,e),className:`${S.mediaGridCell} ${a?S.mediaGridCellFocused:""}`,style:{flex:1/(t.aspectRatio||1)+" 1 0"},children:e.jsx(E,{src:t.url,alt:"",className:S.mediaGridImg,loading:"lazy",onLoad:0===r?Lt:void 0})},r)})})})]}):e.jsx(e.Fragment,{children:e.jsx(E,{src:Ct,alt:"",className:S.media,loading:"eager",onLoad:Lt})}):e.jsxs("div",{className:S.textOnlyPreview,children:[xe?e.jsx("div",{className:S.textOnlyPreviewText,onClick:e=>{e.stopPropagation(),qt(e)},children:e.jsx(z,{text:xe,facets:pe.record?.facets,maxLength:500,stopPropagation:!0,interactive:!1})}):null,we?e.jsxs("a",{href:we.uri,target:"_blank",rel:"noopener noreferrer",className:S.textOnlyPreviewLink,onClick:e=>e.stopPropagation(),children:[we.thumb?e.jsx(E,{src:we.thumb,alt:"",className:S.textOnlyPreviewLinkThumb,loading:"lazy"}):null,e.jsx("span",{className:S.textOnlyPreviewLinkTitle,children:we.title}),we.description?e.jsx("span",{className:S.textOnlyPreviewLinkDesc,children:we.description}):null]}):null,xe||we?null:e.jsx("span",{className:S.textOnlyPreviewEmpty,children:"Text post"})]}),D&&F&&fe&&e.jsx("div",{className:S.nsfwOverlay,onClick:e=>{e.preventDefault(),e.stopPropagation(),F(),Pt()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),F(),Pt())},role:"button",tabIndex:0,"aria-label":"Reveal sensitive content",children:e.jsx("span",{className:S.nsfwOverlayText,children:"NSFW"})})]}),re&&!ne&&e.jsx("div",{className:S.artOnlyActions,onClick:e=>e.stopPropagation(),children:e.jsx(v,{postUri:pe.uri,postCid:pe.cid,authorDid:pe.author.did,rootUri:pe.uri,isOwnPost:Ne,compact:!0,verticalIcon:!0,className:S.cardActionsMenu,open:Ve,onOpenChange:e=>{Ye(e),Y?.(e)},dropdownRef:Qe,feedLabel:_e,postedAt:pe.record?.createdAt,onViewQuotes:se})}),(!re||ne)&&e.jsxs("div",{className:S.meta,children:[e.jsxs("div",{className:S.cardActionRow,onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:S.cardActionRowCenter,children:[e.jsxs("div",{className:`${S.addWrap} ${Ue?S.addWrapOpen:""}`,ref:et,children:[e.jsx("button",{ref:rt,type:"button",className:`${S.addToBoardBtn} ${Be?S.addToBoardBtnInCollection:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:e=>{e.preventDefault(),e.stopPropagation(),ee?.did?He(e=>!e):te()},"aria-label":"Collect","aria-expanded":Ue,children:e.jsx(B,{})}),Ue&&at&&h.createPortal(e.jsxs("div",{ref:nt,className:`${S.addDropdown} ${S.addDropdownFixed}`,style:{position:"fixed",bottom:at.bottom,left:at.left,transform:"translateX(-50%)",zIndex:1001},children:[0===kt.length?null:e.jsx(e.Fragment,{children:kt.map(t=>{const r=R(t.id,pe.uri),n=Ke.has(t.id);return e.jsxs("label",{className:S.addBoardLabel,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>!r&&gt(t.id),disabled:r,className:S.addBoardCheckbox}),e.jsx("span",{className:S.addBoardText,children:r?e.jsxs(e.Fragment,{children:["✓ ",t.name]}):t.name})]},t.id)})}),e.jsx("div",{className:S.addDropdownNew,children:e.jsx("input",{type:"text",placeholder:"New collection name",value:Je,onChange:e=>Ze(e.target.value),className:S.addBoardInput,onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),yt())})}),e.jsx("div",{className:S.addDropdownActions,children:e.jsx("button",{type:"button",className:S.addBoardSubmit,onClick:yt,disabled:0===Ke.size&&!Je.trim(),children:"Add to selected"})})]}),document.body)]}),pe.author.avatar&&(Ne||!ee||Ae?e.jsx(C,{handle:ge,className:S.cardActionRowAvatar,onClick:e=>e.stopPropagation(),"aria-label":`View @${ge} profile`,children:e.jsx(E,{src:pe.author.avatar,alt:"",loading:"lazy"})}):e.jsxs("button",{type:"button",className:`${S.cardActionRowAvatar} ${S.cardActionRowAvatarFollow}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:vt,disabled:Te,"aria-label":`Follow @${ge}`,title:`Follow @${ge}`,children:[e.jsx(E,{src:pe.author.avatar,alt:"",loading:"lazy"}),e.jsx("span",{className:S.cardActionRowAvatarPlus,"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 8 8",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M4 2v4M2 4h4"})})})]})),e.jsx("button",{type:"button",className:`${S.cardLikeRepostBtn} ${We?S.cardLikeRepostBtnActive:""}`,onTouchStart:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),onClick:ft,disabled:Ee,title:We?"Remove like":"Like","aria-label":We?"Remove like":"Like",children:We?"♥":"♡"})]}),e.jsxs("div",{className:S.cardActionRowRight,children:[pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=f(t);return"relative"===r.kind?e.jsx("span",{className:S.cardActionRowTime,title:x(t),"aria-hidden":!0,children:r.text}):e.jsxs("span",{className:`${S.cardActionRowTime} ${S.postTimeStacked}`,title:x(t),"aria-hidden":!0,children:[e.jsx("span",{className:S.postTimeMonth,children:r.month}),e.jsxs("span",{className:S.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})(),e.jsx(v,{postUri:pe.uri,postCid:pe.cid,authorDid:pe.author.did,rootUri:pe.uri,isOwnPost:Ne,compact:!0,verticalIcon:!0,className:S.cardActionsMenu,open:Ve,onOpenChange:e=>{Ye(e),Y?.(e)},dropdownRef:Qe,feedLabel:_e,postedAt:pe.record?.createdAt,onViewQuotes:se})]})]}),!ne&&e.jsx("div",{className:S.handleBlock,children:e.jsxs("div",{className:S.handleRow,children:[pe.author.avatar?e.jsx(E,{src:pe.author.avatar,alt:"",className:S.authorAvatar,loading:"lazy"}):pe.author.did?e.jsx("span",{className:S.authorAvatarPlaceholder,"aria-hidden":!0,children:(ge||pe.author.did).slice(0,1).toUpperCase()}):null,e.jsxs("span",{className:S.handleRowMain,children:[e.jsx("span",{className:Oe?S.handleLinkWrapLiked:S.handleLinkWrap,children:e.jsxs(C,{handle:ge,className:S.handleLink,onClick:e=>e.stopPropagation(),children:["@",ge]})}),(ye||be)&&e.jsx("span",{className:S.repostIconLink,role:"button",tabIndex:0,title:ye?`Reposted by @${ye}`:"Quote post","aria-label":ye?`Reposted by @${ye}`:"Quote post",onClick:e=>{e.stopPropagation(),qt(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),Pt())},children:e.jsx(O,{})})]}),e.jsxs("span",{className:S.handleRowMeta,children:[Re&&e.jsx("span",{className:S.pinIconWrap,title:"Pinned",children:e.jsx(W,{})}),pe.record?.createdAt&&(()=>{const t=pe.record.createdAt,r=f(t);return"relative"===r.kind?e.jsx("span",{className:S.postTime,title:x(t),children:r.text}):e.jsxs("span",{className:`${S.postTime} ${S.postTimeStacked}`,title:x(t),children:[e.jsx("span",{className:S.postTimeMonth,children:r.month}),e.jsxs("span",{className:S.postTimeDayYear,children:[r.day,r.year?` ${r.year}`:""]})]})})()]})]})}),!ne&&fe&&xe?e.jsx("p",{className:S.text,onClick:e=>{e.stopPropagation(),qt(e)},children:e.jsx(z,{text:xe,facets:pe.record?.facets,maxLength:80,stopPropagation:!0,interactive:!1})}):null]})]})})},(e,t)=>{if(e.item.post.uri!==t.item.post.uri)return!1;if(e.isSelected!==t.isSelected)return!1;if(e.likedUriOverride!==t.likedUriOverride)return!1;if(e.seen!==t.seen)return!1;if(e.nsfwBlurred!==t.nsfwBlurred)return!1;if(e.fillCell!==t.fillCell)return!1;if(e.constrainMediaHeight!==t.constrainMediaHeight)return!1;if(e.openAddDropdown!==t.openAddDropdown)return!1;if(e.cardIndex!==t.cardIndex)return!1;if(e.actionsMenuOpenForIndex!==t.actionsMenuOpenForIndex)return!1;if(e.focusedMediaIndex!==t.focusedMediaIndex)return!1;if(e.item.post.cid!==t.item.post.cid)return!1;if(e.item.post.likeCount!==t.item.post.likeCount)return!1;return e.item.post.repostCount===t.item.post.repostCount});export{D as P};
